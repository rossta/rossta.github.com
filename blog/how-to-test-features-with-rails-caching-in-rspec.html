<!doctype html>
<html class="antialiased" lang="en">
  <head>
    <title>How to Test Features with Rails Caching in RSpec - rossta.net</title>
<meta name="description" content="Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs" />
<meta name="keywords" content="Ruby, Rails, RSpec" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs" />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/noun_6185_cc.png" />
<meta name="twitter:title" content="How to Test Features with Rails Caching in RSpec" />
<meta property="og:description" content="Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs" />
<meta property="og:image" content="https://rossta.net/assets/images/blog/noun_6185_cc.png" />
<meta property="og:title" content="How to Test Features with Rails Caching in RSpec" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="pingback" href="https://webmention.io/rossta.net/xmlrpc" />
    <link rel="webmention" href="https://webmention.io/rossta.net/webmention" />

    <link href='/css/app.chunk.aca3b125280ffbe355b4.css' rel='stylesheet' media='all'></link>
  </head>
  <body id="application" class="leading-relaxed">
    <header id="welcome-nav" class="top-bar text-gray-800 sm:flex sm:justify-between sm:items-center sm:px-4 sm:py-3" data-topbar>
  <div class="flex justify-between items-center px-4 py-3 sm:p-0">
    <h1 class="text-2xl font-bold">
      <a class="logo" href="/"><span>rossta.net</span></a>
    </h1>
    <button type="button" aria-label="Menu" class="top-bar-menu-button sm:hidden block text-gray-500 hover:text-gray-700 focus:text-gray-700 focus:outline-none">
      <svg class="h-6 w-6 fill-current" viewBox="0 0 24 24">
        <path class="icon" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/>
        <path class="icon hidden" d="M18.278 16.864a1 1 0 0 1-1.414 1.414l-4.829-4.828-4.828 4.828a1 1 0 0 1-1.414-1.414l4.828-4.829-4.828-4.828a1 1 0 0 1 1.414-1.414l4.829 4.828 4.828-4.828a1 1 0 1 1 1.414 1.414l-4.828 4.829 4.828 4.828z"/>
      </svg>
    </button>
  </div>

  <nav class="top-bar-section hidden sm:block sm:flex sm:justify-around px-2 pt-2 pb-4">
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2" href="/blog">blog</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/series">series</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/talks">talks</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/projects">projects</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/about">about</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/feed.xml">feed</a>
  </nav>
</header>

    <main id="main" role="main" class="layout container">
        <article class="post mb-12">
    <header class="page-header mt-4">
  <h1>
    How to Test Features with Rails Caching in RSpec
  </h1>
    <h2 class="mt-4 text-gray-600 font-medium">
      A RSpec helper for using Rails caching in acceptance tests
    </h2>
</header>

    <p>Once you introduce caching in your view layer, it can be easy for bugs to crop up around expiry logic. Since the Rails test environment ships with controller caching disabled, it may be useful to be able to toggle it on/off during the test run.</p>

<p>A useful feature of RSpec is the ability to pass metadata to tests and suites. You may already be familiar with examples in <a href="https://github.com/jnicklas/capybara" target="_blank" rel="noopener noreferrer">Capybara</a>, such as passing <code>:js</code> to enable the javascript driver for a given spec. You may reach a point in the maturity of your test suite when it makes sense add your own configuration options.</p>

<p>To provide an optional caching mechanism for your specs, configure an around block:</p>

<pre><code class="ruby">RSpec.configure do |config|
  config.around(:each, :caching) do |example|
  caching = ActionController::Base.perform_caching
  ActionController::Base.perform_caching = example.metadata[:caching]
  example.run
  ActionController::Base.perform_caching = caching
  end
end
</code></pre>

<p>The around block takes the RSpec example object as an argument. The block is triggered when :caching is detected as a key in an example’s metadata. The example object provides a number of methods for test introspection, allowing you to make changes before and after calling run to execute the spec. Here, we are storing the previously set value of <code>ActionContoller::Base.perform_caching</code>, setting it for the local suite, and setting it back to the original value after it completes.</p>

<p>As a result, we now have a simple, explicit mechanism for introducing caching to individual specs and suites:</p>

<pre><code class="ruby">describe &quot;visit the homepage&quot;, :caching do
  # test cached stuff
end
</code></pre>

<p>Happy testing.</p>

<hr>

<p><a href="https://thenounproject.com/term/sd-card/6185/" target="_blank" rel="noopener noreferrer">SD Card</a> by Thomas Le Bas from the Noun Project</p>

  </article>
  <section class="mb-12">
    <p class="text-right">
      <a href="https://twitter.com/intent/tweet?text=How%20to%20Test%20Features%20with%20Rails%20Caching%20in%20RSpec%20-%20rossta.net&amp;url=https%3A%2F%2Frossta.net%2Fblog%2Fhow-to-test-features-with-rails-caching-in-rspec.html" class="font-bold" target="_blank" rel="noopener noreferrer">Discuss it on Twitter</a>
      &middot;
      <span class="italic font-light">
        Published on Dec 22, 2011
      </span>
    </p>
  </section>
  <section class="signup-form-standalone hero">
    <script src="https://f.convertkit.com/ckjs/ck.5.js" async></script>
<form
  action="https://app.convertkit.com/forms/1268949/subscriptions?ref=Ruby"
  class="seva-form formkit-form"
  method="post"
  data-sv-form="1268949"
  data-uid="cda82aafbf"
  data-format="inline"
  data-version="5"
  data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;Success! Now check your email to confirm your subscription.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:&quot;300&quot;,&quot;devices&quot;:null,&quot;show_once_every&quot;:&quot;7&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:null,&quot;trigger&quot;:null,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:null,&quot;devices&quot;:null,&quot;show_once_every&quot;:null}}}"
>
  <div>
    <div class="mb-4">
          <h3 class="mb-2">
    Need help with Webpack on Rails?
  </h3>
  <p class="mb-4">
    Webpacker now ships by default in Rails 6 but there's no need to stress.
    I'm putting together a course to help you master Webpack on Rails.
  </p>
  <p>
    Subscribe to stay in the loop.
  </p>

    </div>
    <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
    <div data-element="fields" data-stacked="false" class="seva-fields formkit-fields">
      <div class="formkit-field">
        <label for="email_address" class="sr-only">Email address</label>
        <input
          class="formkit-input"
          id="email_address"
          name="email_address"
          placeholder="Your email address"
          required=""
          type="email"
          style="border-color: rgb(227, 227, 227); border-radius: 4px; color: rgb(0, 0, 0); font-weight: 400;"
        />
      </div>
      <button
        data-element="submit"
        class="formkit-submit button button-green"
      >
        <div class="formkit-spinner">
          <div></div>
          <div></div>
          <div></div>
        </div>
        <span>Subscribe</span>
      </button>
    </div>
    <a
      href="https://convertkit.com/?utm_source=dynamic&amp;utm_medium=referral&amp;utm_campaign=poweredby&amp;utm_content=form"
      class="formkit-powered-by"
      data-element="powered-by"
      target="_blank"
      rel="noopener noreferrer"
      >Powered By ConvertKit</a
    >
  </div>
  <style>
  </style>
    <input type="hidden" name="tags[]" value="733960" />
    <input type="hidden" name="tags[]" value="733966" />
    <input type="hidden" name="tags[]" value="" />
  <input type="hidden" aria-label="URL" name="fields[url]" placeholder="URL" value="https://rossta.net/blog/2011-12-22-how-to-test-features-with-rails-caching-in-rspec.html" />
</form>


  </section>
  <section class="index-posts mb-24">
    <h2 class="mb-8">More posts</h2>
      <article class="index-post">
    <header class="index-title">
      <a href="/blog/ruby-you-autocomplete-me.html">Ruby, You Autocomplete Me</a>
    </header>
  </article>
  <article class="index-post">
    <header class="index-title">
      <a href="/blog/configuring-rack-test-driver-in-capybara-2.html">Configuring Rack Test Driver in Capybara 2</a>
    </header>
  </article>
  <article class="index-post">
    <header class="index-title">
      <a href="/blog/when-your-fat-models-need-to-go-on-a-diet-part-2.html">When Your Fat Models Need to Go on a Diet, Part 2</a>
    </header>
  </article>

  </section>
  <article class="mb-24">
      <figure>
        <img src="/assets/images/blog/noun_6185_cc.png" alt="Noun 6185 cc" />
      </figure>
  </article>
    <!-- Webpack on Rails course popup form -->
    <script async data-uid="92c0bd55d0" src="https://little-fog-6985.ck.page/92c0bd55d0/index.js"></script>

    </main>
    
    <footer class="bg-silver border-t text-xs">
  <div class="layout container p-6">
    <img src="/assets/images/turtle-logo.svg" class="turtle w-8 mb-6" alt="Turtle logo" />
    <section class="lg:flex lg:justify-between">
      <section class="mb-8">
        <h5 class="font-bold mb-4">Most Popular</h5>
        <ul>
            <li class="mb-1"><a href="/blog/reasons-to-switch-to-webpacker.html">25 reasons to switch to Webpack(er)</a></li>
            <li class="mb-1"><a href="/blog/building-a-pdf-viewer-with-vue-part-1.html">Rendering PDF pages with PDF.js and Vue</a></li>
            <li class="mb-1"><a href="/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">How to specify local Ruby gems in your Gemfile</a></li>
            <li class="mb-1"><a href="/blog/webpacker-with-bootstrap.html">Using Bootstrap with Rails Webpacker</a></li>
            <li class="mb-1"><a href="/blog/from-sprockets-to-webpack.html">How we switched from Sprockets to Webpack</a></li>
        </ul>
      </section>
      <section class="mb-8">
        <h5 class="font-bold mb-4">
          <a class="text-gray-900 hover:text-gray-700" href="blog/tags.html">
            Categories
          </a>
        </h5>
        <ul>
            <li class="mb-1"><a href="/blog/tags/ruby.html">Ruby</a></li>
            <li class="mb-1"><a href="/blog/tags/rails.html">Rails</a></li>
            <li class="mb-1"><a href="/blog/tags/javascript.html">JavaScript</a></li>
            <li class="mb-1"><a href="/blog/tags/webpack.html">Webpack</a></li>
            <li class="mb-1"><a href="/blog/tags/vue.html">Vue</a></li>
        </ul>
      </section>
      <section class="mb-8">
        <h5 class="font-bold mb-4">Contact</h5>
        <ul>
          <li class="mb-1"><a target="_blank" href="mailto:ross@rossta.net" rel="me noopener nofollow">email</a></li>
          <li class="mb-1"><a target="_blank" href="https://twitter.com/rossta" rel="me noopener nofollow">twitter</a></li>
          <li class="mb-1"><a target="_blank" href="https://github.com/rossta" rel="me noopener nofollow">github</a></li>
          <li class="mb-1"><a target="_blank" href="https://www.linkedin.com/in/rosskaffenberger" rel="me noopener nofollow">linkedin</a></li>
          <li class="mb-1"><a target="_blank" href="https://stackoverflow.com/users/771838/rossta?tab=profile" rel="me noopener nofollow">stackoverflow</a></li>
        </ul>
      </section>
    </section>
    <p class="copyright text-center text-xs font-light">
      © 2020 Ross Kaffenberger. All rights reserved.
    </p>
  </div>
</footer>

    <script src='/js/runtime.616b919d14a1caaa6dc3.js'></script><script src='/js/vendors~app.chunk.ce4197c4d485571095a7.js'></script><script src='/js/app.chunk.f4d98d3b1b4b3b589583.js'></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-16458563-2"></script>
<script type="text/javascript">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-16458563-2');
</script>

  </body>
</html>
