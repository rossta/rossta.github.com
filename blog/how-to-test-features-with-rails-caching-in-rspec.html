<!doctype html>
<html>
  <head>
    <title>How to Test Features with Rails Caching in RSpec - rossta.net</title>
<meta name="description" content="Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs" />
<meta name="keywords" content="Ruby, Rails, RSpec" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs" />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/noun_6185_cc-77180c3d.png" />
<meta name="twitter:title" content="How to Test Features with Rails Caching in RSpec" />
<meta property="og:description" content="Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs" />
<meta property="og:image" content="https://rossta.net/assets/images/blog/noun_6185_cc-77180c3d.png" />
<meta property="og:title" content="How to Test Features with Rails Caching in RSpec" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon"     href="/apple-touch-icon.png" />
    <link rel="icon"                 href="/touch-icon-192x192.png" />
    <link rel="icon" sizes="192x192" href="/touch-icon-192x192.png" />
    <link rel="icon" sizes="144x144" href="/touch-icon-144x144.png" />
    <link rel="icon" sizes="96x96"   href="/touch-icon-96x96.png" />
    <link rel="icon" sizes="72x72"   href="/touch-icon-72x72.png" />

    <link rel="pingback" href="https://webmention.io/rossta.net/xmlrpc" />
    <link rel="webmention" href="https://webmention.io/rossta.net/webmention" />

    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href="/assets/stylesheets/index.bundle-197126c1.css" rel="stylesheet" />
    <script src="/assets/javascripts/head.bundle-bc33c5ab.js"></script>
    <link href="/assets/images/turtle-favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body id="application" class="typekit">
    <nav id="welcome-nav" class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a class="logo" href="/"><img src="/assets/images/turtle-logo-096698b6.svg" alt="Turtle logo" /><span>rossta.net</span></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="nav"><a href="/blog">blog</a></li>
      <li class="nav"><a href="/series">series</a></li>
      <li class="nav"><a href="/talks">talks</a></li>
      <li class="nav"><a href="/projects">projects</a></li>
      <li class="nav"><a href="/about">about</a></li>
      <li class="nav"><a href="/feed.xml">feed</a></li>
    </ul>
  </section>
</nav>

    <div class="row">
      <section id="main" role="main" class="large-12 small-12 columns">
          <section id="blog" class="margin-bottom double">
    <article class="post margin-bottom double">
      <header class="page-header with-summary">
  <h1>
    How to Test Features with Rails Caching in RSpec
  </h1>
    <h3>
      A RSpec helper for using Rails caching in acceptance tests
    </h3>
</header>

        <figure>
          <img src="/assets/images/blog/noun_6185_cc-77180c3d.png" alt="Noun 6185 cc" />
        </figure>

      <p>Once you introduce caching in your view layer, it can be easy for bugs to crop up around expiry logic. Since the Rails test environment ships with controller caching disabled, it may be useful to be able to toggle it on/off during the test run.</p>

<p>A useful feature of RSpec is the ability to pass metadata to tests and suites. You may already be familiar with examples in <a href="https://github.com/jnicklas/capybara">Capybara</a>, such as passing <code>:js</code> to enable the javascript driver for a given spec. You may reach a point in the maturity of your test suite when it makes sense add your own configuration options.</p>

<p>To provide an optional caching mechanism for your specs, configure an around block:</p>

<pre><code class="ruby">RSpec.configure do |config|
  config.around(:each, :caching) do |example|
  caching = ActionController::Base.perform_caching
  ActionController::Base.perform_caching = example.metadata[:caching]
  example.run
  ActionController::Base.perform_caching = caching
  end
end
</code></pre>

<p>The around block takes the RSpec example object as an argument. The block is triggered when :caching is detected as a key in an example’s metadata. The example object provides a number of methods for test introspection, allowing you to make changes before and after calling run to execute the spec. Here, we are storing the previously set value of <code>ActionContoller::Base.perform_caching</code>, setting it for the local suite, and setting it back to the original value after it completes.</p>

<p>As a result, we now have a simple, explicit mechanism for introducing caching to individual specs and suites:</p>

<pre><code class="ruby">describe &quot;visit the homepage&quot;, :caching do
  # test cached stuff
end
</code></pre>

<p>Happy testing.</p>

<hr>

<p><a href="https://thenounproject.com/term/sd-card/6185/">SD Card</a> by Thomas Le Bas from the Noun Project</p>


    </article>
    <hr />
    <section class="margin-bottom double">
      <p>
        Did you like this post? Do me a favor: <a href="https://twitter.com/intent/tweet?text=How%20to%20Test%20Features%20with%20Rails%20Caching%20in%20RSpec%20-%20rossta.net&amp;url=https%3A%2F%2Frossta.net%2Fblog%2F2011-12-22-how-to-test-features-with-rails-caching-in-rspec.html" target="_blank" rel="noopener">share it on Twitter</a>,
          <a href="https://twitter.com/rossta">follow me - @rossta</a>,
          and sign up for my newsletter. Thanks!
        </p>
      </section>
    </section>
    <section class="signup-form-standalone margin-bottom double">
      <!-- Begin MailChimp Signup Form -->
<div class="signup-form">
  <h3>Stay in the LOOP</h3>
  <p>Sign up for my occasional newsletter on Ruby, Javascript, and Elixir for the web!</p>
  <div id="mc_embed_signup">
    <form action="//rossta.us6.list-manage.com/subscribe/post?id=96030b0bda&u=8ce159842b5c98cecb4ebdf16" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">

        <div class="row">
          <div class="large-10 columns">
            <div class="row collapse">
              <div class="large-8 small-7 columns">
                <input type="email" placeholder="Your email..." value="" name="EMAIL" class="required email" id="mce-EMAIL">
              </div>
              <div class="large-4 small-5 columns">
                <input type="submit" value="Sign me up!" name="subscribe" id="mc-embedded-subscribe" class="button postfix">
              </div>
            </div>
          </div>
        </div>

        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;"><input type="text" name="b_8ce159842b5c98cecb4ebdf16_96030b0bda" tabindex="-1" value=""></div>
      </div>

      <input type="hidden" name="SIGNUP" value="https://rossta.net/blog/2011-12-22-how-to-test-features-with-rails-caching-in-rspec.html" />
      <input type="hidden" name="SIGNUP_APP" value="Mailchimp" />
      <input type="hidden" name="SIGNUP_LOCATION" id="signup_location" value="blog/2011-12-22-how-to-test-features-with-rails-caching-in-rspec.html" />
      <input type="hidden" name="SIGNUP_TAGS" id="signup_tags" value="Ruby,Rails,RSpec" />
    </form>
  </div>
  <!--End mc_embed_signup-->
</div>

    </section>
    <section class="margin-bottom double">
      <p>
        Published on Dec 22, 2011
    </p>
  </section>
    <hr />
    <section class="comments">
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname  = "rosskaff";
    var disqus_identifier = "how-to-test-features-with-rails-caching-in-rspec";
    var disqus_title      = "How to Test Features with Rails Caching in RSpec";
    var disqus_url        = "https://rossta.net/blog/how-to-test-features-with-rails-caching-in-rspec.html";

    var disqus_config = function () {
        this.page.url = disqus_url;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = disqus_identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.title = disqus_title;
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//rosskaff.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->

    </section>

      </section>
    </div>
    
    <footer>
  <div class="row">
    <img src="/assets/images/turtle-logo-096698b6.svg" class="turtle" alt="Turtle logo" />
    <section class="large-6 columns">
      <h5>Most Popular</h5>
      <ul>
          <li><a href="/blog/web-push-notifications-from-rails.html">Sending Web Push Notifications from Rails</a></li>
          <li><a href="/blog/n+1-is-a-rails-feature.html">N+1 is a Rails feature</a></li>
          <li><a href="/blog/what-i-learned-about-hanami.html">What I learned building an app in Hanami</a></li>
          <li><a href="/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">How to specify local Ruby gems in your Gemfile</a></li>
          <li><a href="/blog/service-worker-on-rails.html">Service Worker on Rails</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Categories</h5>
      <ul>
          <li><a href="/blog/tags/ruby.html">Ruby</a></li>
          <li><a href="/blog/tags/rails.html">Rails</a></li>
          <li><a href="/blog/tags/javascript.html">JavaScript</a></li>
          <li><a href="/blog/tags/rspec.html">RSpec</a></li>
          <li><a href="/blog/tags/css.html">CSS</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Contact</h5>
      <ul>
        <li><a href="mailto:ross@rossta.net" rel="me noopener">email</a></li>
        <li><a href="https://twitter.com/rossta" rel="me noopener">twitter</a></li>
        <li><a href="https://medium.com/@rossta" rel="me noopener">medium</a></li>
        <li><a href="https://github.com/rossta" rel="me noopener">github</a></li>
        <!-- <li><a href="https://stackoverflow.com/users/771838/rossta?tab=profile" rel="me">stackoverflow</a></li> -->
        <li><a href="https://www.linkedin.com/in/rosskaffenberger" rel="me noopener">linkedin</a></li>
      </ul>
    </section>
  </div>
  <p class="copyright small subtle center">
    © 2017 Ross Kaffenberger. All rights reserved.
  </p>
</footer>

    <script src="/assets/javascripts/index.bundle-c5a45a1a.js"></script>
    
    <script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("NdBtrprkAGAjQryMShljRdVf90saElAU");
analytics.page()
window.$.tracking.flush(analytics);
}}();
</script>

  </body>
</html>
