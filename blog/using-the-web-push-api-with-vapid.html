<!doctype html>
<html>
  <head>
    <title>Using Web Push Notifications with VAPID - rossta.net</title>
<meta name="description" content="Sending push notifications in Ruby or Node.js on the open web using the Voluntary Application server Identification (VAPID) protocol." />
<meta name="keywords" content="Ruby, JavaScript, Service Worker" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="Sending push notifications in Ruby or Node.js on the open web using the Voluntary Application server Identification (VAPID) protocol." />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/stock/horsehead-nebula-pexels-photo.jpeg" />
<meta name="twitter:title" content="Using Web Push Notifications with VAPID" />
<meta property="og:description" content="Sending push notifications in Ruby or Node.js on the open web using the Voluntary Application server Identification (VAPID) protocol." />
<meta property="og:image" content="https://rossta.net/assets/images/blog/stock/horsehead-nebula-pexels-photo.jpeg" />
<meta property="og:title" content="Using Web Push Notifications with VAPID" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="pingback" href="https://webmention.io/rossta.net/xmlrpc" />
    <link rel="webmention" href="https://webmention.io/rossta.net/webmention" />

    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href='/assets/css/app.chunk.f62cfb2bc5b697dbb988.css' rel='stylesheet'></link>
  </head>
  <body id="application" class="typekit">
    <nav id="welcome-nav" class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a class="logo" href="/"><img src="/assets/images/turtle-logo.svg" alt="Turtle logo" /><span>rossta.net</span></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="nav"><a href="/blog">blog</a></li>
      <li class="nav"><a href="/series">series</a></li>
      <li class="nav"><a href="/talks">talks</a></li>
      <li class="nav"><a href="/projects">projects</a></li>
      <li class="nav"><a href="/about">about</a></li>
      <li class="nav"><a href="/feed.xml">feed</a></li>
    </ul>
  </section>
</nav>

    <div class="row">
      <section id="main" role="main" class="large-12 small-12 columns">
          <section id="blog" class="margin-bottom double">
    <article class="post margin-bottom double">
      <header class="page-header with-summary">
  <h1>
    Using Web Push Notifications with VAPID
  </h1>
    <h3>
      Sending push notifications in Ruby or Node.js on the open web
    </h3>
</header>


      <p>Push messages from mobile and desktop browsers are <a href="http://caniuse.com/#feat=push-api">now a thing</a> on the open web.</p>

<p>Why use the Push API? It allows us to use free, third-party services to notify our users
of events, even when they&#39;re not actively engaged with our site. It&#39;s
not meant to replace other methods of pushing data to clients, like
<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">WebSockets</a> or <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">Server Sent Events</a>, but can be useful for sending small, infrequent payloads to keep users engaged. Think: a build has finished successfully, a new post was published, a touchdown was scored.  What&#39;s
common place on our smartphones from installed apps is now possible from the browser.</p>

<p><a href="https://serviceworker-rails.herokuapp.com/push-simple/"><img src="/assets/images/screenshots/screenshot-sw-sandbox-push-simple-3.jpg" alt="Push message in Chrome" /></a></p>

<p>Though only supported in Chrome and Firefox on the desktop and in Chrome on Android at the time of this writing, it&#39;ll be more widespread soon enough. While I previously <a href="/blog/web-push-notifications-from-rails.html">wrote about this topic</a>, there have been recent changes in the Chrome implementation to make the API consistent with Firefox, which we&#39;ll describe here.</p>

<p>In this post, we&#39;ll walk through setting up a Ruby or Node.js web application to use the Push API with the <a href="https://tools.ietf.org/html/draft-ietf-webpush-vapid-01">Voluntary Application server Identification (VAPID)</a>. Use of VAPID for push requests is optional, but primarily a security benefit. Application servers use VAPID to identify themselves to the push servers so push subscriptions can be properly restricted to their origin app servers. In other words, VAPID could theoretically prevent an attacker from stealing a user <code>PushSubscription</code> and sending push messages to that recipient from another server. Down the road, push services may be able to provide analytics and debugging assistance for app servers using the VAPID protocol. Another benefit: in Chrome, it is no longer necessary to register our web apps through the Google Developer Console and pass around Google app credentials in web push requests.</p>

      <h2 id="overview" class="title">
        <a name="overview" class="anchor" href="#overview">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Overview
      </h2>
    
<p>There are three parties involved in delivering a push message.</p>

<ul>
<li>Your application server</li>
<li>Your user</li>
<li>A push server, e.g., Google or Mozilla</li>
</ul>

<p>Before a push message can be delivered with VAPID, a few criteria should be satisfied:</p>

<ol>
<li>Your application server has generated a set of VAPID keys that will be used to sign Push API requests. This is a one-time step (at least until we decide to reset the keys).</li>
<li>A <code>manifest.json</code> file, linked from a page on our website, identifies our app settings.</li>
<li>In the user&#39;s web browser, a service worker script is installed and activated. The <code>pushManager</code> property of the <code>ServiceWorkerRegistration</code> is subscribed to push events with our VAPID public key, with creates a <code>subscription</code> JSON object on the client side.</li>
<li>Your server makes an API request to a push server (likely using a server-side library) to send a notification with the <code>subscription</code> obtained from the client and an optional payload (the message).</li>
<li>Your service worker is set up to receive <code>&#39;push&#39;</code> events. To trigger a desktop notification, the user has accepted the prompt to receive notifications from our site.</li>
</ol>

      <h2 id="generating-vapid-keys" class="title">
        <a name="generating-vapid-keys" class="anchor" href="#generating-vapid-keys">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Generating VAPID keys
      </h2>
    
<p>To take advantage of the VAPID protocol, we would generate a public/private VAPID key pair to store on our server to be used for all user subscriptions.</p>

<p>In Ruby, we can use the <code>webpush</code> gem to generate a VAPID key that has both a <code>public_key</code> and <code>private_key</code> attribute to be saved on the server side.</p>

<pre><code class="ruby"># Gemfile
gem &#39;webpush&#39;
</code></pre>

<p>In a Ruby console:</p>

<pre><code class="ruby">require &#39;webpush&#39;

# One-time, on the server
vapid_key = Webpush.generate_key

# Save these in our application server settings
vapid_key.public_key
# =&gt; &quot;BC1mp...HQ=&quot;

vapid_key.private_key
# =&gt; &quot;XhGUr...Kec&quot;
</code></pre>

<p>In Node.js, we can use the <code>web-push</code> package:</p>

<pre><code class="bash">npm install web-push --save
</code></pre>

<p>In the node REPL:</p>

<pre><code class="javascript">const webpush = require(&#39;web-push&#39;);

const vapidKeys = webpush.generateVAPIDKeys()

vapidKeys.publicKey
&#39;BDO0P...eoH&#39;

vapidKeys.privateKey
&#39;3J303..r4I&#39;
</code></pre>

<p>The keys returned will both be Base64-encoded byte strings. Only the public key
will be shared, both with the user&#39;s browser and the push server as we&#39;ll see
later.</p>

      <h2 id="declaring-manifest-json" class="title">
        <a name="declaring-manifest-json" class="anchor" href="#declaring-manifest-json">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Declaring manifest.json
      </h2>
    
<p>Add a <code>manifest.json</code> file served at the scope of our app (or above), like at the root to describe our client application for use with the Push API.</p>

<pre><code class="javascript">{
  &quot;name&quot;: &quot;My App&quot;,
    &quot;short_name&quot;: &quot;my-app&quot;,
    &quot;start_url&quot;: &quot;/&quot;,
    &quot;icons&quot;: [
    {
      &quot;src&quot;: &quot;/images/my-push-logo-192x192.png&quot;,
      &quot;sizes&quot;: &quot;192x192&quot;,
      &quot;type&quot;: &quot;image/png&quot;
    }
    ]
}
</code></pre>

<p>Link to it somewhere in the <code>&lt;head&gt;</code> tag:</p>

<pre><code class="html">&lt;!-- index.html --&gt;
&lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot; /&gt;
</code></pre>

      <h2 id="installing-a-service-worker" class="title">
        <a name="installing-a-service-worker" class="anchor" href="#installing-a-service-worker">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Installing a service worker
      </h2>
    
<p>Your application javascript must register a service worker script at an appropriate scope (we&#39;re sticking with the root).</p>

<pre><code class="javascript">// application.js
// Register the serviceWorker script at /serviceworker.js from our server if supported
if (navigator.serviceWorker) {
  navigator.serviceWorker.register(&#39;/serviceworker.js&#39;)
  .then(function(reg) {
    console.log(&#39;Service worker change, registered the service worker&#39;);
  });
}
// Otherwise, no push notifications :(
else {
  console.error(&#39;Service worker is not supported in this browser&#39;);
}
</code></pre>

<p>For Rails developers, we may want to look at the <a href="https://github.com/rossta/serviceworker-rails"><code>serviceworker-rails</code> gem</a> and this <a href="https://rossta.net/blog/service-worker-on-rails.html">helpful tutorial</a> to integrate service worker scripts with the Rails asset pipeline.</p>

      <h2 id="subscribing-to-push-notifications" class="title">
        <a name="subscribing-to-push-notifications" class="anchor" href="#subscribing-to-push-notifications">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Subscribing to push notifications
      </h2>
    
<p>The VAPID public key we generated earlier is made available to the client as a <code>Uint8Array</code>. To do this, one way would be to expose the urlsafe-decoded bytes from Ruby to JavaScript when rendering the HTML template.</p>

<p>In Ruby, we might embed the key as raw bytes from the application <code>ENV</code> or some other application settings mechanism into an HTML template with help from the <code>Base64</code> module in the standard library. Global variables are used here for simplicity.</p>

<pre><code class="ruby"># server
@decodedVapidPublicKey = Base64.urlsafe_decode64(ENV[&#39;VAPID_PUBLIC_KEY&#39;]).bytes
</code></pre>

<pre><code class="html">&lt;!-- html template --&gt;
&lt;script&gt;
window.vapidPublicKey = new Uint8Array(&lt;%= @decodedVapidPublicKey %&gt;);
&lt;/script&gt;
</code></pre>

<p>In Node.js, we could use the <code>urlsafe-base64</code> package to decode the public key and convert it to raw bytes:</p>

<pre><code class="javascript">// server
const urlsafeBase64 = require(&#39;urlsafe-base64&#39;);
const decodedVapidPublicKey = urlsafeBase64.decode(process.env.VAPID_PUBLIC_KEY);
</code></pre>

<pre><code class="html">&lt;!-- html template --&gt;
&lt;script&gt;
window.vapidPublicKey = new Uint8Array(&lt;%= decodedVapidPublicKey %&gt;);
&lt;/script&gt;
</code></pre>

<p>Your application javascript would then use the <code>pushManager</code> property to subscribe to push notifications, passing the VAPID public key to the subscription settings.</p>

<pre><code class="javascript">// application.js
// When serviceWorker is supported, installed, and activated,
// subscribe the pushManager property with the vapidPublicKey
navigator.serviceWorker.ready.then((serviceWorkerRegistration) =&gt; {
  serviceWorkerRegistration.pushManager
  .subscribe({
    userVisibleOnly: true,
    applicationServerKey: window.vapidPublicKey
  });
});
</code></pre>

      <h2 id="triggering-a-web-push-notification" class="title">
        <a name="triggering-a-web-push-notification" class="anchor" href="#triggering-a-web-push-notification">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Triggering a web push notification
      </h2>
    
<p>The web push library we&#39;re using on the backend will be responsible for
packaging up the request to the subscription&#39;s endpoint and handling encryption, so the user&#39;s push subscription must be sent from the client to the application server at some point.</p>

<p>In the example below, we send the JSON generated subscription object to our backend with a message when a button on the page is clicked.</p>

<pre><code class="javascript">// application.js
$(&#39;.webpush-button&#39;).on(&#39;click&#39;, (e) =&gt; {
  navigator.serviceWorker.ready
  .then((serviceWorkerRegistration) =&gt; {
    serviceWorkerRegistration.pushManager.getSubscription()
    .then((subscription) =&gt; {
      $.post(&#39;/push&#39;, {
        subscription: subscription.toJSON(),
        message: &#39;You clicked a button!&#39;
      });
    });
  });
});
</code></pre>

<p>The call to <code>pushManager.getSubscription()</code> returns a Promise that provides the
<code>PushSubscription</code> instance with all the information the push service needs to
send a push message to this user&#39;s browser. This includes an <code>endpoint</code>, the URL
on the push server where we&#39;ll send the push request, and a pair of <code>keys</code>
labelled as <code>p256dh</code> and <code>auth</code> required to encrypt the push message payload. If interested to learn more about how this encryption works, check out this detailed summary on <a href="https://developers.google.com/web/updates/2016/03/web-push-encryption">web push payload encryption</a>.</p>

<pre><code class="javascript">// subscription.toJSON();
{
  endpoint: &quot;https://android.googleapis.com/gcm/send/a-subscription-id&quot;,
  keys: {
    auth: &#39;AEl35...7fG&#39;,
    p256dh: &#39;Fg5t8...2rC&#39;
  }
}
</code></pre>

<p>Imagine a Ruby app endpoint that responds to the request by triggering notification through the <code>webpush</code> gem. VAPID details include a URL or mailto address for our website and the Base64-encoded public/private VAPID key pair we generated earlier.</p>

<pre><code class="ruby"># app.rb
post &#39;/push&#39; do
  Webpush.payload_send(
    message: params[:message]
    endpoint: params[:subscription][:endpoint],
    p256dh: params[:subscription][:keys][:p256dh],
    auth: params[:subscription][:keys][:auth],
    ttl: 24 * 60 * 60,
    vapid: {
      subject: &#39;mailto:sender@example.com&#39;,
      public_key: ENV[&#39;VAPID_PUBLIC_KEY&#39;],
      private_key: ENV[&#39;VAPID_PRIVATE_KEY&#39;]
    }
  )
end
</code></pre>

<p>In Node.js, usage of the <code>web-push</code> package might look like this:</p>

<pre><code class="javascript"># index.js
const webpush = require(&#39;web-push&#39;);

// ...

app.post(&#39;/push&#39;, function(request, response) {
  const subscription = request.param(&#39;subscription&#39;);
  const message = request.param(&#39;message&#39;);

  setTimeout(() =&gt; {
    const options = {
      TTL: 24 * 60 * 60,
      vapidDetails: {
        subject: &#39;mailto:sender@example.com&#39;,
        publicKey: process.env.VAPID_PUBLIC_KEY,
        privateKey: process.env.VAPID_PRIVATE_KEY
      },
    }

    webpush.sendNotification(
      subscription,
      message,
      options
    );

  }, 0);

  response.send(&#39;OK&#39;);
});
</code></pre>

      <h2 id="receiving-the-push-event" class="title">
        <a name="receiving-the-push-event" class="anchor" href="#receiving-the-push-event">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Receiving the push event
      </h2>
    
<p>Your <code>/serviceworker.js</code> script can respond to <code>&#39;push&#39;</code> events to trigger desktop notifications by calling <code>showNotification</code> on the <code>registration</code> property.</p>

<pre><code class="javascript">// serviceworker.js
// The serviceworker context can respond to &#39;push&#39; events and trigger
// notifications on the registration property
self.addEventListener(&quot;push&quot;, (event) =&gt; {
  let title = (event.data &amp;&amp; event.data.text()) || &quot;Yay a message&quot;;
  let body = &quot;We have received a push message&quot;;
  let tag = &quot;push-simple-demo-notification-tag&quot;;
  let icon = &#39;/assets/my-logo-120x120.png&#39;;

  event.waitUntil(
    self.registration.showNotification(title, { body, icon, tag })
  )
});
</code></pre>

<p>Before the notifications can be displayed, the user must grant permission for <a href="https://developer.mozilla.org/en-US/docs/Web/API/notification">notifications</a> in a browser prompt, using something like the example below.</p>

<pre><code class="javascript">// application.js

// Let&#39;s check if the browser supports notifications
if (!(&quot;Notification&quot; in window)) {
  console.error(&quot;This browser does not support desktop notification&quot;);
}

// Let&#39;s check whether notification permissions have already been granted
else if (Notification.permission === &quot;granted&quot;) {
  console.log(&quot;Permission to receive notifications has been granted&quot;);
}

// Otherwise, we need to ask the user for permission
else if (Notification.permission !== &#39;denied&#39;) {
  Notification.requestPermission(function (permission) {
  // If the user accepts, let&#39;s create a notification
    if (permission === &quot;granted&quot;) {
      console.log(&quot;Permission to receive notifications has been granted&quot;);
    }
  });
}
</code></pre>

<p>After all that setup, we should see a browser notification triggered via the Push API.</p>

<p>As this is still an emerging technology, things are rapidly changing. I&#39;d be
interested to hear how things are working out for folks integrating web push
into their web apps.</p>

    </article>

    <section class="signup-form-standalone margin-bottom quadruple">
      <script src="https://f.convertkit.com/ckjs/ck.5.js" async></script>
<form
  action="https://app.convertkit.com/forms/818387/subscriptions?ref=Ruby"
  class="seva-form formkit-form"
  method="post"
  data-sv-form="818387"
  data-uid="cda82aafbf"
  data-format="inline"
  data-version="5"
  data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;Success! Now check your email to confirm your subscription.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:&quot;300&quot;,&quot;devices&quot;:null,&quot;show_once_every&quot;:&quot;7&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:null,&quot;trigger&quot;:null,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:null,&quot;devices&quot;:null,&quot;show_once_every&quot;:null}}}"
  min-width="400 500 600 700 800"
>
  <div data-style="clean">
      <h3>
  Did you like this post?
</h3>
<p>
  Please
  <a href="https://twitter.com/intent/tweet?text=Using%20Web%20Push%20Notifications%20with%20VAPID&amp;url=https%3A%2F%2Frossta.net%2Fblog%2Fusing-the-web-push-api-with-vapid.html" target="_blank" rel="noopener">share it on Twitter</a>
  and enter your email below to subscribe to my newsletter on
  Ruby, JavaScript, Service Worker, and the web. Thank you!
</p>

    <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
    <div data-element="fields" data-stacked="false" class="seva-fields formkit-fields">
      <div class="formkit-field">
        <input
          class="formkit-input"
          name="email_address"
          placeholder="Your email address"
          required=""
          type="text"
          style="border-color: rgb(227, 227, 227); border-radius: 4px; color: rgb(0, 0, 0); font-weight: 400;"
        />
      </div>
      <button
        data-element="submit"
        class="formkit-submit formkit-submit"
        style="background-color: rgb(22, 119, 190); border-radius: 4px; color: rgb(255, 255, 255); font-weight: 400;"
      >
        <div class="formkit-spinner">
          <div></div>
          <div></div>
          <div></div>
        </div>
        <span>Subscribe</span>
      </button>
    </div>
    <a
      href="https://convertkit.com/?utm_source=dynamic&amp;utm_medium=referral&amp;utm_campaign=poweredby&amp;utm_content=form"
      class="formkit-powered-by"
      data-element="powered-by"
      target="_blank"
      rel="noopener noreferrer"
      >Powered By ConvertKit</a
    >
  </div>
  <style>
    .formkit-form[data-uid='cda82aafbf'] * {
      font-family: 'Helvetica Neue', Helvetica, Arial, Verdana, sans-serif;
      box-sizing: border-box;
    }
    .formkit-form[data-uid='cda82aafbf'] legend {
      border: none;
      font-size: inherit;
      margin-bottom: 10px;
      padding: 0;
      position: relative;
      display: table;
    }
    .formkit-form[data-uid='cda82aafbf'] fieldset {
      border: 0;
      padding: 0.01em 0 0 0;
      margin: 0;
      min-width: 0;
    }
    .formkit-form[data-uid='cda82aafbf'] body:not(:-moz-handler-blocked) fieldset {
      display: table-cell;
    }

    .formkit-form[data-uid='cda82aafbf'][data-format='modal'] {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf'][data-format='slide in'] {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input,
    .formkit-form[data-uid='cda82aafbf'] .formkit-select,
    .formkit-form[data-uid='cda82aafbf'] .formkit-checkboxes {
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit {
      border: 0;
      border-radius: 5px;
      color: #ffffff;
      cursor: pointer;
      display: inline-block;
      text-align: center;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 15px;
      overflow: hidden;
      padding: 0;
      position: relative;
      vertical-align: middle;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:hover,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:hover,
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:focus,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:focus {
      outline: none;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:hover > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:hover > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:focus > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:focus > span {
      background-color: rgba(0, 0, 0, 0.1);
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit > span {
      display: block;
      -webkit-transition: all 300ms ease-in-out;
      transition: all 300ms ease-in-out;
      padding: 12px 24px;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input {
      background: #ffffff;
      font-size: 15px;
      padding: 12px;
      border: 1px solid #e3e3e3;
      -webkit-flex: 1 0 auto;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      line-height: 1.4;
      margin: 0;
      -webkit-transition: border-color ease-out 300ms;
      transition: border-color ease-out 300ms;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input:focus {
      outline: none;
      border-color: #1677be;
      -webkit-transition: border-color ease 300ms;
      transition: border-color ease 300ms;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input::-webkit-input-placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input::-moz-placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input:-ms-input-placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input::placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown'] {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown']::before {
      content: '';
      top: calc(50% - 2.5px);
      right: 10px;
      position: absolute;
      pointer-events: none;
      border-color: #4f4f4f transparent transparent transparent;
      border-style: solid;
      border-width: 6px 6px 0 6px;
      height: 0;
      width: 0;
      z-index: 999;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown'] select {
      height: auto;
      width: 100%;
      cursor: pointer;
      color: #333333;
      line-height: 1.4;
      margin-bottom: 0;
      padding: 0 6px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      font-size: 15px;
      padding: 12px;
      padding-right: 25px;
      border: 1px solid #e3e3e3;
      background: #ffffff;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown'] select:focus {
      outline: none;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] {
      text-align: left;
      margin: 0;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] [data-group='checkbox'] {
      margin-bottom: 10px;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] [data-group='checkbox'] * {
      cursor: pointer;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']:last-of-type {
      margin-bottom: 0;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox'] {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox']
      + label::after {
      content: none;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox']:checked
      + label::after {
      border-color: #ffffff;
      content: '';
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox']:checked
      + label::before {
      background: #10bf7a;
      border-color: #10bf7a;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] [data-group='checkbox'] label {
      position: relative;
      display: inline-block;
      padding-left: 28px;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::before,
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::after {
      position: absolute;
      content: '';
      display: inline-block;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::before {
      height: 16px;
      width: 16px;
      border: 1px solid #e3e3e3;
      background: #ffffff;
      left: 0px;
      top: 3px;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::after {
      height: 4px;
      width: 8px;
      border-left: 2px solid #4d4d4d;
      border-bottom: 2px solid #4d4d4d;
      -webkit-transform: rotate(-45deg);
      -ms-transform: rotate(-45deg);
      transform: rotate(-45deg);
      left: 4px;
      top: 8px;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert {
      background: #f9fafb;
      border: 1px solid #e3e3e3;
      border-radius: 5px;
      -webkit-flex: 1 0 auto;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      list-style: none;
      margin: 25px auto;
      padding: 12px;
      text-align: center;
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert:empty {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert-success {
      background: #d3fbeb;
      border-color: #10bf7a;
      color: #0c905c;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert-error {
      background: #fde8e2;
      border-color: #f2643b;
      color: #ea4110;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      height: 0px;
      width: 0px;
      margin: 0 auto;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      width: 0px;
      overflow: hidden;
      text-align: center;
      -webkit-transition: all 300ms ease-in-out;
      transition: all 300ms ease-in-out;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner > div {
      margin: auto;
      width: 12px;
      height: 12px;
      background-color: #fff;
      opacity: 0.3;
      border-radius: 100%;
      display: inline-block;
      -webkit-animation: formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- 1.4s infinite
        ease-in-out both;
      animation: formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- 1.4s infinite ease-in-out
        both;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner > div:nth-child(1) {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner > div:nth-child(2) {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit[data-active] .formkit-spinner {
      opacity: 1;
      height: 100%;
      width: 50px;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit[data-active] .formkit-spinner ~ span {
      opacity: 0;
    }
    @-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- {
      0%,
      80%,
      100% {
        -webkit-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }
      40% {
        -webkit-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }
    @keyframes formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- {
      0%,
      80%,
      100% {
        -webkit-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }
      40% {
        -webkit-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }
    .formkit-form[data-uid='cda82aafbf'] {
      max-width: 700px;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-style='clean'] {
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-fields {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      -webkit-flex-wrap: wrap;
      -ms-flex-wrap: wrap;
      flex-wrap: wrap;
      margin: 0 auto;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-field,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit {
      margin: 0 0 15px 0;
      -webkit-flex: 1 0 100%;
      -ms-flex: 1 0 100%;
      flex: 1 0 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-powered-by {
      color: #7d7d7d;
      display: block;
      font-size: 12px;
      margin: 0;
      text-align: center;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-powered-by[data-active='false'] {
      opacity: 0.5;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700'] [data-style='clean'],
    .formkit-form[data-uid='cda82aafbf'][min-width~='800'] [data-style='clean'] {
      padding: 10px;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700'] .formkit-fields[data-stacked='false'],
    .formkit-form[data-uid='cda82aafbf'][min-width~='800'] .formkit-fields[data-stacked='false'] {
      margin-left: -5px;
      margin-right: -5px;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-field,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-field,
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-submit,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-submit {
      margin: 0 5px 15px 5px;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-field,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-field {
      -webkit-flex: 100 1 auto;
      -ms-flex: 100 1 auto;
      flex: 100 1 auto;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-submit,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-submit {
      -webkit-flex: 1 1 auto;
      -ms-flex: 1 1 auto;
      flex: 1 1 auto;
    }
  </style>
    <input type="hidden" name="tags[]" value="733960" />
    <input type="hidden" name="tags[]" value="733959" />
    <input type="hidden" name="tags[]" value="733965" />
  <input type="hidden" aria-label="URL" name="fields[url]" placeholder="URL" value="https://rossta.net/blog/2016-10-21-using-the-web-push-api-with-vapid.html" />
</form>


    </section>
    <article>
        <figure>
          <img src="/assets/images/blog/stock/horsehead-nebula-pexels-photo.jpeg" alt="Horsehead nebula pexels photo" />
        </figure>
    </article>
    <section class="margin-bottom double">
      <p>
          Part of the <a href="/blog/series/service-worker.html">Service Worker</a> series.
        Published on Oct 21, 2016
      </p>
    </section>
  </section>

      </section>
    </div>
    
    <footer>
  <div class="row">
    <img src="/assets/images/turtle-logo.svg" class="turtle" alt="Turtle logo" />
    <section class="large-6 columns">
      <h5>Most Popular</h5>
      <ul>
          <li><a href="/blog/building-a-pdf-viewer-with-vue-part-1.html">Rendering PDF pages with PDF.js and Vue</a></li>
          <li><a href="/blog/local-ssl-for-rails-5.html">Local SSL for Rails 5 development and tests</a></li>
          <li><a href="/blog/from-sprockets-to-webpack.html">How we switched from Sprockets to Webpack</a></li>
          <li><a href="/blog/web-push-notifications-from-rails.html">Sending Web Push Notifications from Rails</a></li>
          <li><a href="/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">How to specify local Ruby gems in your Gemfile</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Categories</h5>
      <ul>
          <li><a href="/blog/tags/ruby.html">Ruby</a></li>
          <li><a href="/blog/tags/rails.html">Rails</a></li>
          <li><a href="/blog/tags/javascript.html">JavaScript</a></li>
          <li><a href="/blog/tags/vue.html">Vue</a></li>
          <li><a href="/blog/tags/service-worker.html">Service Worker</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Contact</h5>
      <ul>
        <li><a href="mailto:ross@rossta.net" rel="me noopener">email</a></li>
        <li><a href="https://twitter.com/rossta" rel="me noopener">twitter</a></li>
        <li><a href="https://medium.com/@rossta" rel="me noopener">medium</a></li>
        <li><a href="https://github.com/rossta" rel="me noopener">github</a></li>
        <!-- <li><a href="https://stackoverflow.com/users/771838/rossta?tab=profile" rel="me">stackoverflow</a></li> -->
        <li><a href="https://www.linkedin.com/in/rosskaffenberger" rel="me noopener">linkedin</a></li>
      </ul>
    </section>
  </div>
  <p class="copyright small subtle center">
    Â© 2019 Ross Kaffenberger. All rights reserved.
  </p>
</footer>

    <script src='/assets/js/runtime.269cddb94bf0453a0b81.js'></script><script src='/assets/js/vendors~app.chunk.744433b6240167794468.js'></script><script src='/assets/js/app.chunk.434a3f09ce036d4718fa.js'></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-16458563-2"></script>
<script type="text/javascript">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-16458563-2');
</script>

  </body>
</html>
