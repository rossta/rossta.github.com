<!doctype html>
<html>
  <head>
    <title>Sending Web Push Notifications from Rails - rossta.net</title>
<meta name="description" content="This blog post describes how to set up a simple demonstration of the Web Push and Service Worker JavaScript APIs to send notifications to users from a Ruby on Rails application." />
<meta name="keywords" content="Rails, JavaScript, Service Worker" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="This blog post describes how to set up a simple demonstration of the Web Push and Service Worker JavaScript APIs to send notifications to users from a Ruby on Rails application." />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/stock/guitarist-pexels-photo.jpeg" />
<meta name="twitter:title" content="Sending Web Push Notifications from Rails" />
<meta property="og:description" content="This blog post describes how to set up a simple demonstration of the Web Push and Service Worker JavaScript APIs to send notifications to users from a Ruby on Rails application." />
<meta property="og:image" content="https://rossta.net/assets/images/blog/stock/guitarist-pexels-photo.jpeg" />
<meta property="og:title" content="Sending Web Push Notifications from Rails" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="pingback" href="https://webmention.io/rossta.net/xmlrpc" />
    <link rel="webmention" href="https://webmention.io/rossta.net/webmention" />

    <link href='/assets/css/app.chunk.ec0fe26b83d3a067ec6b.css' rel='stylesheet'></link>
  </head>
  <body id="application">
    <nav id="welcome-nav" class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a class="logo" href="/"><span>rossta.net</span></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="nav"><a href="/blog">blog</a></li>
      <li class="nav"><a href="/series">series</a></li>
      <li class="nav"><a href="/talks">talks</a></li>
      <li class="nav"><a href="/projects">projects</a></li>
      <li class="nav"><a href="/about">about</a></li>
      <li class="nav"><a href="/feed.xml">feed</a></li>
    </ul>
  </section>
</nav>

    <div class="row">
      <section id="main" role="main" class="large-12 small-12 columns">
          <section id="blog" class="margin-bottom double">
    <article class="post margin-bottom double">
      <header class="page-header with-summary">
  <h1>
    Sending Web Push Notifications from Rails
  </h1>
    <h3>
      How to deliver desktop notifications from your Rails app
    </h3>
</header>


      <p><em>Update: Check out <a href="https://rossta.net/blog/using-the-web-push-api-with-vapid.html">Using the Push API with VAPID</a> for sending Web Push notifications without needing to configure Google app settings</em></p>

<p>We&#39;ve had push notifications in our mobile and desktop apps for sometime. It&#39;s now becoming possible on the open web.</p>

<p>Web Push notifications are powerful because they allow you to engage with your users <em>even when they&#39;re not on your site</em>.</p>

<p>I&#39;m going to share how to I got a working demo of the new <a href="https://www.w3.org/TR/push-api/">Web Push API</a> from a Rails (or any Ruby) web application to push desktop-style notifications through supporting browsers - currently Chrome and Firefox at the time of this writing.</p>

<p>We&#39;ll cover the basics of implementing Push yourself though it&#39;s interesting to note that third party services are already stepping in to do some of the technical work for you, like <a href="https://goroost.com/">Roost</a>, <a href="https://pushcrew.com/">PushCrew</a>, or
<a href="https://onesignal.com/webpush">OneSignal</a>.</p>

<div class="callout panel">
<p>
  The <a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html">Apple Push Notification Service</a> has made push notifications available to Safari since 2013. There are some <a href="http://samuli.hakoniemi.net/how-to-implement-safari-push-notifications-on-your-website/">nice tutorials</a> for implementing Apple Push on Safari. The status of future support for Web Push in Safari is: "maybe?".
</p>
</div>

      <h2 id="why-" class="title">
        <a name="why-" class="anchor" href="#why-">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Why?
      </h2>
    
<p>&quot;Yeah, Ross, but Rails 5. Action Cable. Web Sockets. Server Sent Events. <code>$MY_FAVORITE_ALTERNATIVE</code>!&quot;</p>

<p>You might not want to drop all those alternatives just yet, as <a href="http://caniuse.com/#feat=push-api">browser support for Web Push</a> still needs improvement. Web Push could be a good alternative for a subset push features for applications where deploying Rails 5 Action Cable would be overkill. Web push also currently relies on third party web which may or may not be advantage depending on your deployment options.</p>

<p>But the killer feature of Web Push is that notifications can be displayed even when the user is not on the site, something those other solutions cannot provide.</p>

      <h2 id="demo" class="title">
        <a name="demo" class="anchor" href="#demo">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Demo
      </h2>
    
<p>Want to see it in action first?</p>

<p>I created a demo at the <a href="https://serviceworker-rails.herokuapp.com/push-simple/">Service Worker Rails
Sandbox</a> to show how a
simple push message would look like. Try it out in Firefox or Chrome or check
out the <a href="https://github.com/rossta/serviceworker-rails-sandbox">source code on GitHub</a>.</p>

<p><a href="https://serviceworker-rails.herokuapp.com/push-simple/"><img src="/assets/images/screenshots/screenshot-sw-sandbox-push-simple-1.png" alt="Screenshot sw sandbox push simple 1" /></a></p>

<p>My demo is mostly informed by Mozilla&#39;s <a href="https://serviceworke.rs/">Service Worker
Cookbook</a>, which I highly recommend if you&#39;re looking
to learn more about Service Worker.</p>

      <h2 id="bird-39-s-eye-view" class="title">
        <a name="bird-39-s-eye-view" class="anchor" href="#bird-39-s-eye-view">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Bird&#39;s eye view
      </h2>
    
<p>Delivering push notifications involve interactions among three parties - the
user (through her browser), your Rails application, and the Web Push server,
which for our purposes is either Google or Firefox.</p>

<p><img src="/assets/images/blog/push-notification-high-level.png" alt="Push notification high level" /></p>

<blockquote>
<p>Diagram courtesy of the <a href="https://wiki.mozilla.org/Firefox/Push_Notifications">Firefox wiki</a></p>
</blockquote>

<ol>
<li><p>We&#39;ll use JavaScript on the user&#39;s current page to <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register">register a service worker</a> subscribe to push notifications via the <a href="https://developer.mozilla.org/en-US/docs/Web/API/PushManager/subscribe"><code>pushManager</code></a> interface. The browser will make a request to the Web Push server to a <a href="https://developer.mozilla.org/en-US/docs/Web/API/PushSubscription"><code>PushSubscription</code></a> which will contain a unique endpoint to the Web Push server and authorization keys required for encrypting the push notification request body.</p></li>
<li><p>We&#39;ll post the subscription info to our Rails app to be persisted on the server side.</p></li>
<li><p>To send a push notification, we&#39;ll use the <a href="https://github.com/zaru/webpush"><code>webpush</code></a> Ruby gem triggered from our Rails app. <code>webpush</code> is responsible for sending a proper request to the Web Push server, including <a href="https://developers.google.com/web/updates/2016/03/web-push-encryption?hl=en">encryption of the message payload</a> for delivery.</p></li>
<li><p>If the request is successful, the Web Push server opens a socket to our
registered service worker which can listen for <code>&#39;push&#39;</code> events to show a
notification to the user. Since service workers have a lifecycle independent of
the web page, they can process events even when the user is not visiting our
website.</p></li>
</ol>

      <h2 id="setup" class="title">
        <a name="setup" class="anchor" href="#setup">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Setup
      </h2>
    
<p>At the time of this writing, we&#39;ll need to configure our app to use the Google Cloud Messaging platform by registering for application keys. No special authorization is needed to use the Firefox push server as far as I can tell.</p>

<p>Google provides some decent <a href="https://developers.google.com/web/fundamentals/getting-started/push-notifications/step-04?hl=en">instructions for registering your app for push
notifications</a> which involves some clicking around on the <a href="https://console.developers.google.com">Google developer console</a>. (I&#39;ve heard rumors this may not be necessary in the near future.) You&#39;ll want to come away with a project id for your app and an API key to make authorized requests to the push server.</p>

<p>Both Firefox and Chrome will expect us to link to a <code>manifest</code> json file to
provide metadata for push subscriptions and notifications. Here&#39;s an example:</p>

<pre><code class="json">{
  &quot;name&quot;: &quot;Your app name&quot;,
  &quot;short_name&quot;: &quot;Your app&quot;,
  &quot;icons&quot;: [{
    &quot;src&quot;: &quot;images/icon-192x192.png&quot;,
    &quot;sizes&quot;: &quot;192x192&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }],
  &quot;start_url&quot;: &quot;/&quot;,
  &quot;display&quot;: &quot;standalone&quot;,
  &quot;gcm_sender_id&quot;: &quot;&lt;Your Project ID&gt;&quot;,
  &quot;gcm_user_visible_only&quot;: true
}
</code></pre>

<div class="callout panel">
<p>
Update: as of Chrome 52, it is no longer necessary to set the <code>gcm_sender_id</code>
and <code>gcm_user_visible_only</code> attributes in your <code>manifest.json</code> configuration
as long as you use VAPID details as <a href="/blog/using-the-web-push-api-in-ruby.html">described in my followup post</a>.
</p>
</div>

<p>For now, this file can go in <code>public/manifest.json</code>. In your <code>app/views/layouts/application.html.erb</code> template, you&#39;ll also need to
add a special <code>&lt;link&gt;</code> tag to the manifest:</p>

<pre><code class="html">&lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot;&gt;
</code></pre>

<p>Here&#39;s the <a href="https://serviceworker-rails.herokuapp.com/push-simple/manifest.json">actual manifest.json</a> for the Service Worker Rails Sandbox <a href="https://serviceworker-rails.herokuapp.com/push-simple/">push demo</a> as another point of reference.</p>

      <h2 id="subscribe-through-a-service-worker" class="title">
        <a name="subscribe-through-a-service-worker" class="anchor" href="#subscribe-through-a-service-worker">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Subscribe through a service worker
      </h2>
    
<p>Yes, Service Worker time! In case you missed it, I&#39;m really <a href="/blog/series/service-worker.html">excited about
Service Workers</a>. Service Workers have the
potential to level the playing field of reliability between the web and mobile devices.</p>

<p>Service workers must be deployed a bit differently than JavaScript evaluated in
the web page context. I&#39;ve gone into more detail on how to <a href="/blog/service-worker-on-rails.html">integrate Service
Worker with Rails</a> previously but for now, here&#39;s the quick setup for push.</p>

<p>In <code>application.js</code> (or another <code>.js</code> required by <code>application.js</code>) we&#39;ll use this following snippet to request registration of
a service worker script.</p>

<pre><code class="javascript">// app/assets/javascripts/application.js

if (&#39;serviceWorker&#39; in navigator) {
  console.log(&#39;Service Worker is supported&#39;);
  navigator.serviceWorker.register(&#39;/serviceworker.js&#39;)
    .then(function(registration) {
      console.log(&#39;Successfully registered!&#39;, &#39;:^)&#39;, registration);
      registration.pushManager.subscribe({ userVisibleOnly: true })
        .then(function(subscription) {
            console.log(&#39;endpoint:&#39;, subscription.endpoint);
        });
  }).catch(function(error) {
    console.log(&#39;Registration failed&#39;, &#39;:^(&#39;, error);
  });
}
</code></pre>

<p>This code registers a service worker on the given scope via <code>navigator.serviceWorker.register</code>. This returns a <a href="#">Promise</a> which will resolve to an instance of <code>ServiceWorkerRegistration</code>. This registration object has a <code>pushManager</code> property which we use to <code>subscribe</code> to the Web Push server. The <code>{ userVisibleOnly: true }</code> parameter is required for us to use notifications.</p>

      <h3 id="troubleshooting" class="title">
        <a name="troubleshooting" class="anchor" href="#troubleshooting">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Troubleshooting
      </h3>
    
<p>I got an error at this stage in Google Chrome the first time: <code>Unable to subscribe to push DOMException: Registration failed - push service error</code>. Turns out, the <code>pushmanage.subscribe</code> request can fail if you haven&#39;t properly configured your <code>manifest.json</code> with a valid Google Cloud Message sender id.</p>

<p>Also, if the <code>pushManager</code> can&#39;t find the <code>manifest.json</code> via the link tag, or
if it&#39;s not included in the page altogether, you may see another error: <code>Unable to subscribe to push DOMException: Registration failed - manifest empty or missing</code>, so you&#39;ll need to get that working to proceed.</p>

      <h3 id="the-service-worker" class="title">
        <a name="the-service-worker" class="anchor" href="#the-service-worker">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        The Service Worker
      </h3>
    
<p>In a separate file, <code>app/assets/javascripts/serviceworker.js</code>, we&#39;ll have our service worker show notifications when the <code>&#39;push&#39;</code> event is received:</p>

<pre><code class="javascript">function onPush(event) {
  var title = (event.data &amp;&amp; event.data.text()) || &quot;Yay a message&quot;;

  event.waitUntil(
    self.registration.showNotification(title, {
      body: &quot;We have received a push message&quot;,
      icon: &quot;/assets/path/to/icon.png&quot;,
      tag:  &quot;push-simple-demo-notification-tag&quot;
    });
  )
}

self.addEventListener(&quot;push&quot;, onPush);
</code></pre>

<p>Because <code>serviceworker.js</code> needs to be a separate script available on the root
path, we either need to copy it to our <code>public/</code> directory , or, even better, we
can use the <a href="https://github.com/rossta/serviceworker-rails"><code>serviceworker-rails</code> (Star it on GitHub!)</a> gem which will allow us to make use of both the asset pipeline and custom routing features we need.</p>

      <h3 id="rails-setup" class="title">
        <a name="rails-setup" class="anchor" href="#rails-setup">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Rails setup
      </h3>
    
<pre><code class="ruby"># Gemfile

gem &#39;serviceworker-rails&#39;
</code></pre>

<p>To routes requests from <code>/serviceworker.js</code> to our JavaScript file in the asset pipeline, we&#39;ll configure the service worker rails middleware as follows:</p>

<pre><code class="ruby"># config/initializers/serviceworker.rb

Rails.application.configure do
  config.serviceworker.routes do
    match &quot;serviceworker.js&quot;
  end
end
</code></pre>

<p>With these settings, we should be able to see our service worker register with the logging we put in place and be able to accept the browser prompt to receive notifications.</p>

<p>As a side note, we can also use the <code>serviceworker-rails</code> routing to move our
<code>manifest.json</code> file to <code>app/assets/javascripts&#39;/</code> from the <code>public/</code> directory so we can take advantage for the asset pipeline, say for calculating image paths, for this file as well:</p>

<pre><code class="ruby"># config/initializers/serviceworker.rb

Rails.application.configure do
  config.serviceworker.routes do
    # ...

    match &quot;manifest.json&quot;
  end
end
</code></pre>

      <h2 id="persist-the-subscription" class="title">
        <a name="persist-the-subscription" class="anchor" href="#persist-the-subscription">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Persist the subscription
      </h2>
    
<p>Let&#39;s set up a controller action to serialize the subscription into the visitor&#39;s session though any persistence method that will allow us to retrieve the subscription(s) for a given user will do.</p>

<p>The push subscription has important pieces of data: the endpoint and a set of keys: p256dh and auth. We need use this data in requests from our rails app to the push server.</p>

<pre><code class="javascript">// subscription.toJSON();

{
  endpoint: &quot;https://android.googleapis.com/gcm/send/a-subscription-id&quot;,
  keys: {
    auth: &quot;16ByteString&quot;,
    p256dh: &quot;65ByteString&quot;
  }
}
</code></pre>

<p>When our visitor subscribes, we can post the subscription to our Rails app:</p>

<pre><code class="javascript">reg.pushManager.subscribe({ userVisibleOnly: true })
  .then(function(subscription) {
    $.post(&quot;/subscribe&quot;, { subscription: subscription.toJSON() });
  });
</code></pre>

<p>The route:</p>

<pre><code class="ruby"># config/routes.rb

post &quot;/subscribe&quot; =&gt; &quot;subscriptions#create&quot;
</code></pre>

<p>Our controller - of course, greatly simplified for the purposes of the this demo:</p>

<pre><code class="ruby"># app/controllers/subscriptions_controller.rb

class SubscriptionsController &lt; ApplicationController
  def create
    session[:subscription] = JSON.dump(params.fetch(:subscription, {}))

    head :ok
  end
end
</code></pre>

      <h2 id="push-it" class="title">
        <a name="push-it" class="anchor" href="#push-it">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Push it
      </h2>
    
<p>Now that we have a subscription, we can send a push notification. For this, we&#39;ll use the <code>webpush</code> gem:</p>

<pre><code class="ruby"># Gemfile

gem &quot;webpush&quot;
</code></pre>

<p>With the subscription info, we have what we need to send a message to a specific
user that will get encrypted in passing over the wire.</p>

<p>Here&#39;s a typical usage:</p>

<pre><code class="ruby">Webpush.payload_send(
  message: &quot;Hello World!&quot;,
  endpoint: &quot;https://android.googleapis.com/gcm/send/a-subscription-id&quot;,
  auth: &quot;16ByteString&quot;,
  p256dh: &quot;65ByteString&quot;
  api_key: &quot;google_api_key&quot; # omit for Firefox, required for Google
)
</code></pre>

<p>As a proof of concept, we&#39;ll create an endpoint to trigger a push notification directly from a user interaction in the browser.</p>

<pre><code class="html">&lt;!-- a view --&gt;
&lt;button class=&quot;js-push-button&quot;&gt;Send a message&lt;/button&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
  (function() {
    $(&#39;.js-push-button&#39;).on(&quot;click&quot;, function onClick() {
      $.post(&quot;/push&quot;);
    });
  })();
&lt;/script&gt;
</code></pre>

<p>Start with a button to trigger a <code>POST</code> to a new <code>/push</code> endpoint in our app. In a real Rails app, you&#39;d probably deliver push notifications from background jobs in response to other events in the system.</p>

<pre><code># config/routes.rb

post &quot;/push&quot; =&gt; &quot;push_notifications#create&quot;
</code></pre>

<p>Route the request to a new controller.</p>

<pre><code class="ruby"># app/controllers/push_notifications_controller.rb

class PushNotificationsController &lt; ApplicationController
  def create
    Webpush.payload_send webpush_params

    head :ok
  end

  private

  def webpush_params
    subscription_params = fetch_subscription
    message = &quot;Hello world, the time is #{Time.zone.now}&quot;
    endpoint = subscription_params[:endpoint],
    p256dh = subscription_params.dig(:keys, :p256dh)
    auth = subscription_params.dig(:keys, :auth)
    api_key = enpoint =~ /\.google.com\// = ENV.fetch(&#39;GOOGLE_CLOUD_MESSAGE_API_KEY&#39;) || &quot;&quot;

    { message: message, endpoint: endpoint, p256dh: p256dh, auth: auth, api_key: api_key }
  end

  def fetch_subscription
    encoded_subscription = session.fetch(:subscription) do
      raise &quot;Cannot create notification: no :subscription in params or session&quot;
    end

    JSON.parse(Base64.urlsafe_decode64(encoded_subscription)).with_indifferent_access
  end
end
</code></pre>

<p>The controller deserializes the subscription from the session and builds up the
necessary parameters to send to the <code>Webpush</code> Ruby client. Only the <code>:endpoint</code> is
required to send a notification in theory. The <code>:p256dh</code> and <code>:auth</code> keys are also required if providing a <code>:message</code> parameter, which must be encrypted to deliver over the wire. Google requires the Google Cloud Message API key we grabbed from th developer console, so we test the endpoint to
decide whether to include it in the request.</p>

<p>If everything worked, we get a push notification!</p>

<p><img src="/assets/images/screenshots/screenshot-sw-sandbox-push-simple-2.jpg" alt="Screenshot sw sandbox push simple 2" /></p>

      <h2 id="unsubscribing" class="title">
        <a name="unsubscribing" class="anchor" href="#unsubscribing">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Unsubscribing
      </h2>
    
<p>We can programmatically turn off notifications by calling
<code>PushSubscription#unsubscribe</code>. This could be done in a callback to a click handler, for example:</p>

<pre><code class="javascript">function unsubscribe() {
  navigator.serviceWorker.ready
    .then((serviceWorkerRegistration) =&gt; {
      serviceWorkerRegistration.pushManager.getSubscription()
        .then((subscription) =&gt; {
          if (!subscription) {
            console.log(&quot;Not subscribed, nothing to do.&quot;);
            return;
          }

          subscription.unsubscribe()
            then(function() {
              console.log(&quot;Successfully unsubscribed!.&quot;);
            })
            .catch((e) =&gt; {
              logger.error(&#39;Error thrown while unsubscribing from push messaging&#39;, e);
            });
        });
    });
}

$(&quot;.js-unsubscribe-button&quot;).on(&quot;click&quot;, unsubscribe)
</code></pre>

<p>You&#39;d also want to send a request to your Rails app to delete the persisted
subscription data from the backend which will no longer be valid on the Web Push
server. That exercise is left up to you!</p>

      <h2 id="wrap-up" class="title">
        <a name="wrap-up" class="anchor" href="#wrap-up">       <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16">
       <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
       </svg>
</a>
        Wrap up
      </h2>
    
<p>This took quite a bit of setup though not nearly as much as getting <a href="https://developer.apple.com/notifications/safari-push-notifications/">Apple
Push Notifications to work in Safari</a>. Overall, the Web Push API is an interesting step for the web in terms of feature parity with mobile.</p>

<p>What do you think?</p>

    </article>

    <section class="signup-form-standalone margin-bottom quadruple">
      <script src="https://f.convertkit.com/ckjs/ck.5.js" async></script>
<form
  action="https://app.convertkit.com/forms/818387/subscriptions?ref=Rails"
  class="seva-form formkit-form"
  method="post"
  data-sv-form="818387"
  data-uid="cda82aafbf"
  data-format="inline"
  data-version="5"
  data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;Success! Now check your email to confirm your subscription.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:&quot;300&quot;,&quot;devices&quot;:null,&quot;show_once_every&quot;:&quot;7&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:null,&quot;trigger&quot;:null,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:null,&quot;devices&quot;:null,&quot;show_once_every&quot;:null}}}"
  min-width="400 500 600 700 800"
>
  <div data-style="clean">
      <h3>
  Did you like this post?
</h3>
<p>
  Please
  <a href="https://twitter.com/intent/tweet?text=Sending%20Web%20Push%20Notifications%20from%20Rails&amp;url=https%3A%2F%2Frossta.net%2Fblog%2Fweb-push-notifications-from-rails.html" target="_blank" rel="noopener">share it on Twitter</a>
  and enter your email below to subscribe to my newsletter on
  Rails, JavaScript, Service Worker, and the web. Thank you!
</p>

    <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
    <div data-element="fields" data-stacked="false" class="seva-fields formkit-fields">
      <div class="formkit-field">
        <input
          class="formkit-input"
          name="email_address"
          placeholder="Your email address"
          required=""
          type="text"
          style="border-color: rgb(227, 227, 227); border-radius: 4px; color: rgb(0, 0, 0); font-weight: 400;"
        />
      </div>
      <button
        data-element="submit"
        class="formkit-submit formkit-submit"
        style="background-color: rgb(22, 119, 190); border-radius: 4px; color: rgb(255, 255, 255); font-weight: 400;"
      >
        <div class="formkit-spinner">
          <div></div>
          <div></div>
          <div></div>
        </div>
        <span>Subscribe</span>
      </button>
    </div>
    <a
      href="https://convertkit.com/?utm_source=dynamic&amp;utm_medium=referral&amp;utm_campaign=poweredby&amp;utm_content=form"
      class="formkit-powered-by"
      data-element="powered-by"
      target="_blank"
      rel="noopener noreferrer"
      >Powered By ConvertKit</a
    >
  </div>
  <style>
    .formkit-form[data-uid='cda82aafbf'] * {
      font-family: 'Helvetica Neue', Helvetica, Arial, Verdana, sans-serif;
      box-sizing: border-box;
    }
    .formkit-form[data-uid='cda82aafbf'] legend {
      border: none;
      font-size: inherit;
      margin-bottom: 10px;
      padding: 0;
      position: relative;
      display: table;
    }
    .formkit-form[data-uid='cda82aafbf'] fieldset {
      border: 0;
      padding: 0.01em 0 0 0;
      margin: 0;
      min-width: 0;
    }
    .formkit-form[data-uid='cda82aafbf'] body:not(:-moz-handler-blocked) fieldset {
      display: table-cell;
    }

    .formkit-form[data-uid='cda82aafbf'][data-format='modal'] {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf'][data-format='slide in'] {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input,
    .formkit-form[data-uid='cda82aafbf'] .formkit-select,
    .formkit-form[data-uid='cda82aafbf'] .formkit-checkboxes {
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit {
      border: 0;
      border-radius: 5px;
      color: #ffffff;
      cursor: pointer;
      display: inline-block;
      text-align: center;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 15px;
      overflow: hidden;
      padding: 0;
      position: relative;
      vertical-align: middle;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:hover,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:hover,
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:focus,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:focus {
      outline: none;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:hover > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:hover > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-button:focus > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit:focus > span {
      background-color: rgba(0, 0, 0, 0.1);
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-button > span,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit > span {
      display: block;
      -webkit-transition: all 300ms ease-in-out;
      transition: all 300ms ease-in-out;
      padding: 12px 24px;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input {
      background: #ffffff;
      font-size: 15px;
      padding: 12px;
      border: 1px solid #e3e3e3;
      -webkit-flex: 1 0 auto;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      line-height: 1.4;
      margin: 0;
      -webkit-transition: border-color ease-out 300ms;
      transition: border-color ease-out 300ms;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input:focus {
      outline: none;
      border-color: #1677be;
      -webkit-transition: border-color ease 300ms;
      transition: border-color ease 300ms;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input::-webkit-input-placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input::-moz-placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input:-ms-input-placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-input::placeholder {
      color: #848585;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown'] {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown']::before {
      content: '';
      top: calc(50% - 2.5px);
      right: 10px;
      position: absolute;
      pointer-events: none;
      border-color: #4f4f4f transparent transparent transparent;
      border-style: solid;
      border-width: 6px 6px 0 6px;
      height: 0;
      width: 0;
      z-index: 999;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown'] select {
      height: auto;
      width: 100%;
      cursor: pointer;
      color: #333333;
      line-height: 1.4;
      margin-bottom: 0;
      padding: 0 6px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      font-size: 15px;
      padding: 12px;
      padding-right: 25px;
      border: 1px solid #e3e3e3;
      background: #ffffff;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='dropdown'] select:focus {
      outline: none;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] {
      text-align: left;
      margin: 0;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] [data-group='checkbox'] {
      margin-bottom: 10px;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] [data-group='checkbox'] * {
      cursor: pointer;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']:last-of-type {
      margin-bottom: 0;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox'] {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox']
      + label::after {
      content: none;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox']:checked
      + label::after {
      border-color: #ffffff;
      content: '';
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      input[type='checkbox']:checked
      + label::before {
      background: #10bf7a;
      border-color: #10bf7a;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-group='checkboxes'] [data-group='checkbox'] label {
      position: relative;
      display: inline-block;
      padding-left: 28px;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::before,
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::after {
      position: absolute;
      content: '';
      display: inline-block;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::before {
      height: 16px;
      width: 16px;
      border: 1px solid #e3e3e3;
      background: #ffffff;
      left: 0px;
      top: 3px;
    }
    .formkit-form[data-uid='cda82aafbf']
      [data-group='checkboxes']
      [data-group='checkbox']
      label::after {
      height: 4px;
      width: 8px;
      border-left: 2px solid #4d4d4d;
      border-bottom: 2px solid #4d4d4d;
      -webkit-transform: rotate(-45deg);
      -ms-transform: rotate(-45deg);
      transform: rotate(-45deg);
      left: 4px;
      top: 8px;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert {
      background: #f9fafb;
      border: 1px solid #e3e3e3;
      border-radius: 5px;
      -webkit-flex: 1 0 auto;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      list-style: none;
      margin: 25px auto;
      padding: 12px;
      text-align: center;
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert:empty {
      display: none;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert-success {
      background: #d3fbeb;
      border-color: #10bf7a;
      color: #0c905c;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-alert-error {
      background: #fde8e2;
      border-color: #f2643b;
      color: #ea4110;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      height: 0px;
      width: 0px;
      margin: 0 auto;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      width: 0px;
      overflow: hidden;
      text-align: center;
      -webkit-transition: all 300ms ease-in-out;
      transition: all 300ms ease-in-out;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner > div {
      margin: auto;
      width: 12px;
      height: 12px;
      background-color: #fff;
      opacity: 0.3;
      border-radius: 100%;
      display: inline-block;
      -webkit-animation: formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- 1.4s infinite
        ease-in-out both;
      animation: formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- 1.4s infinite ease-in-out
        both;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner > div:nth-child(1) {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-spinner > div:nth-child(2) {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit[data-active] .formkit-spinner {
      opacity: 1;
      height: 100%;
      width: 50px;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit[data-active] .formkit-spinner ~ span {
      opacity: 0;
    }
    @-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- {
      0%,
      80%,
      100% {
        -webkit-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }
      40% {
        -webkit-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }
    @keyframes formkit-bouncedelay-formkit-form-data-uid-cda82aafbf- {
      0%,
      80%,
      100% {
        -webkit-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }
      40% {
        -webkit-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }
    .formkit-form[data-uid='cda82aafbf'] {
      max-width: 700px;
    }
    .formkit-form[data-uid='cda82aafbf'] [data-style='clean'] {
      width: 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-fields {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      -webkit-flex-wrap: wrap;
      -ms-flex-wrap: wrap;
      flex-wrap: wrap;
      margin: 0 auto;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-field,
    .formkit-form[data-uid='cda82aafbf'] .formkit-submit {
      margin: 0 0 15px 0;
      -webkit-flex: 1 0 100%;
      -ms-flex: 1 0 100%;
      flex: 1 0 100%;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-powered-by {
      color: #7d7d7d;
      display: block;
      font-size: 12px;
      margin: 0;
      text-align: center;
    }
    .formkit-form[data-uid='cda82aafbf'] .formkit-powered-by[data-active='false'] {
      opacity: 0.5;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700'] [data-style='clean'],
    .formkit-form[data-uid='cda82aafbf'][min-width~='800'] [data-style='clean'] {
      padding: 10px;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700'] .formkit-fields[data-stacked='false'],
    .formkit-form[data-uid='cda82aafbf'][min-width~='800'] .formkit-fields[data-stacked='false'] {
      margin-left: -5px;
      margin-right: -5px;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-field,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-field,
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-submit,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-submit {
      margin: 0 5px 15px 5px;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-field,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-field {
      -webkit-flex: 100 1 auto;
      -ms-flex: 100 1 auto;
      flex: 100 1 auto;
    }
    .formkit-form[data-uid='cda82aafbf'][min-width~='700']
      .formkit-fields[data-stacked='false']
      .formkit-submit,
    .formkit-form[data-uid='cda82aafbf'][min-width~='800']
      .formkit-fields[data-stacked='false']
      .formkit-submit {
      -webkit-flex: 1 1 auto;
      -ms-flex: 1 1 auto;
      flex: 1 1 auto;
    }
  </style>
    <input type="hidden" name="tags[]" value="733966" />
    <input type="hidden" name="tags[]" value="733959" />
    <input type="hidden" name="tags[]" value="733965" />
  <input type="hidden" aria-label="URL" name="fields[url]" placeholder="URL" value="https://rossta.net/blog/2016-05-13-web-push-notifications-from-rails.html" />
</form>


    </section>
    <article>
        <figure>
          <img src="/assets/images/blog/stock/guitarist-pexels-photo.jpeg" alt="Guitarist pexels photo" />
        </figure>
    </article>
    <section class="margin-bottom double">
      <p>
          Part of the <a href="/blog/series/service-worker.html">Service Worker</a> series.
        Published on May 13, 2016
      </p>
    </section>
  </section>

      </section>
    </div>
    
    <footer>
  <div class="row">
    <img src="/assets/images/turtle-logo.svg" class="turtle" alt="Turtle logo" />
    <section class="large-6 columns">
      <h5>Most Popular</h5>
      <ul>
          <li><a href="/blog/building-a-pdf-viewer-with-vue-part-1.html">Rendering PDF pages with PDF.js and Vue</a></li>
          <li><a href="/blog/local-ssl-for-rails-5.html">Local SSL for Rails 5 development and tests</a></li>
          <li><a href="/blog/from-sprockets-to-webpack.html">How we switched from Sprockets to Webpack</a></li>
          <li><a href="/blog/web-push-notifications-from-rails.html">Sending Web Push Notifications from Rails</a></li>
          <li><a href="/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">How to specify local Ruby gems in your Gemfile</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Categories</h5>
      <ul>
          <li><a href="/blog/tags/ruby.html">Ruby</a></li>
          <li><a href="/blog/tags/rails.html">Rails</a></li>
          <li><a href="/blog/tags/javascript.html">JavaScript</a></li>
          <li><a href="/blog/tags/vue.html">Vue</a></li>
          <li><a href="/blog/tags/service-worker.html">Service Worker</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Contact</h5>
      <ul>
        <li><a href="mailto:ross@rossta.net" rel="me noopener">email</a></li>
        <li><a href="https://twitter.com/rossta" rel="me noopener">twitter</a></li>
        <li><a href="https://medium.com/@rossta" rel="me noopener">medium</a></li>
        <li><a href="https://github.com/rossta" rel="me noopener">github</a></li>
        <!-- <li><a href="https://stackoverflow.com/users/771838/rossta?tab=profile" rel="me">stackoverflow</a></li> -->
        <li><a href="https://www.linkedin.com/in/rosskaffenberger" rel="me noopener">linkedin</a></li>
      </ul>
    </section>
  </div>
  <p class="copyright small subtle center">
    Â© 2019 Ross Kaffenberger. All rights reserved.
  </p>
</footer>

    <script src='/assets/js/runtime.269cddb94bf0453a0b81.js'></script><script src='/assets/js/vendors~app.chunk.744433b6240167794468.js'></script><script src='/assets/js/app.chunk.452b0d6880b982c6f58e.js'></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-16458563-2"></script>
<script type="text/javascript">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-16458563-2');
</script>

  </body>
</html>
