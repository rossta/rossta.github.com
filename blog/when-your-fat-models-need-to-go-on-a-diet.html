<!doctype html>
<html class="antialiased" lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>When Your Fat Models Need to Go on a Diet - rossta.net</title>
<meta name="description" content="Thoughts on refactoring large model classes in Rails" />
<meta name="keywords" content="Ruby, Rails" />
<meta itemprop="name" content="When Your Fat Models Need to Go on a Diet" />
<meta itemprop="description" content="Thoughts on refactoring large model classes in Rails" />
<meta itemprop="image" content="https://rossta.net/assets/images/blog/stock/logs-pexels-photo.jpg" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="rossta.net" />
<meta name="twitter:url" content="https://rossta.net/blog/when-your-fat-models-need-to-go-on-a-diet.html" />
<meta name="twitter:title" content="When Your Fat Models Need to Go on a Diet" />
<meta name="twitter:description" content="Thoughts on refactoring large model classes in Rails" />
<meta name="twitter:image" content="https://rossta.net/assets/images/blog/stock/logs-pexels-photo.jpg" />
<meta property="og:url" content="https://rossta.net/blog/when-your-fat-models-need-to-go-on-a-diet.html" />
<meta property="og:type" content="website" />
<meta property="og:title" content="When Your Fat Models Need to Go on a Diet" />
<meta property="og:image" content="https://rossta.net/assets/images/blog/stock/logs-pexels-photo.jpg" />
<meta property="og:description" content="Thoughts on refactoring large model classes in Rails" />
<meta property="og:site_name" content="rossta.net" />
<meta property="og:locale" content="en_US" />
<link rel="separator" href="-" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="pingback" href="https://webmention.io/rossta.net/xmlrpc" />
    <link rel="webmention" href="https://webmention.io/rossta.net/webmention" />
    <link rel="canonical" href="https://rossta.net/blog/when-your-fat-models-need-to-go-on-a-diet.html" />
    <script type="application/ld+json">
      {"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":"Ross Kaffenberger"},"author":{"@type":"Person","name":"Ross Kaffenberger","image":{"@type":"ImageObject","url":"https://rossta.net/assets/images/me.jpg","width":400,"height":400},"url":"https://rossta.net","sameAs":["https://rossta.net/about/","https://twitter.com/rossta"]},"headline":"When Your Fat Models Need to Go on a Diet","url":{"scheme":"https","user":null,"password":null,"host":"rossta.net","port":null,"path":"/blog/when-your-fat-models-need-to-go-on-a-diet.html","query":null,"fragment":null},"datePublished":"2011-09-30T00:00:00Z","keywords":"ruby, rails","description":"Thoughts on refactoring large model classes in Rails","mainEntityOfPage":{"@type":"WebPage","@id":"https://rossta.net"}}
    </script>


    <link rel="stylesheet" href="/css/app.f7bb33b95ea908b47d5f.css" media="all"></link>
    <script async defer data-domain="rossta.net" src="https://plausible.io/js/plausible.outbound-links.js"></script>
  </head>
  <body id="application" class="leading-relaxed">
    <header id="welcome-nav" class="top-bar text-gray-800 sm:flex sm:justify-between sm:items-center sm:px-4 sm:py-3" data-topbar>
  <div class="flex justify-between items-center px-4 py-3 sm:p-0">
    <h1 class="text-2xl font-bold">
      <a class="logo" href="/"><span>rossta.net</span></a>
    </h1>
    <button type="button" aria-label="Menu" class="top-bar-menu-button sm:hidden block text-gray-500 hover:text-gray-700 focus:text-gray-700 focus:outline-none">
      <svg class="h-6 w-6 fill-current" viewBox="0 0 24 24">
        <path class="icon" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/>
        <path class="icon hidden" d="M18.278 16.864a1 1 0 0 1-1.414 1.414l-4.829-4.828-4.828 4.828a1 1 0 0 1-1.414-1.414l4.828-4.829-4.828-4.828a1 1 0 0 1 1.414-1.414l4.829 4.828 4.828-4.828a1 1 0 1 1 1.414 1.414l-4.828 4.829 4.828 4.828z"/>
      </svg>
    </button>
  </div>
  <nav class="top-bar-section hidden sm:block sm:flex sm:justify-around px-2 pt-2 pb-4">
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/archive/">archive</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/about/">about</a>
    <a class="block px-2 py-1 hover:bg-green-200 sm:mt-0 sm:ml-2 mt-1" href="/feed.xml">feed</a>
  </nav>
</header>

    <main id="main" role="main" class="layout container">
        <article class="post mb-12">
    <header class="page-header mt-4">
  <h1>
    When Your Fat Models Need to Go on a Diet
  </h1>
    <h2 class="mt-4 text-gray-600 font-medium">
      Thoughts on refactoring large model classes in Rails
    </h2>
</header>

    <p>Most Rails apps I’ve worked on have followed the pattern “<a href="http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model" target="_blank" rel="noopener noreferrer">skinny controllers, fat models</a>.” The controller shouldn’t have know what attributes and joins to make when asking for data from the models; one line methods calls in controller actions are a thing of beauty. Controller specs are simplified and the complexity of business logic and database access can be stuffed into the models. Fatten’ up those models!</p>

<p>But what happens when your models grow too large? It’s common to have one or two models (Users and Groups, anyone?) carry a large burden. Over time, we see Ruby files approaching and surpassing thousands of lines and their associated tables accumulating column excess. Before you know it, it’s time to put your models on a diet. It’s useful to have some patterns in your tool-belt to start trimming the fat.</p>

<p>A good refactoring step is to pull out modules of related behavior. In the User model, for example, we might extract modules for related instance methods, associations and validations for functional scopes like admin access or group memberships. I prefer to namespace the modules under UserExtensions so it’s clear, at least in this case, that these are meant for composition of the User model rather than for sharing code across objects. Now ActiveSupport::Concern makes it super-simple to define both instance and class methods in your module and ensure they’re included properly. (Some good reading on <a href="http://yehudakatz.com/2009/11/12/better-ruby-idioms/" target="_blank" rel="noopener noreferrer">better ruby idioms</a> for <a href="http://www.fakingfantastic.com/2010/09/20/concerning-yourself-with-active-support-concern/" target="_blank" rel="noopener noreferrer">mixing in class and instance methods</a>).</p>

<p>One convention is to place the modules in “#{model_name}_extensions” folders in your app/models directory to group the code logically. For example, UserExtensions::Admin would be located at app/models/user_extensions/admin.rb. Breaking out the code in to functional chunks like this is a good first step in downsizing your model files. It also more easily allows methods and associations to be extracted into other classes/tables.</p>

<p>Added: Check out <a href="/when-your-fat-models-need-to-go-on-a-diet-part-2/">part 2</a> of this post for thoughts on slimming down our models at runtime.</p>

  </article>
  <section class="mb-12">
    <p class="text-right">
      <a href="https://twitter.com/intent/tweet?text=When%20Your%20Fat%20Models%20Need%20to%20Go%20on%20a%20Diet%20-%20rossta.net&amp;url=https%3A%2F%2Frossta.net%2Fblog%2Fwhen-your-fat-models-need-to-go-on-a-diet.html" class="font-bold" target="_blank" rel="noopener noreferrer">Discuss it on Twitter</a>
      &middot;
      <span class="italic font-light">
        Published on Sep 30, 2011
      </span>
    </p>
  </section>
  <section class="signup-form-standalone hero">
    <script src="https://f.convertkit.com/ckjs/ck.5.js" async></script>
<form
  action="https://app.convertkit.com/forms/1268949/subscriptions?ref=Ruby"
  class="seva-form formkit-form"
  method="post"
  data-sv-form="1268949"
  data-uid="cda82aafbf"
  data-format="inline"
  data-version="5"
  data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;Success! Now check your email to confirm your subscription.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:&quot;300&quot;,&quot;devices&quot;:null,&quot;show_once_every&quot;:&quot;7&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:null,&quot;trigger&quot;:null,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:null,&quot;devices&quot;:null,&quot;show_once_every&quot;:null}}}"
>
  <div>
    <div class="mb-4">
      <h3 class="mb-2">
  Join the Newsletter
</h3>
<p>
  Subscribe to get an occasional email about web development and Rails. Thank you!
</p>

    </div>
    <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul>
    <div data-element="fields" data-stacked="false" class="seva-fields formkit-fields">
      <div class="formkit-field">
        <label for="email_address" class="sr-only">Email address</label>
        <input
          class="formkit-input"
          id="email_address"
          name="email_address"
          placeholder="Your email address"
          required=""
          type="email"
          style="border-color: rgb(227, 227, 227); border-radius: 4px; color: rgb(0, 0, 0); font-weight: 400;"
        />
      </div>
      <button
        data-element="submit"
        class="formkit-submit button button-green"
      >
        <div class="formkit-spinner">
          <div></div>
          <div></div>
          <div></div>
        </div>
        <span>Subscribe</span>
      </button>
    </div>
  </div>
  <style>
  </style>
    <input type="hidden" name="tags[]" value="733960" />
    <input type="hidden" name="tags[]" value="733966" />
  <input type="hidden" aria-label="URL" name="fields[url]" placeholder="URL" value="https://rossta.net/blog/when-your-fat-models-need-to-go-on-a-diet.html" />
</form>


  </section>
  <section class="index-posts mb-24">
    <h2 class="mb-8">More posts</h2>
      <article class="index-post">
    <header class="index-title">
      <a href="/archive/how-to-test-features-with-rails-caching-in-rspec.html">How to Test Features with Rails Caching in RSpec</a>
    </header>
      <p>Learn how to use RSpec metadata to add declarative ways to toggle features like Rails caching during test runs</p>
  </article>
  <article class="index-post">
    <header class="index-title">
      <a href="/archive/when-your-fat-models-need-to-go-on-a-diet-part-2.html">When Your Fat Models Need to Go on a Diet, Part 2</a>
    </header>
      <p>More thoughts on refactoring large model classes in Rails</p>
  </article>
  <article class="index-post">
    <header class="index-title">
      <a href="/archive/when-your-fat-models-need-to-go-on-a-diet.html">When Your Fat Models Need to Go on a Diet</a>
    </header>
      <p>Thoughts on refactoring large model classes in Rails</p>
  </article>

  </section>
  <article class="mb-24">
      <figure>
        <img src="/assets/images/blog/stock/logs-pexels-photo.jpg" loading="lazy" alt="" />
      </figure>
  </article>
    <!-- Webpack on Rails course popup form -->
    <script async data-uid="92c0bd55d0" src="https://little-fog-6985.ck.page/92c0bd55d0/index.js"></script>

    </main>
    <footer class="bg-silver text-xs">
  <div class="layout container p-6">
    <img src="/assets/images/turtle-logo.svg" loading="lazy" class="turtle w-8 mb-6" alt="" />
    <section class="lg:flex lg:justify-between">
      <section class="mb-8">
        <h5 class="font-bold mb-4">Most Popular</h5>
        <ul>
            <li class="mb-1"><a href="/archive/why-does-rails-install-both-webpacker-and-sprockets.html">Why does Rails 6 include both Webpacker and Sprockets?</a></li>
            <li class="mb-1"><a href="/archive/reasons-to-switch-to-webpacker.html">25 reasons to switch to Webpack(er)</a></li>
            <li class="mb-1"><a href="/archive/webpacker-with-bootstrap.html">Using Bootstrap with Rails Webpacker</a></li>
            <li class="mb-1"><a href="/archive/importing-images-with-webpacker.html">Importing images with Webpacker</a></li>
            <li class="mb-1"><a href="/archive/from-sprockets-to-webpack.html">How we switched from Sprockets to Webpacker</a></li>
        </ul>
      </section>
      <section class="mb-8">
        <h5 class="font-bold mb-4">
          <a class="text-gray-900 hover:text-gray-700" href="blog/tags.html">
            Categories
          </a>
        </h5>
        <ul>
            <li class="mb-1"><a href="/archive/tags/rails.html">Rails</a></li>
            <li class="mb-1"><a href="/archive/tags/ruby.html">Ruby</a></li>
            <li class="mb-1"><a href="/archive/tags/javascript.html">JavaScript</a></li>
        </ul>
      </section>
      <section class="mb-8">
        <h5 class="font-bold mb-4">Contact</h5>
        <ul>
          <li class="mb-1"><a target="_blank" href="mailto:ross@rossta.net" rel="me noopener nofollow">email</a></li>
          <li class="mb-1"><a target="_blank" href="https://twitter.com/rossta" rel="me noopener nofollow">twitter</a></li>
          <li class="mb-1"><a target="_blank" href="https://github.com/rossta" rel="me noopener nofollow">github</a></li>
          <li class="mb-1"><a target="_blank" href="https://www.linkedin.com/in/rosskaffenberger" rel="me noopener nofollow">linkedin</a></li>
          <li class="mb-1"><a target="_blank" href="https://stackoverflow.com/users/771838/rossta?tab=profile" rel="me noopener nofollow">stackoverflow</a></li>
        </ul>
      </section>
    </section>
    <p class="copyright text-center text-xs font-light">
      © 2023 Ross Kaffenberger. All rights reserved.
    </p>
  </div>
</footer>

    <script src="/js/runtime.ab3e4b5316b2997723cc.js"></script>"<script src="/js/app.d1ef27c9a26cf7bc4240.js"></script>"
    
  </body>
</html>
