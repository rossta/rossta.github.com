<!doctype html>
<html>
  <head>
    <title>How to specify local Ruby gems in your Gemfile - rossta.net</title>
<meta name="description" content="Use the &quot;bundle config&quot; command to develop against local Ruby gems instead of following the typical advice to specify the :path option in your Gemfile." />
<meta name="keywords" content="Code, Ruby, Process" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="Use the &quot;bundle config&quot; command to develop against local Ruby gems instead of following the typical advice to specify the :path option in your Gemfile." />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/stock/jellyfish-pexels-photo-15935942.jpeg" />
<meta name="twitter:title" content="How to specify local Ruby gems in your Gemfile" />
<meta property="og:description" content="Use the &quot;bundle config&quot; command to develop against local Ruby gems instead of following the typical advice to specify the :path option in your Gemfile." />
<meta property="og:image" content="https://rossta.net/assets/images/blog/stock/jellyfish-pexels-photo-15935942.jpeg" />
<meta property="og:title" content="How to specify local Ruby gems in your Gemfile" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href="/assets/stylesheets/index.bundle-6ed94a3f.css" rel="stylesheet" />
    <script src="/assets/javascripts/head.bundle-ae1a9d85.js"></script>
    <link href="/assets/images/favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body id="application" class="typekit">
    <nav id="welcome-nav" class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a class="logo" href="/">rossta.net</a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="nav"><a href="/blog">blog</a></li>
      <li class="nav"><a href="/talks">talks</a></li>
      <li class="nav"><a href="/projects">projects</a></li>
      <li class="nav"><a href="/about">about</a></li>
      <li class="nav"><a href="/feed.xml">feed</a></li>
    </ul>
  </section>
</nav>

    <div class="row">
      <section id="main" role="main" class="large-12 small-12 columns">
          <section id="blog" class="margin-bottom double">
    <article class="post margin-bottom double">
      <header class="page-header with-summary">
  <h1>
    How to specify local Ruby gems in your Gemfile
  </h1>
    <h3>
      Stop adding :path in your Gemfile and use bundle config instead
    </h3>
</header>

        <p><img src="/assets/images/blog/stock/jellyfish-pexels-photo-15935942.jpeg" /></p>

      <p>Let&rsquo;s say you&rsquo;re building a Ruby app and your team has extracted one or more
gems referenced in your Gemfile, such as your custom Trello API client, <a href="https://github.com/rossta/tacokit.rb">Tacokit.rb</a>.</p>

<pre><code class="ruby"># Gemfile
source &quot;https://rubygems.org&quot;

# lots of gems ...

gem &quot;tacokit&quot;
</code></pre>

<p>Maybe Trello made some recent changes to their API that your current feature depends
on, so you need to update the <code>Tacokit</code> gem as part of your work. You have a
local checkout of the <code>tacokit</code> gem in another directory in your laptop.</p>

<p>You add some code to the gem, but now you want to test the changes in your app. How do you do that?</p>

<p>According to <em><a href="http://stackoverflow.com/questions/4487948/how-can-i-specify-a-local-gem-in-my-gemfile#answer-4488110">the most popular answer (and accepted) answer</a></em> to the question, <a href="http://stackoverflow.com/questions/4487948/how-can-i-specify-a-local-gem-in-my-gemfile">&ldquo;How can I specify a local gem in my Gemfile?&rdquo;</a>, we should do the following:</p>

<pre><code class="ruby">gem &quot;tacokit&quot;, path: &quot;/path/to/tacokit&quot;
</code></pre>

<p>Here&rsquo;s my take on this approach: <strong>it&rsquo;s wrong</strong>.</p>

<p>&hellip;especially if you work on a team and/or deploy this code to remote servers.</p>

<h2>WAT</h2>

<p>Technically, it does work. Run <code>$ bundle update</code>, restart the app, and - boom! - our changes in
the local <code>tacokit</code> checkout are showing up as expected.</p>

<p>Then the trouble begins.</p>

<p>We push our app changes and deploy to the staging server to test them out
in the shared environment and - wait a minute - the app won&rsquo;t even start.</p>

<pre><code class="sh">$ bundle
The path `/Users/ross/does/not/exist` does not exist.
</code></pre>

<p>Oops! We forgot to remove the <code>:path</code> reference in the <code>Gemfile</code>.</p>

<p>Let&rsquo;s fix that&hellip; we remove the <code>:path</code> reference, push, and redeploy. The app
restarts fine. But while testing the feature, we start getting 500 errors. This wasn&rsquo;t happening locally.</p>

<blockquote>
<p>&ldquo;But it worked on my machine!&rdquo; - <em>every developer ever</em></p>
</blockquote>

<p>The Rails logs reveal we have a bunch of undefined method errors coming from calls to <code>Tacokit</code>. That&rsquo;s right, we forgot another key step in this workflow: pushing our local <code>Tacokit</code> changes to the remote!</p>

<p>OK, after we&rsquo;ve done that and redeployed the app, we&rsquo;re still getting 500 errors.</p>

<p>D&#39;oh! We were working on a <em>branch</em> of <code>tacokit</code> but we reference it in our app&rsquo;s <code>Gemfile</code>.</p>

<h2>Taking a step back</h2>

<p>Good thing we weren&rsquo;t pushing that app feature to production. We would have been wise to run the tests on our CI server first where we would have seen the same errors (assuming we had the right tests&hellip; and a CI server).</p>

<p>Using the <code>:path</code> often means pointing to a location that only exists on our local machine. Every time we want to develop against the local <code>tacokit</code> gem, we have to remember to edit the <code>Gemfile</code> to remove the option so we don&rsquo;t screw up our teammates or break the build. We also can&rsquo;t forget to point to correct branch.</p>

<p>This workflow is no good because we&rsquo;re human and humans tend to forget to do things.</p>

<h2>&ldquo;bundle config local&rdquo; to the rescue</h2>

<p>Buried deep in the Bundler docs is a better solution for <a href="http://bundler.io/git.html#local">working with local git repo</a>: the <code>bundle config local</code> command. Instead of specifying the <code>:path</code> option, we can run the following on command line:</p>

<pre><code class="sh">$ bundle config local.tacokit /path/to/tacokit
</code></pre>

<p>Here we instruct Bundler to look in a local resource by modifying our local Bundler configuration. That&rsquo;s the one that lives in
<code>.bundle/config</code> outside of version control.</p>

<p><strong>No more editing shared code for local development settings.</strong></p>

<p>We can confirm the link with <code>bundle config</code>:</p>

<pre><code class="sh">$ bundle config
Settings are listed in order of priority. The top value will be used.
local.tacokit
Set for your local app (/Users/rossta/.bundle/config): &quot;/Users/rossta/path/to/tacokit&quot;
</code></pre>

<p>We can scope the configuration to a specific folder with the <code>--local</code> flag:</p>

<pre><code class="sh">$ bundle config --local local.tacokit /path/to/tacokit
$ bundle config
Settings are listed in order of priority. The top value will be used.
local.tacokit
Set for your local app (/Users/rossta/path/to/app/.bundle/config): &quot;/Users/rossta/path/to/tacokit&quot;
</code></pre>

<p>To take advantage of this local override in the app, we have to specify the remote repo and branch in the <code>Gemfile</code>:</p>

<pre><code class="ruby">gem &quot;tacokit&quot;, github: &quot;rossta/tacokit&quot;, branch: &quot;master&quot;
</code></pre>

<p>Bundler will abort if the local gem branch doesn&rsquo;t match the one in the <code>Gemfile</code> and checks that the sha in Gemfile.lock exists in the local repository.</p>

<p><strong>This way we ensure our Gemfile.lock contains a valid reference to our local gem.</strong></p>

<p>We don&rsquo;t get these assertions when using the <code>:path</code> option.</p>

<p>It&rsquo;s easy to remove the local config after we don&rsquo;t need it:</p>

<p><code>bundle config --delete local.YOUR_GEM_NAME</code></p>

<h3>Caveats</h3>

<p>As with the <code>:path</code> option, we still need to remember to push our
local gem changes to the remote repository when using <code>bundle config local</code>.</p>

<p>I should also mention that a good use case for using <code>:path</code> instead of <code>bundle
config local</code> it when the local gem is in a subdirectory relative to your app.
I don&rsquo;t often see this in practice, but there are valid reasons for doing so.</p>

<h2>Don&rsquo;t use :path, use bundle config local instead</h2>

<p>Though convenient, using the <code>:path</code> option in our <code>Gemfile</code> to point to a local
gem elsewhere on our machine sets us up for three potential problems without automated prevention:</p>

<ul>
<li>Committing a nonexistent lookup path on other machines</li>
<li>Failing to point to the correct repository branch</li>
<li>Failing to push local changes to the remote</li>
</ul>

<p>Forget the <code>:path</code> option and you&rsquo;ll never forget ^^this stuff^^ again.</p>

<p>Just use this command:</p>

<pre><code class="sh">bundle config local.YOUR_GEM_NAME`
</code></pre>

<p>And don&rsquo;t believe everything you read on StackOverflow.</p>


    </article>
    <hr />
    <section class="margin-bottom double">
      <p>
        If you liked this post, <a target="_blank" href="https://twitter.com/intent/tweet?text=How%20to%20specify%20local%20Ruby%20gems%20in%20your%20Gemfile%20-%20rossta.net&amp;url=rossta.net%3A4567%2Fblog%2Fhow-to-specifiy-local-ruby-gems-in-your-gemfile.html">share it on Twitter</a>
        and <a href="https://twitter.com/rossta">follow me</a>.
      </p>
      <p>
        Published on Apr 23, 2016
      </p>
    </section>
  </section>
  <section class="share margin-bottom double">
  </section>
  <section class="signup-form-standalone margin-bottom double">
    <!-- Begin MailChimp Signup Form -->
<div class="signup-form">
  <h3>Stop Wrangling with Rails</h3>
  <p>Sign up for my occasional newsletter on professional Ruby and Javascript for the web.</p>
  <div id="mc_embed_signup">
    <form action="//rossta.us6.list-manage.com/subscribe/post?u=8ce159842b5c98cecb4ebdf16&amp;id=96030b0bda" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">

        <div class="row">
          <div class="large-10 columns">
            <div class="row collapse">
              <div class="large-8 small-7 columns">
                <input type="email" placeholder="Your email..." value="" name="EMAIL" class="required email" id="mce-EMAIL">
              </div>
              <div class="large-4 small-5 columns">
                <input type="submit" value="Sign me up!" name="subscribe" id="mc-embedded-subscribe" class="button postfix">
              </div>
            </div>
          </div>
        </div>

        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;"><input type="text" name="b_8ce159842b5c98cecb4ebdf16_96030b0bda" tabindex="-1" value=""></div>
      </div>
    </form>
  </div>

  <!--End mc_embed_signup-->
</div>

  </section>
    <hr />
    <section class="comments">
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname  = "rosskaff";
    var disqus_identifier = "how-to-specifiy-local-ruby-gems-in-your-gemfile";
    var disqus_title      = "How to specify local Ruby gems in your Gemfile";
    var disqus_url        = "https://rossta.net/blog/how-to-specifiy-local-ruby-gems-in-your-gemfile.html";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->

    </section>

      </section>
    </div>
    
    <div class="row">
      <footer>
        <section class="large-12 columns center-inline-list">
          <ul class="inline-list">
  <li><a href="mailto:ross@rossta.net">email</a></li>
  <li><a href="https://twitter.com/rossta">twitter</a></li>
  <li><a href="https://github.com/rossta">github</a></li>
  <li><a href="https://stackoverflow.com/users/771838/rossta?tab=profile">stackoverflow</a></li>
  <li><a href="https://www.linkedin.com/in/rosskaffenberger">linkedin</a></li>
</ul>

        </section>
      </footer>
    </div>
    <script src="/assets/javascripts/index.bundle-000158ba.js"></script>
    
    <script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("NdBtrprkAGAjQryMShljRdVf90saElAU");
analytics.page()
window.$.tracking.flush(analytics);
}}();
</script>

  </body>
</html>
