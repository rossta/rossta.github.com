<!doctype html>
<html>
  <head>
    <title>What the Heck is a Ruby Enumerator? - rossta.net</title>
<meta name="description" content="You may not be using enough of the Enumerable API or doing enough with Enumerator." />
<meta name="keywords" content="Ruby" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="You may not be using enough of the Enumerable API or doing enough with Enumerator." />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/enumerator-1-2-3-b7cfed08.jpg" />
<meta name="twitter:title" content="What the Heck is a Ruby Enumerator?" />
<meta property="og:description" content="You may not be using enough of the Enumerable API or doing enough with Enumerator." />
<meta property="og:image" content="https://rossta.net/assets/images/blog/enumerator-1-2-3-b7cfed08.jpg" />
<meta property="og:title" content="What the Heck is a Ruby Enumerator?" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon"     href="/apple-touch-icon.png" />
    <link rel="icon"                 href="/touch-icon-192x192.png" />
    <link rel="icon" sizes="192x192" href="/touch-icon-192x192.png" />
    <link rel="icon" sizes="144x144" href="/touch-icon-144x144.png" />
    <link rel="icon" sizes="96x96"   href="/touch-icon-96x96.png" />
    <link rel="icon" sizes="72x72"   href="/touch-icon-72x72.png" />

    <link rel="pingback" href="https://webmention.io/rossta.net/xmlrpc" />
    <link rel="webmention" href="https://webmention.io/rossta.net/webmention" />

    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href="/assets/stylesheets/app.bundle-6062734b.css" rel="stylesheet" />
    <link href="/assets/images/turtle-favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body id="application" class="typekit">
    <nav id="welcome-nav" class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a class="logo" href="/"><img src="/assets/images/turtle-logo-096698b6.svg" alt="Turtle logo" /><span>rossta.net</span></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="nav"><a href="/blog">blog</a></li>
      <li class="nav"><a href="/series">series</a></li>
      <li class="nav"><a href="/talks">talks</a></li>
      <li class="nav"><a href="/projects">projects</a></li>
      <li class="nav"><a href="/about">about</a></li>
      <li class="nav"><a href="/feed.xml">feed</a></li>
    </ul>
  </section>
</nav>

    <div class="row">
      <section id="main" role="main" class="large-12 small-12 columns">
          <section id="blog" class="margin-bottom double">
    <article class="post margin-bottom double">
      <header class="page-header with-summary">
  <h1>
    What the Heck is a Ruby Enumerator?
  </h1>
    <h3>
      Exploring Ruby Enumerators for fun and profit
    </h3>
</header>

        <figure>
          <img src="/assets/images/blog/enumerator-1-2-3-b7cfed08.jpg" alt="Enumerator 1 2 3" />
        </figure>
      <p>Let&#39;s pretend we know about Ruby&#39;s <a href="http://ruby-doc.org/core-2.2.3/Enumerable.html">Enumerable</a> module - that it&#39;s included in
Ruby&#39;s core collection classes like Array and Hash and provides a bunch of
methods for traversal, searching and sorting, and that we can can introduce it
to plain old ruby classes through inclusion and implementing the <code>#each</code> method.
Check out this <a href="http://ruby.bastardsbook.com/chapters/enumerables/">dated - yet reliable - Enumerable primer</a> if you&#39;d like a refresher.</p>

<p><a href="http://ruby-doc.org/core-2.2.0/Enumerator.html">Enumerator</a> is like <code>Enumerable&#39;s</code> kid sister; while <code>Enumerable</code> is getting all the attention, <code>Enumerator</code>, having borrowed many traits of her sibling, can do lots of amazing things in her own way and really should get more credit. Well, it&#39;s time you took notice, Ma.</p>

<p>So what exactly is <code>Enumerator</code>?. For one, it&#39;s a class. You can instantiate an
instance of <code>Enumerator</code> by calling certain <code>Enumerable</code> instance methods, like <code>Array#each</code>, without a block:</p>

<pre><code class="ruby">[1, 2, 3].each
=&gt; #&lt;Enumerator: [1, 2, 3]:each&gt;
</code></pre>

<p>In fact, you can do this for many (but not all) of Array&#39;s <code>Enumerable</code> methods
that expect a block:</p>

<pre><code class="ruby">[1, 2, 3].map
=&gt; #&lt;Enumerator: [1, 2, 3]:map&gt;

[1, 2, 3].select
=&gt; #&lt;Enumerator: [1, 2, 3]:select&gt;

[1, 2, 3].reduce
LocalJumpError: no block given
</code></pre>

<p>Okay, big deal. What does this get us? Glad you asked.</p>

<p>Instances of Enumerator are enumerable:</p>

<pre><code class="ruby">e = [1, 2, 3].map
e.each { |n| p n }
1
2
3
=&gt; [nil, nil, nil]
</code></pre>

<p>See what happened there? The expression printed out each digit, but returned <code>[nil, nil, nil]</code> instead of of <code>[1, 2, 3]</code>. The <code>Enumerator</code> implemented <code>map</code> in the context of <code>each</code>; since <code>p n</code> returns <code>nil</code>, we got three entries of <code>nil</code> in the return value. We chained the behavior of two enumerable methods.</p>

<p>Here&#39;s another example. It&#39;s often useful to enumerate collection members along
with the index. We can use <code>Enumerable#each_with_index</code>, we don&#39;t have
<code>Enumerable#map_with_index</code>. JavaScript <code>forEach</code> and <code>map</code> gets this right, but not Ruby... or does it?</p>

<p>Almost - we can chain enumerators together to get effectively the same result:</p>

<pre><code class="ruby">e = [1, 2, 3].map
e.each_with_index { |n, i| n * i }
=&gt; [0, 2, 6]
</code></pre>

<p>The block receives each member of the original array along with its index
for each iteration. This usage is common enough, that <code>Enumerator</code> provides
<code>with_index</code> to give:</p>

<pre><code class="ruby">e = [1, 2, 3].map.with_index { |n, i| n * i }
=&gt; [0, 2, 6]
</code></pre>

<p>Reads pretty well, eh? What&#39;s really interesting here is that enumerators package
up knowledge of a collection and a method with which we want to enumerate.</p>

<p>We can combine several enumerators in different orders to get different
behaviors. Here&#39;s an nice example borrowed from <a href="http://dgiim.github.io/blog/2015/08/24/ruby-enumerators/#the-enumerator-class">another recent post on the subject</a>:</p>

<pre><code class="ruby">letters = %w[a b c d e]

group_1 = letters.reverse_each.group_by.each_with_index do |item, index|
  index % 3
end

group_2 = letters.reverse_each.each_with_index.group_by do |item, index|
  index % 3
end

p group_1
=&gt; {0=&gt;[&quot;e&quot;, &quot;b&quot;], 1=&gt;[&quot;d&quot;, &quot;a&quot;], 2=&gt;[&quot;c&quot;]}

p group_2
=&gt; {0=&gt;[[&quot;e&quot;, 0], [&quot;b&quot;, 3]], 1=&gt;[[&quot;d&quot;, 1], [&quot;a&quot;, 4]], 2=&gt;[[&quot;c&quot;, 2]]}
</code></pre>

<p><code>Enumerator</code> provides some additional methods that allow for &quot;external&quot;
enumeration as well. With an enumerator instance, we can call <code>next</code> to get each
successive member of the collection.</p>

<p>Consider <code>Enumerable#cycle</code>. Calling &quot;cycle&quot; on an enumerable collection (without a limit arg) will enumerate over members of a collection ad nauseum. When implemented as an enumerator of css colors, we can use <code>cycle</code> to create striped table rows:</p>

<pre><code class="ruby">Project = Struct.new(:name)

colors = [&#39;aliceblue&#39;, &#39;ghostwhite&#39;].cycle
projects = [Project.new(&quot;TODO&quot;),
            Project.new(&quot;Work&quot;),
            Project.new(&quot;Home&quot;)]

require &#39;erb&#39;

erb = (&lt;&lt;-ERB)
&lt;table&gt;
&lt;% projects.each_with_index do |project, index| %&gt;
 &lt;tr style=&quot;background: &lt;%= colors.next %&gt;&quot;&gt;
   &lt;td&gt;&lt;%= index + 1 %&gt;&lt;/td&gt;
   &lt;td&gt;&lt;%= project.name %&gt;&lt;/td&gt;
 &lt;/tr&gt;
&lt;% end %&gt;
&lt;/table&gt;
ERB

p ERB.new(erb).result(binding).gsub(/^$\n/, &quot;&quot;)

=&gt; &#39;&lt;table&gt;
 &lt;tr style=&quot;background: aliceblue&quot;&gt;
   &lt;td&gt;1&lt;/td&gt;
   &lt;td&gt;TODO&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr style=&quot;background: ghostwhite&quot;&gt;
   &lt;td&gt;2&lt;/td&gt;
   &lt;td&gt;Work&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr style=&quot;background: aliceblue&quot;&gt;
   &lt;td&gt;3&lt;/td&gt;
   &lt;td&gt;Home&lt;/td&gt;
 &lt;/tr&gt;
&lt;/table&gt;&#39;
</code></pre>

<p>Brilliant! Notice how, in each enumeration of <code>project</code>, we&#39;re calling <code>colors.next</code>. So external enumeration is one technique for enumerating more than one collection at a time.</p>

<p>Not all enumerators will enumerate forever. Using cycle with a limit will result
in a <code>StopIteration</code> error:</p>

<pre><code class="ruby">numbers = [1,2].cycle(1)
=&gt; #&lt;Enumerator: [1, 2]:cycle(1)&gt;

numbers.next
# =&gt; 1

numbers.next
=&gt; 2

numbers.next
StopIteration: iteration reached an end
</code></pre>

<p>The <code>loop</code> construct knows how to rescues from this error and treats it as a
<code>break</code>:</p>

<pre><code class="ruby">numbers = [1,2].cycle(1)
=&gt; #&lt;Enumerator: [1, 2]:cycle(1)&gt;

loop do
  p numbers.next
end

puts &quot;Tada!&quot;

1
2
=&gt; nil

Tada!
=&gt; nil
</code></pre>

<p>We can rewind enumerators or peek at their next values:</p>

<pre><code class="ruby">e = [1, 2, 3].each

e.next
=&gt; 1

e.peek
=&gt; 2

e.next
=&gt; 2

e.rewind
=&gt; #&lt;Enumerator: [1, 2, 3]:each&gt;

e.next
=&gt; 1
</code></pre>

<p>So enumerators give us flexible and composable uses for enumerables. Combine them to extend behavior of existing enumerable methods. Use them for external enumeration with methods like <code>#next</code> and <code>#peek</code> for iterating over multiple arrays. In a future post, we&#39;ll take a look at how to create our own enumerators outside the context of arrays and hashes and some good reasons for doing so.</p>

<p>In case you missed it, <a href="blog/ruby-enumerable.html">check out my presentation in the previous post</a> on the <code>Enumerable</code> module for more examples on how to get the most out of this terrific Ruby module.</p>

    </article>
    <section class="margin-bottom double">
      <a href="https://twitter.com/intent/tweet?text=What%20the%20Heck%20is%20a%20Ruby%20Enumerator%3F&amp;url=https%3A%2F%2Frossta.net%2Fblog%2Fwhat-is-enumerator.html" class="button" target="_blank" rel="noopener">Share this post on Twitter</a>
    </section>
    <section class="signup-form-standalone margin-bottom quadruple">
      <!-- Begin MailChimp Signup Form -->
<div class="signup-form">
  <h3>Did you like this post?</h3>
  <p>Stay in the LOOP! Leave your email and I'll send you an occasional email on Ruby, Javascript, or Elixir for the web.</p>
  <div id="mc_embed_signup">
    <form action="//rossta.us6.list-manage.com/subscribe/post?id=96030b0bda&u=8ce159842b5c98cecb4ebdf16" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">

        <div class="row">
          <div class="large-10 columns">
            <div class="row collapse">
              <div class="large-8 small-7 columns">
                <input type="email" placeholder="Your email..." value="" name="EMAIL" class="required email" id="mce-EMAIL">
              </div>
              <div class="large-4 small-5 columns">
                <input type="submit" value="Sign me up!" name="subscribe" id="mc-embedded-subscribe" class="button postfix">
              </div>
            </div>
          </div>
        </div>

        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;"><input type="text" name="b_8ce159842b5c98cecb4ebdf16_96030b0bda" tabindex="-1" value=""></div>
      </div>

      <input type="hidden" name="SIGNUP" value="https://rossta.net/blog/2015-11-18-what-is-enumerator.html" />
      <input type="hidden" name="SIGNUP_APP" value="Mailchimp" />
      <input type="hidden" name="SIGNUP_LOCATION" id="signup_location" value="blog/2015-11-18-what-is-enumerator.html" />
      <input type="hidden" name="SIGNUP_TAGS" id="signup_tags" value="Ruby" />
    </form>
  </div>
  <!--End mc_embed_signup-->
</div>

    </section>
    <section class="margin-bottom double">
      <p>
          Part of the <a href="/blog/series/enumerable.html">Enumerable</a> series.
        Published on Nov 18, 2015
      </p>
    </section>
  </section>
    <hr />
    <section class="comments">
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname  = "rosskaff";
    var disqus_identifier = "what-is-enumerator";
    var disqus_title      = "What the Heck is a Ruby Enumerator?";
    var disqus_url        = "https://rossta.net/blog/what-is-enumerator.html";

    var disqus_config = function () {
        this.page.url = disqus_url;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = disqus_identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.title = disqus_title;
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//rosskaff.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->

    </section>

      </section>
    </div>
    
    <footer>
  <div class="row">
    <img src="/assets/images/turtle-logo-096698b6.svg" class="turtle" alt="Turtle logo" />
    <section class="large-6 columns">
      <h5>Most Popular</h5>
      <ul>
          <li><a href="/blog/web-push-notifications-from-rails.html">Sending Web Push Notifications from Rails</a></li>
          <li><a href="/blog/n+1-is-a-rails-feature.html">N+1 is a Rails feature</a></li>
          <li><a href="/blog/what-i-learned-about-hanami.html">What I learned building an app in Hanami</a></li>
          <li><a href="/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">How to specify local Ruby gems in your Gemfile</a></li>
          <li><a href="/blog/service-worker-on-rails.html">Service Worker on Rails</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Categories</h5>
      <ul>
          <li><a href="/blog/tags/ruby.html">Ruby</a></li>
          <li><a href="/blog/tags/rails.html">Rails</a></li>
          <li><a href="/blog/tags/javascript.html">JavaScript</a></li>
          <li><a href="/blog/tags/service-worker.html">Service Worker</a></li>
          <li><a href="/blog/tags/rspec.html">RSpec</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Contact</h5>
      <ul>
        <li><a href="mailto:ross@rossta.net" rel="me noopener">email</a></li>
        <li><a href="https://twitter.com/rossta" rel="me noopener">twitter</a></li>
        <li><a href="https://medium.com/@rossta" rel="me noopener">medium</a></li>
        <li><a href="https://github.com/rossta" rel="me noopener">github</a></li>
        <!-- <li><a href="https://stackoverflow.com/users/771838/rossta?tab=profile" rel="me">stackoverflow</a></li> -->
        <li><a href="https://www.linkedin.com/in/rosskaffenberger" rel="me noopener">linkedin</a></li>
      </ul>
    </section>
  </div>
  <p class="copyright small subtle center">
    Â© 2017 Ross Kaffenberger. All rights reserved.
  </p>
</footer>

    <script src="/assets/javascripts/runtime.bundle-a9c6ad20.js"></script><script src="/assets/javascripts/vendor.bundle-49a537a2.js"></script><script src="/assets/javascripts/app.bundle-495dd3f6.js"></script>
    
    <script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("NdBtrprkAGAjQryMShljRdVf90saElAU");
analytics.page()
window.$.tracking.flush(analytics);
}}();
</script>

  </body>
</html>
