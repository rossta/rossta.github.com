<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>rossta.net</title>
  <subtitle>Ross Kaffenberger</subtitle>
  <id>https://rossta.net/</id>
  <link href="https://rossta.net/"/>
  <link href="https://rossta.net/feed.xml" rel="self"/>
  <updated>2020-09-08T00:00:00+00:00</updated>
  <entry>
    <title>These Rails apps are overpacking their JavaScript bundles</title>
    <link rel="alternate" href="/archive/rails-apps-overpacking-with-webpacker.html"/>
    <id>/archive/rails-apps-overpacking-with-webpacker.html</id>
    <published>2020-09-08T00:00:00+00:00</published>
    <updated>2020-09-08T00:00:00+00:00</updated>
    <author>
      <name>Ross Kaffenberger</name>
    </author>
    <summary type="html">&lt;p&gt;You might think dividing your JavaScript into multiple bundles will help improve page load performance. When done incorrectly with Webpacker, it's possible to make things worse.&lt;/p&gt;

&lt;p&gt;This mistake appears relatively common. As I'll share in this post, I...&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;You might think dividing your JavaScript into multiple bundles will help improve page load performance. When done incorrectly with Webpacker, it&amp;#39;s possible to make things worse.&lt;/p&gt;

&lt;p&gt;This mistake appears relatively common. As I&amp;#39;ll share in this post, I&amp;#39;ve discovered several of my favorite Rails applications are making browsers download and parse &lt;em&gt;more&lt;/em&gt; JavaScript than necessary even while attempting to send less.&lt;/p&gt;

&lt;p&gt;I believe Rails developers may think the mechanics of packaging JavaScript for the browsers work similarly in Webpacker as it does with the Rails asset pipeline. This assumption is fraught with peril!&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/crash.gif" alt="Crash bang warehouse accident" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;As we&amp;#39;ll see, Webpacker is a very different beast than the Rails asset pipeline. We need a different mental model to understand how it works. We should also follow a few basic guidelines to deliver JavaScript correctly and avoid falling victim to &amp;quot;bundle bloat.&amp;quot;&lt;/p&gt;

&lt;p&gt;First, let&amp;#39;s take a little safari and see what we can do to help a few companies correct their Webpacker usage out in the wild.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Help me help them&lt;/strong&gt;: &lt;em&gt;If you know anyone who works at any of the following companies, please share this post or ask them to reach out to me at ross at rossta dot net.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

      &lt;h2 id="case-study-podia" class="title title-h2"&gt;
        &lt;a name="case-study-podia" class="anchor" href="#case-study-podia"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Case study: Podia
      &lt;/h2&gt;
    
&lt;p&gt;Podia is a fantastic service that provides content creators with a platform to sell digital content, including e-books, online courses, and webinars.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/podia-homepage.png" alt="Podia homepage" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;We can tell Podia uses Webpacker to bundle assets because it renders a Webpacker manifest at &lt;code&gt;https://app.podia.com/packs/manifest.json&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="json"&gt;{
  &amp;quot;admin/ui.css&amp;quot;: &amp;quot;/packs/css/admin/ui-59291053.css&amp;quot;,
  &amp;quot;admin/ui.js&amp;quot;: &amp;quot;/packs/js/admin/ui-931ad01f76a9c8b4c1af.js&amp;quot;,
  &amp;quot;admin/ui.js.map&amp;quot;: &amp;quot;/packs/js/admin/ui-931ad01f76a9c8b4c1af.js.map&amp;quot;,
  &amp;quot;application.js&amp;quot;: &amp;quot;/packs/js/application-42b89cd8ec22763d95ae.js&amp;quot;,
  &amp;quot;application.js.map&amp;quot;: &amp;quot;/packs/js/application-42b89cd8ec22763d95ae.js.map&amp;quot;,
//...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The manifest contains URLs to many Webpacker &amp;quot;packs,&amp;quot; also described as &lt;a href="https://webpack.js.org/concepts/#entry" target="_blank" rel="noopener noreferrer"&gt;&lt;em&gt;entry points&lt;/em&gt; in the webpack docs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When I visit the public-facing storefront, my browser downloads the following &amp;quot;packs&amp;quot; from the Podia CDN:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;/packs/js/storefront/index-1d9e9c36f5f9ab7056d1.js
/packs/js/storefront/current_time_ago-0c5c682d173647ef3199.js
/packs/js/storefront/messaging-60ddf6567eb7b74a1083.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;By splitting JavaScript up across multiple files on this page, I believe Podia intends to deliver only required JavaScript to the client&amp;#39;s browser. For example, there&amp;#39;s no need to send JavaScript for the CMS UI to the public-facing storefront page.&lt;/p&gt;

&lt;p&gt;As we said earlier, the intent here is good.&lt;/p&gt;

      &lt;h2 id="the-problem" class="title title-h2"&gt;
        &lt;a name="the-problem" class="anchor" href="#the-problem"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        The problem
      &lt;/h2&gt;
    
&lt;p&gt;On closer look, though, something doesn&amp;#39;t seem quite right. The payloads for these individual packs are, in fact, rather large.&lt;/p&gt;

&lt;p&gt;Take the &amp;quot;storefront/current_time_ago.js&amp;quot; bundle. It transfers as 73KB gzipped and comes out to 396KB of parsed JavaScript.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Does Podia&amp;#39;s &amp;quot;storefront/current_time_ago&amp;quot; functionality need to be nearly 400KB?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;If so, I&amp;#39;d be shocked. I imagine this pack&amp;#39;s primary responsibility is similar to the tiny jQuery plugin &lt;a href="https://timeago.org/" target="_blank" rel="noopener noreferrer"&gt;timeago&lt;/a&gt;, which claims a 2KB size. As a comparison, a bundled version of &lt;code&gt;react-dom&lt;/code&gt; module parses at around ~150KB.&lt;/p&gt;

&lt;p&gt;Something&amp;#39;s not right here.&lt;/p&gt;

      &lt;h3 id="exploring-source-maps" class="title title-h3"&gt;
        &lt;a name="exploring-source-maps" class="anchor" href="#exploring-source-maps"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Exploring source maps
      &lt;/h3&gt;
    
&lt;p&gt;I don&amp;#39;t work at Podia, so I can&amp;#39;t use my favorite tool, &lt;a href="/blog/webpacker-output-analysis-with-webpack-bundle-analyzer.html"&gt;the webpack-bundle-analyzer&lt;/a&gt;, to peek inside the bundled JavaScript; this requires access to source code.&lt;/p&gt;

&lt;p&gt;But, there&amp;#39;s another trick we can use. We can find out what&amp;#39;s happening inside these bundles from Podia&amp;#39;s source maps.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;It&amp;#39;s like magic.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/magic.gif" alt="Corny magician gif" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Source maps are included in production by default with Webpacker. You can find the URLs to source maps in the Webpacker manifest file, as shown above.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If you&amp;#39;re curious about why source maps in production are enabled by default in Webpacker, you may be interested in &lt;a href="https://github.com/rails/webpacker/issues/769" target="_blank" rel="noopener noreferrer"&gt;this GitHub issue thread&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Another place to find the URL to a source map is in the corresponding source file&amp;#39;s last line:&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;//# sourceMappingURL=application-42b89cd8ec22763d95ae.js.map
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can analyze Podia&amp;#39;s publicly available source maps using &lt;a href="https://github.com/danvk/source-map-explorer" target="_blank" rel="noopener noreferrer"&gt;source-map-explorer&lt;/a&gt;. It can provide a visualization of all the modules bundled on this page. Here&amp;#39;s an example:&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/podia-source-map-explorer-bare.png" alt="Treemap image example of webpack JavaScript bundles" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Podia storefront editor&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Here&amp;#39;s a screenshot of the source-map-explorer treemap for the three Webpacker packs rendered on the storefront editor page, with my annotations for emphasis:&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/podia-source-map-explorer-annotated.png" alt="Treemap image of duplicated JavaScript bundles loaded on Podia's storefront editor" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;You can see the three JavaScript bundles in purple, blue, and orange, and with each, you can see included modules such as &lt;code&gt;actioncable&lt;/code&gt;, &lt;code&gt;stimulus&lt;/code&gt;, &lt;code&gt;moment.js&lt;/code&gt;, &lt;code&gt;core-js&lt;/code&gt;, and &lt;code&gt;cableready&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Here&amp;#39;s the problem: &lt;strong&gt;some modules appear twice on the same page!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/mrbean.gif" alt="Mr. Bean is shocked" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Two bundles include both moment.js and all the 100+ moment-locale modules. That means the browser has to download and parse moment.js (52KB) and moment-locales (326KB) twice on the same page!&lt;/p&gt;

&lt;p&gt;Same for actioncable, cableready, stimulus, and core-js.&lt;/p&gt;

&lt;p&gt;In an attempt to deliver less JavaScript to the browser with page-specific bundles, they&amp;#39;ve ended up with even bigger payloads. Podia is &lt;a href="/blog/overpacking-a-common-webpacker-mistake.html"&gt;&amp;quot;overpacking&amp;quot;&lt;/a&gt;, and it&amp;#39;s resulting in the &lt;strong&gt;redundant module problem&lt;/strong&gt;.&lt;/p&gt;

      &lt;h2 id="more-case-studies" class="title title-h2"&gt;
        &lt;a name="more-case-studies" class="anchor" href="#more-case-studies"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        More case studies
      &lt;/h2&gt;
    
&lt;p&gt;It&amp;#39;s not just Podia. I&amp;#39;ve recently discovered several other Rails applications with the same problem.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Funny or Die&lt;/strong&gt;
&lt;img src="/assets/images/blog/overpacking-case-studies/page-funnyordie.png" alt="Funny or Die home page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;I&amp;#39;m always up for a laugh, but you know what&amp;#39;s &lt;em&gt;not&lt;/em&gt; funny? Duplicate &lt;code&gt;jquery&lt;/code&gt; on the &lt;a href="https://www.funnyordie.com" target="_blank" rel="noopener noreferrer"&gt;Funny or Die&lt;/a&gt; home page.&lt;/p&gt;

&lt;p&gt;That&amp;#39;s an extra 80KB and, I would presume, a potential source of bugs for jquery plugins that assume only one instance of &lt;code&gt;$&lt;/code&gt; in the page scope.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/funnyordie-source-map-explorer-annotated.png" alt="Treemap image of duplicated JavaScript bundles loaded on Funny or Die's home page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Dribbble&lt;/strong&gt;
&lt;img src="/assets/images/blog/overpacking-case-studies/page-dribbble.png" alt="Dribbble profile page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;I&amp;#39;m whistling the &lt;a href="https://dribbble.com/dribbble" target="_blank" rel="noopener noreferrer"&gt;Dribbble profile page&lt;/a&gt; for multiple infractions, including duplicate instances of &lt;code&gt;vue&lt;/code&gt; and &lt;code&gt;axios&lt;/code&gt;. They could reduce their total payload size by up to 150KB.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/dribbble-source-map-explorer-annotated.png" alt="Treemap image of duplicated JavaScript bundles loaded on Dribbble's profile page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Teachable&lt;/strong&gt;
&lt;img src="/assets/images/blog/overpacking-case-studies/page-teachable.png" alt="Teachable course page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href="https://www.jessicasprague.com/p/digibeginnerbundle" target="_blank" rel="noopener noreferrer"&gt;course page on Teachable&lt;/a&gt; must love &lt;code&gt;jquery&lt;/code&gt; and &lt;code&gt;lodash&lt;/code&gt;. They&amp;#39;re both bundled twice across the three Webpacker packs rendered on this page.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/teachable-source-map-explorer-annotated.png" alt="Treemap image of duplicated JavaScript bundles loaded on Teachable's student course page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Drizly&lt;/strong&gt;
&lt;img src="/assets/images/blog/overpacking-case-studies/page-drizly.png" alt="Drizly search page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;It&amp;#39;s raining JavaScript at &lt;a href="https://drizly.com/beer/c2" target="_blank" rel="noopener noreferrer"&gt;Drizly&lt;/a&gt;! The product search page renders three packs, each of which includes instances &lt;code&gt;material-ui&lt;/code&gt;, &lt;code&gt;react&lt;/code&gt;, and &lt;code&gt;lodash&lt;/code&gt;, among others. If Drizly were to introduce React hooks, I am relatively sure &lt;a href="https://reactjs.org/warnings/invalid-hook-call-warning.html#duplicate-react" target="_blank" rel="noopener noreferrer"&gt;multiple instances of React will cause issues&lt;/a&gt; if they haven&amp;#39;t already.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/drizly-source-map-explorer-annotated.png" alt="Treemap image of duplicated JavaScript bundles loaded on Drizly's profile page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Strava&amp;#39;s activity feed&lt;/strong&gt;
&lt;img src="/assets/images/blog/overpacking-case-studies/page-strava.png" alt="Strava activity feed" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;As an endurance athlete in my spare time, I use Strava almost daily, where the activity feed forces me to render four instances of &lt;code&gt;react&lt;/code&gt;! Strava could reduce their activity feed payloads by a whopping 500KB by getting rid of their duplicated modules.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/strava-source-map-explorer-annotated.png" alt="Treemap image of duplicated JavaScript bundles loaded on Strava's activity feed" loading="lazy" /&gt;&lt;/p&gt;

      &lt;h3 id="analyzing-javascript-usage" class="title title-h3"&gt;
        &lt;a name="analyzing-javascript-usage" class="anchor" href="#analyzing-javascript-usage"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Analyzing JavaScript usage
      &lt;/h3&gt;
    
&lt;p&gt;Another tool I recommend is &lt;a href="https://github.com/aholachek/bundle-wizard" target="_blank" rel="noopener noreferrer"&gt;bundle-wizard&lt;/a&gt;, which can be used to find unused JavaScript modules on page load.&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ npx -p puppeteer -p bundle-wizard bundle-wizard --interact
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This tool turns the source-map-explorer into a heatmap representing code coverage across the bundled modules from high (green) to low (red).&lt;/p&gt;

&lt;p&gt;Here are the source maps from the Strava activity feed visualized again with bundle-wizard coverage heatmap:
&lt;img src="/assets/images/blog/overpacking-case-studies/bundle-wizard-strava-optimized.png" alt="Bundle wizard treemap with heatmap overlay" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;See all that red? Those extra React modules are unused on page load.&lt;/p&gt;

      &lt;h3 id="measuring-end-user-performance" class="title title-h3"&gt;
        &lt;a name="measuring-end-user-performance" class="anchor" href="#measuring-end-user-performance"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Measuring end user performance
      &lt;/h3&gt;
    
&lt;p&gt;We can also see whether Google&amp;#39;s &lt;a href="https://developers.google.com/web/tools/lighthouse" target="_blank" rel="noopener noreferrer"&gt;Lighthouse&lt;/a&gt; performance auditing tool would back these findings.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Lighthouse is an open-source, automated tool that can perform web page audits for performance, accessibility, among other quality indicators. &lt;a href="https://developers.google.com/web/tools/lighthouse" target="_blank" rel="noopener noreferrer"&gt;You can generate a Lighthouse report for almost any page you can access on the web through Chrome DevTools or a Firefox extension&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I generated &lt;a href="https://googlechrome.github.io/lighthouse/viewer/?gist=2a3785da1cfa4922190f3924d02edf39" target="_blank" rel="noopener noreferrer"&gt;this Lighthouse report for my Strava dashboard&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://googlechrome.github.io/lighthouse/viewer/?gist=2a3785da1cfa4922190f3924d02edf39" target="_blank" rel="noopener noreferrer"&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/lighthouse-strava-optimized.png" alt="Lighthouse report screenshot for strava.com/dashboard" loading="lazy" /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The page scores 23/100 based on &lt;a href="https://web.dev/performance-scoring/" target="_blank" rel="noopener noreferrer"&gt;Lighthouse&amp;#39;s performance metric scoring rubric&lt;/a&gt;, and, by far, the &lt;em&gt;biggest opportunity&lt;/em&gt; for improving page load performance is to remove unused JavaScript.&lt;/p&gt;

&lt;p&gt;This much is clear: JavaScript bloat is hampering the performance of these Rails apps.&lt;/p&gt;

      &lt;h2 id="why-the-redundant-modules-" class="title title-h2"&gt;
        &lt;a name="why-the-redundant-modules-" class="anchor" href="#why-the-redundant-modules-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Why the redundant modules?
      &lt;/h2&gt;
    
&lt;p&gt;It should be clear by now some Rails apps using Webpacker are bundling some modules unnecessarily across multiple bundles on a single page. As a result:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;JavaScript payloads are larger—not smaller—causing increased download and parse times for the end user&lt;/li&gt;
&lt;li&gt;Logic may assume &amp;quot;singleton&amp;quot; behavior or touch global concerns leading to confounding bugs&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So why is this happening?&lt;/p&gt;

&lt;p&gt;These Rails applications aren&amp;#39;t intentionally bundling all this extra JavaScript. The fact that they are splitting up their bundles indicates they are attempting to be selective about what JavaScript is delivered on a given page.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Wait, so we can&amp;#39;t split code into multiple bundles without duplicating modules in Webpacker?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s be clear that the practice of code-splitting isn&amp;#39;t wrong; &lt;a href="https://web.dev/reduce-javascript-payloads-with-code-splitting/" target="_blank" rel="noopener noreferrer"&gt;it&amp;#39;s a recommended best practice&lt;/a&gt; for improving page load performance.&lt;/p&gt;

&lt;p&gt;The problem with these examples is in the execution; it&amp;#39;s not happening &lt;em&gt;the way webpack expects&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Consider &lt;a href="https://cookpad.com" target="_blank" rel="noopener noreferrer"&gt;Cookpad.com&lt;/a&gt;. It&amp;#39;s a Rails app that renders numerous Webpacker bundles on its home page, yet no modules are duplicated:&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/cookpad-source-map-explorer-annotated-optimized.png" alt="Treemap of Cookpad source mapsl" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;When it comes to Webpacker, the Cookpad recipe is top-notch.&lt;/p&gt;

      &lt;h2 id="a-new-mental-model" class="title title-h2"&gt;
        &lt;a name="a-new-mental-model" class="anchor" href="#a-new-mental-model"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        A new mental model
      &lt;/h2&gt;
    
&lt;p&gt;The redundant module problem highlights that although the Rails asset pipeline and webpack solve the same general problem, they do so in &lt;em&gt;fundamentally different ways&lt;/em&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Webpack is a module bundler.&lt;/p&gt;

&lt;p&gt;The asset pipeline is a file concatenator.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The asset pipeline builds a list of what the developer explicitly requires. Think of it as a stack. &amp;quot;What you see is what you get.&amp;quot;&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/analog-sprockets-stack.png" alt="St.&amp;quot;ck" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Webpack, on the other hand, recursively parses the import statements in all the dependencies within a single pack, such as &lt;code&gt;app/javascript/packs/application.js&lt;/code&gt;, like a directed graph.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/analog-webpack-graph.png" alt="Directed graph" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Webpack will include all imported modules in the output, ensuring that no import is included in the same bundle twice.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;If that&amp;#39;s true, why are there multiple instances modules in Podia&amp;#39;s output, for example?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The reason: &lt;strong&gt;each pack is a separate dependency graph.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Consider this illustration of an imaginary project with multiple packs. One pack imports &lt;code&gt;moment&lt;/code&gt; explicitly, and the other pack imports a made-up &lt;code&gt;timeago&lt;/code&gt; plugin that depends on &lt;code&gt;moment&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/overpacking-case-studies/imports-webpacker.png" alt="Image of Webpacker bundling assets with multiple packs" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;See that the &lt;code&gt;moment&lt;/code&gt; package is imported in both packs. There is an explicit import in the first pack, and an implicit import via &lt;code&gt;timeago&lt;/code&gt; in the other.&lt;/p&gt;

&lt;p&gt;So splitting your code into multiple packs can lead to this problem &lt;em&gt;if&lt;/em&gt; you don&amp;#39;t configure webpack properly.&lt;/p&gt;

&lt;p&gt;What we want is a way to split code up into smaller pieces without all the overhead and potential bugs. It turns out, webpack was initially created to address precisely this: code-splitting.&lt;/p&gt;

&lt;p&gt;It&amp;#39;s just done differently than you expect.&lt;/p&gt;

      &lt;h2 id="the-webpacker-packing-checklist" class="title title-h2"&gt;
        &lt;a name="the-webpacker-packing-checklist" class="anchor" href="#the-webpacker-packing-checklist"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        The Webpacker Packing Checklist
      &lt;/h2&gt;
    
&lt;p&gt;Now that we know what the problem is and how to diagnose it, what can we do about it?&lt;/p&gt;

&lt;p&gt;The key to addressing this kind of Webpacker code bloat is to keep &lt;em&gt;all dependencies in the same dependency graph&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Below, I summarize the steps I would take to help these companies, which you can apply in your applications. These steps are iterative; you need not complete all these actions to begin seeing benefits.&lt;/p&gt;

      &lt;h3 id="step-1-start-with-one-entry-point-per-page" class="title title-h3"&gt;
        &lt;a name="step-1-start-with-one-entry-point-per-page" class="anchor" href="#step-1-start-with-one-entry-point-per-page"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Step 1: Start with one entry point per page
      &lt;/h3&gt;
    
&lt;p&gt;Webpack recommends one entry point per page. &lt;a href="https://webpack.js.org/concepts/entry-points" target="_blank" rel="noopener noreferrer"&gt;From the webpack docs&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As a rule of thumb: Use precisely one entry point for each HTML document.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;That&amp;#39;s how webpack assumes your application will work out-of-the-box. Practically speaking, that means there would be only one usage of &lt;code&gt;javascript_pack_tag&lt;/code&gt; per page:&lt;/p&gt;

&lt;pre&gt;&lt;code class="html"&gt;&amp;lt;%= javascript_pack_tag &amp;quot;application&amp;quot; %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For the companies described in this post, that would mean consolidating those separate packs into one on a page. Rendering multiple entry points on a single page &lt;em&gt;correctly&lt;/em&gt; requires additional configuration. We&amp;#39;ll get to that, but &amp;quot;one pack per page&amp;quot; is how I recommend starting.&lt;/p&gt;

&lt;p&gt;Does this mean you have to put &lt;strong&gt;all&lt;/strong&gt; your JavaScript in one pack? No, but:&lt;/p&gt;

      &lt;h3 id="step-2-keep-the-number-of-packs-small" class="title title-h3"&gt;
        &lt;a name="step-2-keep-the-number-of-packs-small" class="anchor" href="#step-2-keep-the-number-of-packs-small"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Step 2: Keep the number of packs small
      &lt;/h3&gt;
    
&lt;p&gt;Don&amp;#39;t split your JavaScript into a ton of little packs/entry points unless you understand the tradeoffs, and you&amp;#39;re comfortable with webpack.&lt;/p&gt;

&lt;p&gt;For smaller applications, just an &amp;quot;application.js&amp;quot; may be well worth the tradeoff of having an application that&amp;#39;s easier to maintain over the added cost of learning how to best split up JS code with webpack with little performance gain.&lt;/p&gt;

&lt;p&gt;Think of packs as the entry points to &lt;em&gt;distinct&lt;/em&gt; experiences rather than page-specific bundles.&lt;/p&gt;

&lt;p&gt;For Podia, this could be one pack for the public-facing storefront, one for the storefront editor, one for the customer dashboard. Maybe an employee admin area pack. That&amp;#39;s it.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Render one pack per page?... Keep the number of packs small? ... these bundles could get huge!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Ok, now we&amp;#39;ve come to webpack&amp;#39;s sweet spot:&lt;/p&gt;

      &lt;h3 id="step-3-use-dynamic-imports" class="title title-h3"&gt;
        &lt;a name="step-3-use-dynamic-imports" class="anchor" href="#step-3-use-dynamic-imports"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Step 3: Use dynamic imports
      &lt;/h3&gt;
    
&lt;p&gt;Webpack has several automated features for code-splitting that will never be supported in the Rails asset pipeline. The primary example of this is &lt;a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports" target="_blank" rel="noopener noreferrer"&gt;dynamic imports&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Dynamic imports allow you to define split points &lt;em&gt;in code&lt;/em&gt; rather than by configuration or multiple entry points. Note the &lt;code&gt;import()&lt;/code&gt; function syntax:&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;// Contrived examples

// Import page-specific chunks
if (currentPage === &amp;#39;storefront&amp;#39;) {
  import(&amp;#39;../src/pages/storefront&amp;#39;)
}

// Import progressive enhancement chunks
if (document.querySelector(&amp;#39;[data-timeago]&amp;#39;).length) {
  import(&amp;#39;../src/initializer/current_time_ago&amp;#39;)
}

// Import bigger on-demand chunks following user interaction
document.addEventListener(&amp;#39;[data-open-trix-editor]&amp;#39;, &amp;#39;click&amp;#39;, () =&amp;gt; {
  import(&amp;#39;../src/components/trix_editor&amp;#39;)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In the example above, the imported modules are not separate packs. They are modules included in the same dependency graph but compiled as &lt;em&gt;separate files&lt;/em&gt;. Webpack will load dynamic imports asynchronously at runtime.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Dynamic imports allow you to divide your &amp;quot;packs&amp;quot; into smaller pieces while avoiding the redundant module problem.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Does this mean import every little module in little dynamic chunks? No. Measure, experiment. Consider the tradeoffs with handling asynchronous code loading. Timebox your efforts&lt;/p&gt;

      &lt;h3 id="step-4-go-further-with-splitchunks-but-only-when-you-39-re-ready" class="title title-h3"&gt;
        &lt;a name="step-4-go-further-with-splitchunks-but-only-when-you-39-re-ready" class="anchor" href="#step-4-go-further-with-splitchunks-but-only-when-you-39-re-ready"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Step 4: Go further with splitChunks, but only when you&amp;#39;re ready
      &lt;/h3&gt;
    
&lt;p&gt;For a more powerful combination, use page-specific dynamic imports combined with &lt;a href="https://help.github.com/en/github/managing-files-in-a-repository/getting-permanent-links-to-files" target="_blank" rel="noopener noreferrer"&gt;the splitChunks configuration API&lt;/a&gt; to split out bundles for vendor code that can be shared across packs. In other words, browsers wouldn&amp;#39;t have to pay the cost of re-downloading bundles containing moment.js, lodash.js, etc., across multiple pages with a warm cache.&lt;/p&gt;

&lt;p&gt;Beware, though; this technique is a bit more advanced. It requires the use of separate Rails helpers, &lt;code&gt;javascript_packs_with_chunks_tag&lt;/code&gt; and &lt;code&gt;stylesheet_packs_with_chunks_tag&lt;/code&gt;, which will output multiple bundles produced from a single pack and these helpers should only be used once during the page render. It may take some &lt;a href="https://webpack.js.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer"&gt;reading up on the webpack docs&lt;/a&gt; and some experimentation with the chunking logic to achieve optimal results.&lt;/p&gt;

&lt;p&gt;Check out the open-source &lt;a href="https://github.com/forem/forem" target="_blank" rel="noopener noreferrer"&gt;Forem&lt;/a&gt; application (formerly dev.to) for an excellent example of how to do &amp;quot;splitChunks.&amp;quot;&lt;/p&gt;

      &lt;h2 id="summing-up" class="title title-h2"&gt;
        &lt;a name="summing-up" class="anchor" href="#summing-up"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Summing up
      &lt;/h2&gt;
    
&lt;p&gt;Webpack can be a bit confusing to understand at first. Webpacker goes a long way toward providing that &amp;quot;conceptual compression&amp;quot; to get developers up-and-running on Rails. Unfortunately, Webpacker doesn&amp;#39;t yet offer &lt;em&gt;all&lt;/em&gt; the guard rails required to avoid problems like overpacking. As we&amp;#39;ve seen, some Rails apps are using Webpacker with an asset-pipeline mindset.&lt;/p&gt;

&lt;p&gt;Embracing new tools may mean a little more investment, along with letting go of the way we used to do things.&lt;/p&gt;

&lt;p&gt;Apply the Webpacker Packing Checklist to ensure a good experience for clients who desire faster webpages and developers who want fewer bugs.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>A visual guide to Webpacker</title>
    <link rel="alternate" href="/archive/visual-guide-to-webpacker.html"/>
    <id>/archive/visual-guide-to-webpacker.html</id>
    <published>2020-08-02T00:00:00+00:00</published>
    <updated>2020-08-02T00:00:00+00:00</updated>
    <author>
      <name>Ross Kaffenberger</name>
    </author>
    <summary type="html">&lt;p&gt;Confused about how Webpacker works in Rails? Let's unpack it with some diagrams.&lt;/p&gt;

&lt;p&gt;First, we'll take a look at the "classic" way of bundling assets with Rails: the Rails asset pipeline. Let's see how things look when requests are served with the Rails...&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;Confused about how Webpacker works in Rails? Let&amp;#39;s unpack it with some diagrams.&lt;/p&gt;

&lt;p&gt;First, we&amp;#39;ll take a look at the &amp;quot;classic&amp;quot; way of bundling assets with Rails: the Rails asset pipeline. Let&amp;#39;s see how things look when requests are served with the Rails asset pipeline in development.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Struggling with webpack and Webpacker?&lt;/p&gt;

&lt;p&gt;&lt;a href="https://signup.rossta.net" target="_blank" rel="noopener noreferrer"&gt;&lt;strong&gt;Subscribe to my newsletter for occasional emails with new content.&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

      &lt;h4 id="html-request-with-the-asset-pipeline" class="title title-h4"&gt;
        &lt;a name="html-request-with-the-asset-pipeline" class="anchor" href="#html-request-with-the-asset-pipeline"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        HTML request with the asset pipeline
      &lt;/h4&gt;
    
&lt;p&gt;&lt;img src="/assets/images/blog/visual-guide-to-webpacker/webpacker-asset-pipeline-1.png" alt="Rails request with the asset pipeline" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;With the asset pipeline, when an HTML request is processed (1), bundling takes place within your Rails server (2). The asset pipeline is responsible for creating the bundled assets in the &lt;code&gt;public/assets/&lt;/code&gt; directory and providing URLs to those assets to be rendered in the View.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;script src=&amp;quot;/assets/application-3b2c...a7e.js&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;Note: Please consider the diagrams in this post as approximations of how the pieces fit together. Much of the detail has been omitted for simplicity and to draw attention to the salient aspects.&lt;/p&gt;
&lt;/blockquote&gt;

      &lt;h4 id="asset-request-with-the-asset-pipeline" class="title title-h4"&gt;
        &lt;a name="asset-request-with-the-asset-pipeline" class="anchor" href="#asset-request-with-the-asset-pipeline"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Asset request with the asset pipeline
      &lt;/h4&gt;
    
&lt;p&gt;&lt;img src="/assets/images/blog/visual-guide-to-webpacker/webpacker-asset-pipeline-2.png" alt="Rails request with the asset pipeline" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;As the browser parses the HTML response and finds that script tag, it must make an additional request to fetch the linked JavaScript resource from your Rails server. This time, the request is processed by (1) the &lt;code&gt;ActionDispatch::Static&lt;/code&gt; middleware, which recognizes the asset lives on disk in the &lt;code&gt;public/assets/&lt;/code&gt; directory (2).&lt;/p&gt;

&lt;p&gt;Good so far?&lt;/p&gt;

      &lt;h3 id="understanding-webpacker" class="title title-h3"&gt;
        &lt;a name="understanding-webpacker" class="anchor" href="#understanding-webpacker"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Understanding Webpacker
      &lt;/h3&gt;
    
&lt;p&gt;With Webpacker, things work differently.&lt;/p&gt;

&lt;p&gt;While the Rails asset pipeline lives &lt;em&gt;within&lt;/em&gt; the Rails server process, webpack, as you may know, is written in JavaScript and executes within the Node.js runtime. Therefore, webpack must run in a separate process.&lt;/p&gt;

&lt;p&gt;Rails needs some &amp;quot;glue&amp;quot; to help it communicate with webpack. Webpacker provides the glue, which includes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;webpack configuration,

&lt;ul&gt;
&lt;li&gt;i.e., &lt;code&gt;config/webpacker.yml&lt;/code&gt; and &lt;code&gt;config/webpack/{production,development,test}.js&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;helpers,

&lt;ul&gt;
&lt;li&gt;e.g. &lt;code&gt;javascript_pack_tag&lt;/code&gt; and &lt;code&gt;stylesheet_link_tag&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;executables,

&lt;ul&gt;
&lt;li&gt;i.e. &lt;code&gt;bin/webpack&lt;/code&gt; and &lt;code&gt;bin/webpack-dev-server&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;and middleware for development

&lt;ul&gt;
&lt;li&gt;i.e., &lt;code&gt;Webpacker::DevServerProxy&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For the purpose of illustration, we&amp;#39;ll focus on how Webpacker works in development. Webpacker supports two development &amp;quot;modes&amp;quot;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;compile on demand&lt;/li&gt;
&lt;li&gt;dev server&lt;/li&gt;
&lt;/ul&gt;

      &lt;h3 id="compile-on-demand" class="title title-h3"&gt;
        &lt;a name="compile-on-demand" class="anchor" href="#compile-on-demand"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Compile on demand
      &lt;/h3&gt;
    
&lt;p&gt;Let&amp;#39;s look at &amp;quot;compile on demand&amp;quot; first.&lt;/p&gt;

&lt;p&gt;This mode is enabled when the &lt;code&gt;compile&lt;/code&gt; option is set to &lt;code&gt;true&lt;/code&gt; in &lt;code&gt;config/webpacker.yml&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class="yaml"&gt;development:
  compile: true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here&amp;#39;s how webpack fits into the picture.&lt;/p&gt;

      &lt;h4 id="html-request-with-webpacker-compile" class="title title-h4"&gt;
        &lt;a name="html-request-with-webpacker-compile" class="anchor" href="#html-request-with-webpacker-compile"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        HTML request with Webpacker compile
      &lt;/h4&gt;
    
&lt;p&gt;&lt;img src="/assets/images/blog/visual-guide-to-webpacker/webpacker-compile-1.png" alt="Rails request with the asset pipeline" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;As it processes an HTML request (1), Rails will render the View, including &amp;quot;pack&amp;quot; tags such as the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class="erb"&gt;&amp;lt;%= stylesheet_pack_tag &amp;#39;application&amp;#39;, media: &amp;#39;all&amp;#39; %&amp;gt;

&amp;lt;%= javascript_pack_tag &amp;#39;application&amp;#39; %&amp;gt;

&amp;lt;%= image_pack_tag(&amp;#39;media/images/apple-touch-icon.png&amp;#39;) %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Rails must be able to determine the URL for webpack JS, CSS, and image assets.&lt;/p&gt;

&lt;p&gt;To do so, the Rails server will run webpack in a child process if the compiled assets are missing or stale (2).&lt;/p&gt;

&lt;p&gt;The webpack config used to invoke webpack, &lt;code&gt;config/webpack/development.js&lt;/code&gt; merges settings from &lt;code&gt;config/webpacker.yml&lt;/code&gt; and the config provided by the &lt;code&gt;@rails/webpacker&lt;/code&gt; NPM package (3).&lt;/p&gt;

&lt;p&gt;Executing webpack will generate assets in the &lt;code&gt;public/packs/&lt;/code&gt; directory along with the important &lt;code&gt;manifest.json&lt;/code&gt; (4).&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;manifest.json&lt;/code&gt; file is the key communication point from webpack to Rails: it provides a simple mapping to look up asset paths from their canonical names.&lt;/p&gt;

&lt;pre&gt;&lt;code class="json"&gt;{
  &amp;quot;application.js&amp;quot;: &amp;quot;/packs/js/application-7efac57c4de0539bb941.js&amp;quot;,
  &amp;quot;application.css&amp;quot;: &amp;quot;/packs/css/application-7526fd011c9ea132a45f.css&amp;quot;,
  &amp;quot;media/images/apple-touch-icon.png&amp;quot;: &amp;quot;/packs/media/images/apple-touch-icon-b8d7025d5da762a9c1dd30980f412c92.png&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Rails will read this file via the Webpacker view helpers to render the correct URL to the assets.&lt;/p&gt;

      &lt;h4 id="asset-request-with-webpacker-compile" class="title title-h4"&gt;
        &lt;a name="asset-request-with-webpacker-compile" class="anchor" href="#asset-request-with-webpacker-compile"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Asset request with Webpacker compile
      &lt;/h4&gt;
    
&lt;p&gt;&lt;img src="/assets/images/blog/visual-guide-to-webpacker/webpacker-compile-2.png" alt="Rails request with the asset pipeline" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Once the browser has received the HTML response, it must make additional request to retrieve the assets. In &amp;quot;compile-on-demand&amp;quot; mode, this is identical to the asset pipeline:&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;ActionDispatch::Static&lt;/code&gt; middleware (1) locates the asset on the file system in the &lt;code&gt;public/&lt;/code&gt; directory (2) which is returned to the browser, short-circuiting the rest of the Rails process.&lt;/p&gt;

&lt;p&gt;In production, of course, the role of the middleware may likely be played instead by a web server, such as Nginx, and/or a CDN.&lt;/p&gt;

      &lt;h3 id="dev-server" class="title title-h3"&gt;
        &lt;a name="dev-server" class="anchor" href="#dev-server"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Dev server
      &lt;/h3&gt;
    
&lt;p&gt;The &amp;quot;compile on-demand&amp;quot; mode is similar to using the Rails asset pipeline in that you need only run the Rails server explicitly to get started. In development, I prefer &amp;quot;dev server&amp;quot; mode. This approach involves using the &lt;code&gt;webpack-dev-server&lt;/code&gt; as a standalone HTTP server to compile assets and serve asset requests. Advantages include auto-recompilation, live-reloading, and &lt;a href="https://webpack.js.org/concepts/hot-module-replacement/" target="_blank" rel="noopener noreferrer"&gt;hot module replacement&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Using a tool like &lt;a href="https://github.com/ddollar/foreman" target="_blank" rel="noopener noreferrer"&gt;foreman&lt;/a&gt; or &lt;a href="https://github.com/DarthSim/overmind" target="_blank" rel="noopener noreferrer"&gt;overmind&lt;/a&gt;, we can boot up both the Rails server and the webpack-dev-server with a single command using a Procfile such as:&lt;/p&gt;

&lt;pre&gt;&lt;code class="yaml"&gt;# Procfile.dev
rails: bin/rails server
webpack: bin/webpack-dev-server
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We&amp;#39;ll also set the &lt;code&gt;compile&lt;/code&gt; option to &lt;code&gt;false&lt;/code&gt; in &lt;code&gt;config/webpacker.yml&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class="yaml"&gt;development:
  compile: false
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This way, Rails won&amp;#39;t shell out to the webpack executable if the dev-server is running. The dev-server will be responsible for detecting changes to assets and recompiling automatically.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s see how requests are processed in &amp;quot;dev server&amp;quot; mode.&lt;/p&gt;

      &lt;h4 id="html-request-with-dev-server" class="title title-h4"&gt;
        &lt;a name="html-request-with-dev-server" class="anchor" href="#html-request-with-dev-server"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        HTML request with dev server
      &lt;/h4&gt;
    
&lt;p&gt;&lt;img src="/assets/images/blog/visual-guide-to-webpacker/webpacker-dev-server-1.png" alt="Rails request with the asset pipeline" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;When the dev-server boots up (1), it &amp;quot;pre-compiles&amp;quot; assets in memory, instead of writing them to disk, for performance. It does still write the &lt;code&gt;manifest.json&lt;/code&gt; file to disk in the &lt;code&gt;public/packs/&lt;/code&gt; directory (2), where Rails can find it.&lt;/p&gt;

&lt;p&gt;As with the other examples, as the request (3) is processed, the View will attempt to render javascript, stylesheet, and image tags. Rails will determine asset URLs from &lt;code&gt;manifest.json&lt;/code&gt; (4). If the webpack-dev-server is not running or hasn&amp;#39;t finished compiling as the request comes in, you may see the infamous &lt;a href="https://github.com/rails/webpacker/issues/1730" target="_blank" rel="noopener noreferrer"&gt;Webpacker::Manifest::MissingEntryError&lt;/a&gt;.&lt;/p&gt;

      &lt;h4 id="asset-request-with-dev-server" class="title title-h4"&gt;
        &lt;a name="asset-request-with-dev-server" class="anchor" href="#asset-request-with-dev-server"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Asset request with dev server
      &lt;/h4&gt;
    
&lt;p&gt;&lt;img src="/assets/images/blog/visual-guide-to-webpacker/webpacker-dev-server-2.png" alt="Rails request with the asset pipeline" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;As before, Rails middleware (1) locates the asset, this time, by proxying to the webpack-dev-server (2).&lt;/p&gt;

&lt;p&gt;Recall that with the asset pipeline or webpack &amp;quot;compile on demand&amp;quot;, the &lt;code&gt;ActionDispatch::Static&lt;/code&gt; middleware located the assets on the file system in the &lt;code&gt;public/&lt;/code&gt; directory. However, when using the webpack-dev-server, assets on not written to disk, they&amp;#39;re created in memory; &lt;code&gt;ActionDispatch::Static&lt;/code&gt; doesn&amp;#39;t work in this case.&lt;/p&gt;

&lt;p&gt;To solve this problem, Webpacker provides its own middleware: &lt;code&gt;Webpacker::DevServerProxy&lt;/code&gt; (&lt;a href="https://github.com/rails/webpacker/blob/bf278f9787704ed0f78038ad7d36c008abc2edfd/lib/webpacker/dev_server_proxy.rb#L3" target="_blank" rel="noopener noreferrer"&gt;source&lt;/a&gt;). This allows Rails to act as an intermediary between the browser and the webpack-dev-server in development.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As a side note, I&amp;#39;m not entirely sure why the proxy middleware would be necessary. Rails could point asset urls directly at webpack-dev-server by prepending the host, i.e., &lt;code&gt;http://localhost:3035/...&lt;/code&gt;. Instead, by default in development, asset paths are produced so that the browser will direct its assets requests to the Rails server. I&amp;#39;m not entirely sure why the maintainers went this direction if only to make it seem more like the asset pipeline from the browser&amp;#39;s perspective.&lt;/p&gt;
&lt;/blockquote&gt;

      &lt;h3 id="wrapping-up" class="title title-h3"&gt;
        &lt;a name="wrapping-up" class="anchor" href="#wrapping-up"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Wrapping up
      &lt;/h3&gt;
    
&lt;p&gt;At times, Rails can feel like a black box. I hope these mental maps help make it easier to navigate the world of Webpacker and webpack on Rails with confidence.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Why doesn't Webpacker use my test config when I run Rails tests?</title>
    <link rel="alternate" href="/archive/why-doesnt-webpacker-use-my-test-config-when-i-run-rails-tests.html"/>
    <id>/archive/why-doesnt-webpacker-use-my-test-config-when-i-run-rails-tests.html</id>
    <published>2020-07-20T00:00:00+00:00</published>
    <updated>2020-07-20T00:00:00+00:00</updated>
    <author>
      <name>Ross Kaffenberger</name>
    </author>
    <summary type="html">&lt;p&gt;Here's something you might not expect: when running Rails tests, Webpacker will load the &lt;em&gt;development&lt;/em&gt; webpack config instead of the test config by default.&lt;/p&gt;

&lt;p&gt;To demonstrate, I'll use some "puts" debugging. Here's a &lt;code&gt;console.log&lt;/code&gt; statement in the development...&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;Here&amp;#39;s something you might not expect: when running Rails tests, Webpacker will load the &lt;em&gt;development&lt;/em&gt; webpack config instead of the test config by default.&lt;/p&gt;

&lt;p&gt;To demonstrate, I&amp;#39;ll use some &amp;quot;puts&amp;quot; debugging. Here&amp;#39;s a &lt;code&gt;console.log&lt;/code&gt; statement in the development config.&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;// config/webpack/development.js
// ...
console.log(&amp;#39;Loading config/webpack/development.js...&amp;#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When I run my RSpec tests while logging to STDOUT and RAILS_ENV set to test, the log line is displayed.&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ RAILS_LOG_TO_STDOUT=true RAILS_ENV=test bin/rspec

# ...
[Webpacker] Compiling...
# ...
[Webpacker] Loading config/webpack/development.js...
# ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you&amp;#39;ve noticed this before, there&amp;#39;s nothing wrong with your setup; this is the way Webpacker is setup to work out-of-the-box. Nevertheless, this is quite confusing and has lead to &lt;a href="https://github.com/rails/webpacker/issues/2654" target="_blank" rel="noopener noreferrer"&gt;a recently reported issue&lt;/a&gt; on the Webpacker GitHub repository.&lt;/p&gt;

&lt;p&gt;It turns out, even though RAILS_ENV is set to &amp;#39;test&amp;#39;, NODE_ENV is set to &amp;#39;development&amp;#39; (&lt;a href="https://github.com/rails/webpacker/blob/bf278f9787704ed0f78038ad7d36c008abc2edfd/lib/install/bin/webpack#L4" target="_blank" rel="noopener noreferrer"&gt;source&lt;/a&gt;) and the webpack config is determined directly from NODE_ENV.&lt;/p&gt;

      &lt;h3 id="what-gives-" class="title title-h3"&gt;
        &lt;a name="what-gives-" class="anchor" href="#what-gives-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        What gives?
      &lt;/h3&gt;
    
&lt;p&gt;If the &amp;quot;test&amp;quot; NODE_ENV isn&amp;#39;t used when I run my Rails tests, what is it good for?&lt;/p&gt;

&lt;p&gt;First, let&amp;#39;s make it clear that NODE_ENV has no explicit relationship to RAILS_ENV. Setting one of the ENV variables will have no effect on the other.&lt;/p&gt;

&lt;p&gt;This is useful for debugging; for example, you can compile your production webpack build locally:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;NODE_ENV=production RAILS_ENV=development bin/rails s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Speaking of production, when running &lt;code&gt;rails assets:precompile&lt;/code&gt; to compile your build, you don&amp;#39;t have to set NODE_ENV to production explicitly because &lt;a href="https://github.com/rails/webpacker/blob/bf278f9787704ed0f78038ad7d36c008abc2edfd/lib/tasks/webpacker/compile.rake#L21" target="_blank" rel="noopener noreferrer"&gt;Webpacker does this for you&lt;/a&gt;. Otherwise, development is the default.&lt;/p&gt;

&lt;p&gt;Another key point the production and development configurations are designed for compiling your JS for a real browser. Though they have different optimization characteristics, &lt;a href="https://github.com/rails/webpacker/blob/bf278f9787704ed0f78038ad7d36c008abc2edfd/lib/install/config/babel.config.js#L28-L38" target="_blank" rel="noopener noreferrer"&gt;they share the same browser-focused Babel config&lt;/a&gt; which will transform your nice ES6+ syntax into JavaScript your supported browsers will understand.&lt;/p&gt;

&lt;p&gt;To recap so far: with Webpacker, NODE_ENV determines which webpack config it will use, i.e., &lt;code&gt;config/webpack/{development,test,production}.js&lt;/code&gt; and will impact behavior in your Babel config, i.e., &lt;code&gt;babel.config.js&lt;/code&gt;.&lt;/p&gt;

      &lt;h3 id="testing-1-2-3" class="title title-h3"&gt;
        &lt;a name="testing-1-2-3" class="anchor" href="#testing-1-2-3"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Testing 1-2-3
      &lt;/h3&gt;
    
&lt;p&gt;This finally brings us to the use case for &lt;code&gt;NODE_ENV=test&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;JavaScript unit testing&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;By this I mean executing tests, written in JavaScript, against your application JavaScript code &lt;em&gt;within a Node.js process&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;We&amp;#39;re talking &lt;a href="https://github.com/mochajs/mocha" target="_blank" rel="noopener noreferrer"&gt;Mocha&lt;/a&gt;, &lt;a href="https://github.com/facebook/jest" target="_blank" rel="noopener noreferrer"&gt;Jest&lt;/a&gt;, &lt;a href="https://karma-runner.github.io/latest/index.html" target="_blank" rel="noopener noreferrer"&gt;Karma&lt;/a&gt;, and more.&lt;/p&gt;

&lt;p&gt;For some applications, JavaScript unit tests may not add much value, say if you&amp;#39;re just doing a little DOM-manipulation with jQuery here and there. However, there may be some benefit to structuring your JavaScript utilities and components into discrete units which can be tested in isolation. And where there are discrete, testable units, there is room for unit testing. That&amp;#39;s where JavaScript test runners come in.&lt;/p&gt;

&lt;p&gt;The Rails unit testing for asset-pipeline compiled JavaScript is a bit cumbersome; it typically requires a gem, like &lt;a href="https://github.com/jejacks0n/teaspoon" target="_blank" rel="noopener noreferrer"&gt;teaspoon&lt;/a&gt; or &lt;a href="https://github.com/searls/jasmine-rails" target="_blank" rel="noopener noreferrer"&gt;jasmine-rails&lt;/a&gt;, that integrates tightly with the Rails asset pipeline by booting up both Rails and a browser to compile JavaScript and execute tests.&lt;/p&gt;

&lt;p&gt;Webpacker opens the door to JavaScript unit test runners that can run in a Node.js process instead of a real browser (typically for speed). Jest, for example, &lt;a href="https://jestjs.io/docs/en/configuration#testenvironment-string" target="_blank" rel="noopener noreferrer"&gt;executes tests against a &amp;quot;browser-like&amp;quot; environment called jsdom by default&lt;/a&gt;. To support these node.js test runners, Webpacker&amp;#39;s &lt;a href="https://github.com/rails/webpacker/blob/bf278f9787704ed0f78038ad7d36c008abc2edfd/lib/install/config/babel.config.js#L20-L27" target="_blank" rel="noopener noreferrer"&gt;default Babel config targets the node.js runtime instead of a browser when &lt;code&gt;NODE_ENV=test&lt;/code&gt;&lt;/a&gt;; this means Babel will transform your nice ES6+ syntax into JavaScript your current node version will understand assuming you set &lt;code&gt;NODE_ENV=test&lt;/code&gt; for running your JavaScript unit tests.&lt;/p&gt;

      &lt;h3 id="what-this-means-for-your-application" class="title title-h3"&gt;
        &lt;a name="what-this-means-for-your-application" class="anchor" href="#what-this-means-for-your-application"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        What this means for your application
      &lt;/h3&gt;
    
&lt;p&gt;You can see the potential problem then if you explicitly set &lt;code&gt;NODE_ENV=test&lt;/code&gt; for your Rails system and integration tests without considering your Babel config; compiling your JavaScript for the Node.js runtime and loading in the browser may lead to some surprising issues. You can, of course, override this behavior if you really want; at least with this introduction provides some awareness of what you&amp;#39;d be getting yourself into.&lt;/p&gt;

&lt;p&gt;You can &lt;a href="https://jestjs.io/docs/en/webpack" target="_blank" rel="noopener noreferrer"&gt;setup Jest to compile your JavaScript through your webpack configuration&lt;/a&gt;. If you follow the &lt;a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer"&gt;general setup instructions for Jest&lt;/a&gt;, it&amp;#39;s possible to integrate to run your unit tests without webpack at all. Other test runners like &lt;a href="https://karma-runner.github.io/latest/index.html" target="_blank" rel="noopener noreferrer"&gt;karma&lt;/a&gt; offer similar options for running with or without webpack.&lt;/p&gt;

&lt;p&gt;All this to say: your webpack test config, i.e. &lt;code&gt;config/webpack/test.js&lt;/code&gt;, is essentially useless unless your application:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;uses a Node.js test runner for JavaScript unit test AND configure it to use your webpack config&lt;/li&gt;
&lt;li&gt;overrides the defaults so that the test config is loaded in your Rails tests (just be sure to change Babel behavior)&lt;/li&gt;
&lt;/ol&gt;

      &lt;h3 id="what-about-webpacker-yml-" class="title title-h3"&gt;
        &lt;a name="what-about-webpacker-yml-" class="anchor" href="#what-about-webpacker-yml-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        What about webpacker.yml?
      &lt;/h3&gt;
    
&lt;p&gt;Also, as I&amp;#39;ve described previously in &lt;a href="/blog/how-to-use-webpacker-yml.html"&gt;Understanding webpacker.yml&lt;/a&gt;, Webpacker provides a webpack configuration while merging settings declared in &lt;code&gt;config/webpacker.yml&lt;/code&gt; from YAML to JavaScript. This file contains settings for production, development, and test environments as do most Rails-y YAML files. Unlike the webpack config, webpacker.yml settings are determined by the current RAILS_ENV.&lt;/p&gt;

&lt;p&gt;This means, webpacker.yml test settings are merged into the development webpack config when running your Rails tests.&lt;/p&gt;

      &lt;h3 id="wrapping-up" class="title title-h3"&gt;
        &lt;a name="wrapping-up" class="anchor" href="#wrapping-up"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Wrapping up
      &lt;/h3&gt;
    
&lt;p&gt;Does all of this seem a little confusing? I agree. Here&amp;#39;s a breakdown of how webpack configuration maps to RAILS_ENV and NODE_ENV in various contexts.&lt;/p&gt;

&lt;table style="font-size:85%; margin-bottom: 2em;"&gt;
  &lt;thead&gt;
    &lt;tr style="border-bottom: 1px solid #CCC"&gt;
      &lt;th&gt;Context&lt;/th&gt;
      &lt;th&gt;RAILS_ENV&lt;/th&gt;
      &lt;th&gt;webpacker.yml&lt;/th&gt;
      &lt;th&gt;NODE_ENV&lt;/th&gt;
      &lt;th&gt;webpack config&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr style="border-bottom: 1px solid #CCC"&gt;
      &lt;td&gt;Deployed app&lt;/td&gt;
      &lt;td&gt;production&lt;/td&gt;
      &lt;td&gt;production&lt;/td&gt;
      &lt;td&gt;production&lt;/td&gt;
      &lt;td&gt;config/webpack/production.js&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr style="border-bottom: 1px solid #CCC"&gt;
      &lt;td&gt;Local server&lt;/td&gt;
      &lt;td&gt;development&lt;/td&gt;
      &lt;td&gt;development&lt;/td&gt;
      &lt;td&gt;development&lt;/td&gt;
      &lt;td&gt;config/webpack/development.js&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr style="border-bottom: 1px solid #CCC"&gt;
      &lt;td&gt;Rails tests&lt;/td&gt;
      &lt;td&gt;test&lt;/td&gt;
      &lt;td&gt;test&lt;/td&gt;
      &lt;td&gt;development&lt;/td&gt;
      &lt;td&gt;config/webpack/development.js&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr style="border-bottom: 1px solid #CCC"&gt;
      &lt;td&gt;JS unit tests&lt;/td&gt;
      &lt;td&gt;n/a&lt;/td&gt;
      &lt;td&gt;n/a&lt;/td&gt;
      &lt;td&gt;test&lt;/td&gt;
      &lt;td&gt;config/webpack/test.js &lt;i&gt;if&lt;/i&gt; test runner is configured to use webpack&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;em&gt;In summary&lt;/em&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;RAILS_ENV determines which Webpacker YAML settings are used and NODE_ENV determines which webpack configuration is used.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Whether or not you find the use case for JavaScript unit tests compelling, it helps to know that Webpacker does not make any distinction between your development and test environments beyond the settings in your webpacker.yml; both are local concerns that target the same runtime, i.e., the browser.&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;If you found this helpful, please consider subscribing to my newsletter to stay tuned for more on upping your &amp;quot;JavaScript on Rails&amp;quot; game.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>The webpack plugin I can't live without</title>
    <link rel="alternate" href="/archive/webpacker-output-analysis-with-webpack-bundle-analyzer.html"/>
    <id>/archive/webpacker-output-analysis-with-webpack-bundle-analyzer.html</id>
    <published>2020-05-17T00:00:00+00:00</published>
    <updated>2020-05-17T00:00:00+00:00</updated>
    <author>
      <name>Ross Kaffenberger</name>
    </author>
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;tl;dr Install the &lt;a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer"&gt;&lt;code&gt;webpack-bundle-analyzer&lt;/code&gt;&lt;/a&gt; to visualize what's included in your webpack bundles and debug common problems.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Does webpack feel still a bit scary? Maybe a bit too magical? Too much of &lt;em&gt;WTF is going on here?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;It felt that way for me once...&lt;/p&gt;</summary>
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;tl;dr Install the &lt;a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer"&gt;&lt;code&gt;webpack-bundle-analyzer&lt;/code&gt;&lt;/a&gt; to visualize what&amp;#39;s included in your webpack bundles and debug common problems.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Does webpack feel still a bit scary? Maybe a bit too magical? Too much of &lt;em&gt;WTF is going on here?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;It felt that way for me once. I was struggling to &lt;a href="https://rossta.net/blog/from-sprockets-to-webpack.html" target="_blank" rel="noopener noreferrer"&gt;switch from Sprockets to Webpacker in a large Rails app&lt;/a&gt;. With Sprockets, I could require a jQuery plugin through a magic comment (the require directive), and it would &amp;quot;Just Work.&amp;quot;&lt;/p&gt;

&lt;p&gt;Such was not the case when I first started using webpack; ever seen an error like on the console?&lt;/p&gt;

&lt;pre&gt;&lt;code class="js"&gt;&amp;#39;Uncaught TypeError: $(...).fancybox is not a function&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Yeah, you and me both.&lt;/p&gt;

&lt;p&gt;Then one day, it all clicked for me.&lt;/p&gt;

&lt;p&gt;My main problem was &lt;em&gt;I didn&amp;#39;t have a good mental model how webpack worked.&lt;/em&gt; To form that mental model, I researched dozens of articles, watched numerous screencasts, and read a lot of source code. One thing helped &amp;quot;flip the switch&amp;quot; more than anything else: understanding the product of a webpack build, the output.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;It was right there in front of me the whole time.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Now you might call me crazy to say, &amp;quot;you should read the source of your bundled output,&amp;quot; even assuming we&amp;#39;re talking about the unminified/unobfuscated development build, so I&amp;#39;m not going to tell you to go do that. (Not without some guidance; let&amp;#39;s save that for a future project).&lt;/p&gt;

&lt;p&gt;But you can use a tool &lt;em&gt;right now&lt;/em&gt; to &lt;strong&gt;visualize&lt;/strong&gt; what&amp;#39;s in your bundle. And that could be enough to make all the difference in helping you understand, at least at a high level, how webpack does its thing.&lt;/p&gt;

      &lt;h3 id="introducing-the-webpack-bundle-analyzer" class="title title-h3"&gt;
        &lt;a name="introducing-the-webpack-bundle-analyzer" class="anchor" href="#introducing-the-webpack-bundle-analyzer"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Introducing the webpack-bundle-analyzer
      &lt;/h3&gt;
    
&lt;p&gt;But, there is something else you can do that requires a lot less work: you can use the &lt;code&gt;webpack-bundle-analyzer&lt;/code&gt;. You can probably get it up-and-running in less time than it takes to read this article.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Curious about or need help with webpack? I may be able to help! I&amp;#39;m developing a course for webpack on Rails and I frequently write about it on this blog.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://signup.rossta.net" target="_blank" rel="noopener noreferrer"&gt;&lt;strong&gt;Subscribe to my newsletter to get updates&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The webpack-bundle-analyzer is a tool that you can use to visualize the contents of a webpack build. It parses the &amp;quot;stats&amp;quot; output of a webpack build and constructs an interactive &lt;a href="https://www.jasondavies.com/voronoi-treemap/" target="_blank" rel="noopener noreferrer"&gt;Voronoi treemap&lt;/a&gt; using the &lt;a href="https://carrotsearch.com/foamtree/" target="_blank" rel="noopener noreferrer"&gt;FoamTree&lt;/a&gt; library.&lt;/p&gt;

&lt;p&gt;It might look a little something like this:&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/webpack/analyzer-single-bundle-1.png" alt="An example of a Voronoi treemap output by the webpack-bundle-analyzer" loading="lazy" /&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Funny story, this wasn&amp;#39;t the first time I&amp;#39;ve come across Voronoi diagrams. The hands-down best Computer Science class I took at NYU was &lt;a href="https://cs.nyu.edu/courses/fall16/CSCI-GA.2965-001/" target="_blank" rel="noopener noreferrer"&gt;Heuristics&lt;/a&gt; with Dennis Shasha in which we learned algorithms for approximating solutions to NP-hard problems and applied them to compete in automated 2-player competitive battles including a &lt;a href="https://cs.nyu.edu/courses/fall16/CSCI-GA.2965-001/voronoi_gravitational.html" target="_blank" rel="noopener noreferrer"&gt;gravitation Voronoi game&lt;/a&gt;. My source code is up on GitHub somewhere useful to no one else, serving mostly as a reminder I can accomplish big things under challenging constraints.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The analyzer will represent multiple bundles as distinct colors with relative sizes:
&lt;img src="/assets/images/blog/webpack/analyzer-multiple-bundles.png" alt="webpack-bundle-analyzer multiple bundles" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Individual modules are displayed in their relative sizes. Hover over bundles and modules to view statistics. Click or scroll to zoom in:
&lt;img src="/assets/images/blog/webpack/analyzer-module-closeup.png" alt="webpack-bundle-analyzer module closeup" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Use the slide-out menu on the left to toggle the gzipped and parsed (&amp;quot;un&amp;quot;-gzipped) bundles:
&lt;img src="/assets/images/blog/webpack/analyzer-menu-closeup.png" alt="webpack-bundle-analyzer close up of menu" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Highlight modules that match a search phrase, like &amp;quot;react&amp;quot;:
&lt;img src="/assets/images/blog/webpack/analyzer-module-highlight.png" alt="webpack-bundle-analyzer module highlight" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;Are you using Moment.js? It might be including translations for all its locales by default at enormous cost. &lt;a href="https://github.com/jmblog/how-to-optimize-momentjs-with-webpack" target="_blank" rel="noopener noreferrer"&gt;Consider using only the locales you need&lt;/a&gt;.
&lt;img src="/assets/images/blog/webpack/analyzer-moment-locales.png" alt="webpack-bundle-analyzer moment locales" loading="lazy" /&gt;&lt;/p&gt;

      &lt;h4 id="key-questions" class="title title-h4"&gt;
        &lt;a name="key-questions" class="anchor" href="#key-questions"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Key questions
      &lt;/h4&gt;
    
&lt;p&gt;Here are just some examples of questions the webpack-bundle-analyzer can help answer:&lt;/p&gt;

&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Why is this bundle so large?&lt;/li&gt;
&lt;li&gt;What are the relative sizes of each &lt;em&gt;bundle&lt;/em&gt; in the webpack build?&lt;/li&gt;
&lt;li&gt;What are the relative sizes of each &lt;em&gt;module&lt;/em&gt; in the webpack build?&lt;/li&gt;
&lt;li&gt;Where is my business logic bundled?&lt;/li&gt;
&lt;li&gt;Are the modules I expect included?&lt;/li&gt;
&lt;li&gt;Are any modules included more than once?&lt;/li&gt;
&lt;li&gt;Are there modules I expect to be excluded?&lt;/li&gt;
&lt;li&gt;Which third-party libraries are bundled?&lt;/li&gt;
&lt;li&gt;Which bundle contains $MODULE_NAME?&lt;/li&gt;
&lt;li&gt;Is &lt;a href="https://webpack.js.org/guides/tree-shaking/" target="_blank" rel="noopener noreferrer"&gt;tree-shaking&lt;/a&gt;* working?&lt;/li&gt;
&lt;li&gt;WTF is in this bundle?&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;Glossary alert&lt;/strong&gt; &amp;quot;Tree shaking&amp;quot; is jargon for dead code elimination: the process of removing unreferenced code from your build. Webpack will perform tree shaking when running in &amp;quot;production&amp;quot; mode which is enabled when building assets using &lt;code&gt;rake assets:precompile&lt;/code&gt; or via &lt;code&gt;./bin/webpack&lt;/code&gt; with &lt;code&gt;RAILS_ENV=production&lt;/code&gt; and &lt;code&gt;NODE_ENV=production&lt;/code&gt;. I&amp;#39;ll share more about how to take full advantage of tree shaking in future posts.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In short, webpack-bundle-analyzer graphs what is happening in your build. It can help you debug unexpected behavior or optimize your build output to reduce bundle size. All that, in service of better user experience!&lt;/p&gt;

      &lt;h3 id="installation" class="title title-h3"&gt;
        &lt;a name="installation" class="anchor" href="#installation"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Installation
      &lt;/h3&gt;
    
&lt;p&gt;The &lt;code&gt;webpack-bundle-analyzer&lt;/code&gt; is distributed as an NPM package. To install via yarn:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;yarn add --dev webpack-bundle-analyzer
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Since this tool is typically only useful for local development, we add it to &lt;code&gt;devDependencies&lt;/code&gt; using the &lt;code&gt;--dev&lt;/code&gt; flag.&lt;/p&gt;

      &lt;h3 id="usage" class="title title-h3"&gt;
        &lt;a name="usage" class="anchor" href="#usage"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Usage
      &lt;/h3&gt;
    
&lt;p&gt;To use the webpack-bundler-analyzer, you can either integrate it as a plugin to your Webpacker configuration or you use a two-step command line process.&lt;/p&gt;

&lt;p&gt;Typically, it makes the most sense to analyze the output of production builds since they will be what&amp;#39;s delivered to the client and may contain several optimizations that will make the output differ significantly from the development build. Analyzing the development build can still be useful for additional context when debugging.&lt;/p&gt;

&lt;p&gt;Though the instructions are tailored to a Rails project using &lt;a href="https://github.com/rails/webpacker" target="_blank" rel="noopener noreferrer"&gt;Webpacker&lt;/a&gt;, you could adapt them to any webpack project.&lt;/p&gt;

&lt;p&gt;When the analyzer is run, it will launch a local webserver; visit &lt;a href="http://locahost:8888" target="_blank" rel="noopener noreferrer"&gt;http://locahost:8888&lt;/a&gt; to view the treemap. The &lt;a href="https://github.com/webpack-contrib/webpack-bundle-analyzer#options-for-plugin" target="_blank" rel="noopener noreferrer"&gt;port is configurable&lt;/a&gt;, and you&amp;#39;ll need to hit Ctrl+C to stop the server.&lt;/p&gt;

      &lt;h4 id="option-1-analyze-json-from-command-line" class="title title-h4"&gt;
        &lt;a name="option-1-analyze-json-from-command-line" class="anchor" href="#option-1-analyze-json-from-command-line"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Option 1: Analyze JSON from command line
      &lt;/h4&gt;
    
&lt;p&gt;The &lt;code&gt;webpack-bundle-analyzer&lt;/code&gt; package ships with a command-line interface (CLI) that can ingest a webpack JSON stats file. In other words, it&amp;#39;s a two-step process in which we generate a webpack build that&amp;#39;s outputs build stats to a JSON file and then run the &lt;code&gt;webpack-bundle-analyzer&lt;/code&gt; CLI to analyze the build stats and the output bundles generated in the build:&lt;/p&gt;

&lt;p&gt;In a Rails project, we might typically first run the webpack build:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;bin/webpack --profile --json &amp;gt; tmp/webpack-stats.json
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then we would analyze the output with the command &lt;code&gt;webpack-bundle-analyzer [stats file] [output directory]&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;npx webpack-bundle-analyzer tmp/webpack-stats.json public/packs
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;npx&lt;/code&gt; is a separate command-line interface that is installed along with &lt;code&gt;node&lt;/code&gt;. It will look for the command you specify in your locally installed &lt;code&gt;node_modules&lt;/code&gt;. In other words, this replaces &lt;code&gt;./bin/node_modules/webpack-bundle-analyzer ...&lt;/code&gt;.
Get this: with &lt;code&gt;npx&lt;/code&gt;, the package script you&amp;#39;re trying to run &lt;em&gt;doesn&amp;#39;t even need to be installed&lt;/em&gt;! Yes, that&amp;#39;s right: if you want, you can skip &lt;code&gt;yarn add webpack-bundle-analyzer&lt;/code&gt;. Use &lt;code&gt;npx webpack-bundler-analyzer&lt;/code&gt; as if it&amp;#39;s installed globally. &lt;code&gt;npx&lt;/code&gt; will search your locally installed packages and will look up the package on the remote npm registry when not found locally. Pretty cool!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Since I don&amp;#39;t want to type all that out every time, I put those commands in the &lt;code&gt;scripts&lt;/code&gt; section of my &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="json"&gt;// package.json
{
  // ...
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;webpack:analyze&amp;quot;: &amp;quot;yarn webpack:build_json &amp;amp;&amp;amp; yarn webpack:analyze_json&amp;quot;,
    &amp;quot;webpack:build_json&amp;quot;: &amp;quot;RAILS_ENV=${RAILS_ENV:-production} NODE_ENV=${NODE_ENV:-production} bin/webpack --profile --json &amp;gt; tmp/webpack-stats.json&amp;quot;,
    &amp;quot;webpack:analyze_json&amp;quot;: &amp;quot;webpack-bundle-analyzer tmp/webpack-stats.json public/packs&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To analyze the build using these npm scripts, run:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;yarn webpack:analyze
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You could instead write this as a rake tasks as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class="ruby"&gt;namespace :webpack do
  desc &amp;quot;Analyze the webpack build&amp;quot;
  task :analyze =&amp;gt; [:build_json, :analyze_json]

  task :build_json do
    system &amp;quot;RAILS_ENV=#{ENV.fetch(&amp;#39;RAILS_ENV&amp;#39;, &amp;#39;production&amp;#39;)} \
     NODE_ENV=#{ENV.fetch(&amp;#39;NODE_ENV&amp;#39;, &amp;#39;production&amp;#39;)} \
     bin/webpack --profile --json &amp;gt; tmp/webpack-stats.json&amp;quot;
  end

  task :analyze_json do
    system &amp;quot;npx webpack-bundle-analyzer tmp/webpack-stats.json public/packs&amp;quot;
  rescue Interrupt
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To analyze the build using these rake tasks, run:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;rake webpack:analyze
&lt;/code&gt;&lt;/pre&gt;

      &lt;h4 id="option-2-integrated-setup" class="title title-h4"&gt;
        &lt;a name="option-2-integrated-setup" class="anchor" href="#option-2-integrated-setup"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Option 2: Integrated setup
      &lt;/h4&gt;
    
&lt;p&gt;Instead of using separate scripts to trigger the bundle analyzer, you can instead incorporate the webpack-bundle-analyzer into your webpack configuration. Doing so runs the webpack-bundle-analyzer localhost server as a side effect of running the build command.&lt;/p&gt;

&lt;p&gt;Below, we&amp;#39;ll look at how you can integrate the analyzer into a Rails using &lt;a href="https://github.com/rails/webpacker" target="_blank" rel="noopener noreferrer"&gt;Webpacker&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;// config/webpack/environment.js
const { environment } = require(&amp;#39;@rails/webpacker&amp;#39;)

if (process.env.WEBPACK_ANALYZE === &amp;#39;true&amp;#39;) {
  const BundleAnalyzerPlugin = require(&amp;#39;webpack-bundle-analyzer&amp;#39;).BundleAnalyzerPlugin
  environment.plugins.append(&amp;#39;BundleAnalyzerPlugin&amp;#39;, new BundleAnalyzerPlugin())
}

module.exports = environment
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Note that the plugin is incorporated into the webpack config only with the environment variable &lt;code&gt;WEBPACK_ANALYZE=true&lt;/code&gt;, so it is only added to the configuration as an opt-in feature.&lt;/p&gt;

&lt;p&gt;To visualize the production build, run this command instead:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;WEBPACK_ANALYZE=true RAILS_ENV=production NODE_ENV=production ./bin/webpack
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You could even run the analyzer server alongside your webpack-dev server with &lt;code&gt;WEBPACK_ANALYZE=true ./bin/webpack-dev-server&lt;/code&gt; to get instant feedback. Keep in mind that the bundle analysis while in development mode will yield different results from the production build.&lt;/p&gt;

      &lt;h4 id="rails-template" class="title title-h4"&gt;
        &lt;a name="rails-template" class="anchor" href="#rails-template"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Rails template
      &lt;/h4&gt;
    
&lt;p&gt;For your convenience, I packaged &lt;a href="https://railsbytes.com/public/templates/Xo5sYr" target="_blank" rel="noopener noreferrer"&gt;this changeset as a Rails template&lt;/a&gt; on &lt;a href="https://railsbytes.com" target="_blank" rel="noopener noreferrer"&gt;railsbytes.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can preview this template at &lt;a href="https://railsbytes.com/public/templates/Xo5sYr" target="_blank" rel="noopener noreferrer"&gt;https://railsbytes.com/public/templates/Xo5sYr&lt;/a&gt;. To use the template, skip the steps above and run the following command:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;rails app:template LOCATION=&amp;quot;https://railsbytes.com/script/Xo5sYr&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

      &lt;h3 id="what-39-s-next-" class="title title-h3"&gt;
        &lt;a name="what-39-s-next-" class="anchor" href="#what-39-s-next-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        What&amp;#39;s next?
      &lt;/h3&gt;
    
&lt;p&gt;So you&amp;#39;ve set up the webpack-bundle-analyzer and started understanding what&amp;#39;s happening in your webpack bundles, what now? You may have noticed some things you don&amp;#39;t like. In future posts, I&amp;#39;ll be examining how you can deal with the excesses, including:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Replacing libraries with built-in browser functionality or smaller packages&lt;/li&gt;
&lt;li&gt;Taking full advantage of tree-shaking with imports&lt;/li&gt;
&lt;li&gt;Using webpack to filter out unnecessary imports&lt;/li&gt;
&lt;li&gt;The &amp;quot;right way&amp;quot; to split bundles for multi-page applications&lt;/li&gt;
&lt;li&gt;Code-splitting with dynamic imports&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Until then, here are some more resources you can use:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/web/fundamentals/performance/webpack/monitor-and-analyze" target="_blank" rel="noopener noreferrer"&gt;Google: Monitor and analyze the app&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=ltlxjq4YEKU" target="_blank" rel="noopener noreferrer"&gt;Video: How to use the webpack bundle analyzer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/jmblog/how-to-optimize-momentjs-with-webpack" target="_blank" rel="noopener noreferrer"&gt;How to optimize momentjs with webpack&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.blazemeter.com/blog/the-correct-way-to-import-lodash-libraries-a-benchmark" target="_blank" rel="noopener noreferrer"&gt;The correct wat to import lodash&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=Da6VxdGU2Ig" target="_blank" rel="noopener noreferrer"&gt;Managing your bundle size (video)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Why does Rails 6 include both Webpacker and Sprockets?</title>
    <link rel="alternate" href="/archive/why-does-rails-install-both-webpacker-and-sprockets.html"/>
    <id>/archive/why-does-rails-install-both-webpacker-and-sprockets.html</id>
    <published>2020-05-09T00:00:00+00:00</published>
    <updated>2020-05-09T00:00:00+00:00</updated>
    <author>
      <name>Ross Kaffenberger</name>
    </author>
    <summary type="html">&lt;p&gt;Since you're reading this post, chances are you've heard Rails 6 installs both Webpacker and Sprockets and you're wondering WTF is going on. By the way, it's &lt;a href="https://weblog.rubyonrails.org/2020/5/7/A-May-of-WTFs/" target="_blank" rel="noopener noreferrer"&gt;a whole May of WTFs for Rails&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Wait, don't Sprockets and Webpacker basically do the same...&lt;/strong&gt;&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;Since you&amp;#39;re reading this post, chances are you&amp;#39;ve heard Rails 6 installs both Webpacker and Sprockets and you&amp;#39;re wondering WTF is going on. By the way, it&amp;#39;s &lt;a href="https://weblog.rubyonrails.org/2020/5/7/A-May-of-WTFs/" target="_blank" rel="noopener noreferrer"&gt;a whole May of WTFs for Rails&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Wait, don&amp;#39;t Sprockets and Webpacker basically do the same thing?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;If this is what you&amp;#39;re thinking, you&amp;#39;re not alone.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Curious about or need help with webpack? I may be able to help! I&amp;#39;m developing a course for Webpack on Rails and I frequently write about it on this blog.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://signup.rossta.net" target="_blank" rel="noopener noreferrer"&gt;&lt;strong&gt;Subscribe to my newsletter to get updates&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The question keeps coming up, like in this &lt;a href="https://www.reddit.com/r/rails/comments/9zg7fe/confused_about_the_difference_between_sprockets/" target="_blank" rel="noopener noreferrer"&gt;Reddit post&lt;/a&gt;, or this &lt;a href="https://stackoverflow.com/questions/55232591/rails-5-2-why-still-use-assets-pipeline-with-webpacker" target="_blank" rel="noopener noreferrer"&gt;StackOverflow question&lt;/a&gt;, or this &lt;a href="https://www.reddit.com/r/rails/comments/dfww82/best_practice_for_webpacker_in_rails_6_do_i_need/" target="_blank" rel="noopener noreferrer"&gt;other Reddit post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here&amp;#39;s my colleague &lt;a href="https://twitter.com/danmayer" target="_blank" rel="noopener noreferrer"&gt;@danmayer&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;blockquote class="twitter-tweet" data-conversation="none"&gt;&lt;p lang="en" dir="ltr"&gt;How and where to handle assets is in a confusing state, 1 foot in asset pipeline and one foot in webpacker... If that is going to be a long last direction vs a transition we should make the best practices more clear in guides and how to ensure they play nicely together&lt;/p&gt;&amp;mdash; Dan Mayer (@danmayer) &lt;a href="https://twitter.com/danmayer/status/1258577270760804353?ref_src=twsrc%5Etfw"&gt;May 8, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;Even &lt;a href="https://twitter.com/avdi" target="_blank" rel="noopener noreferrer"&gt;@avdi&lt;/a&gt; just last week:&lt;/p&gt;

&lt;p&gt;&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;Will someone please explain to me why after all the foofaraw about Rails 6 going to webpack, I&amp;#39;m still having to unfuck Sprockets in my application.rb&lt;/p&gt;&amp;mdash; Avdi Grimm (@avdi) &lt;a href="https://twitter.com/avdi/status/1256742291890413570?ref_src=twsrc%5Etfw"&gt;May 3, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;It&amp;#39;s clear the Webpacker-Sprockets co-existence is catching many by surprise. There&amp;#39;s good reason for that too.&lt;/p&gt;

&lt;p&gt;You wouldn&amp;#39;t be wrong to think Sprockets and webpack solve the same general problem:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Packaging assets (JavaScript, CSS, images, fonts) for the browser&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The similarities exist. Both Sprockets and webpack will:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;combine many source files into one or a few destination bundles for production&lt;/li&gt;
&lt;li&gt;transpile source files from one syntax to another&lt;/li&gt;
&lt;li&gt;minify and fingerprint assets when building for production&lt;/li&gt;
&lt;li&gt;rebuild modified source files in development incrementally&lt;/li&gt;
&lt;li&gt;do all of the above for both JavaScript and CSS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, Sprockets and webpack solve asset bundling in very different ways.&lt;/p&gt;

&lt;p&gt;Sprockets was introduced way back in 2007 (!), before Node.js, before the Cambrian explosion of JavaScript, before module specifications like CommonJS, AMD, and EcmaScript modules, before webpack, browserify and $ANY_MODULE_AWARE_ASSET_BUNDLER. Sprockets has not attempted to keep up with improvements in tooling, language features, and browser capabilities (save for source maps) as other projects in JavaScript community have.&lt;/p&gt;

&lt;p&gt;Webpack, on the other hand, fully embraces the concept of JavaScript modules. It integrates with Babel, PostCSS, and just about any recent web framework. It supports a number of module syntaxes, including &lt;a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports" target="_blank" rel="noopener noreferrer"&gt;dynamic imports&lt;/a&gt; for &lt;a href="https://webpack.js.org/guides/code-splitting/" target="_blank" rel="noopener noreferrer"&gt;code splitting&lt;/a&gt;. There are a wide variety of &lt;a href="https://webpack.js.org/configuration/devtool/" target="_blank" rel="noopener noreferrer"&gt;configurable source map options&lt;/a&gt;. Top to bottom, the webpack compilation process is extremely modular and customizable.&lt;/p&gt;

      &lt;h3 id="so-why-would-rails-include-both-" class="title title-h3"&gt;
        &lt;a name="so-why-would-rails-include-both-" class="anchor" href="#so-why-would-rails-include-both-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        So why would Rails include both?
      &lt;/h3&gt;
    
&lt;p&gt;Here&amp;#39;s the answer plain and simple straight from DHH back in 2016 when Webpack was first introduced as the recommended JavaScript compiler with Rails 5.1.&lt;/p&gt;

&lt;p&gt;&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;We will continue to use the asset pipeline for JavaScript sprinkles, CSS, images, and other static stuff. The two approaches coexist great.&lt;/p&gt;&amp;mdash; DHH (@dhh) &lt;a href="https://twitter.com/dhh/status/808349072734027776?ref_src=twsrc%5Etfw"&gt;December 12, 2016&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;We will continue to use the asset pipeline for JavaScript sprinkles, CSS, images, and other static stuff. The two approaches coexist great.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;To elaborate on this decision, there was a telling response from DHH on his GitHub pull request to &lt;a href="https://github.com/rails/rails/pull/33079#issuecomment-400140840" target="_blank" rel="noopener noreferrer"&gt;make Webpacker the default JavaScript compiler in Rails 6&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/rails/rails/pull/33079#issuecomment-400140840" target="_blank" rel="noopener noreferrer"&gt;&lt;img src="/assets/images/blog/webpack/dhh-awkward.png" alt="DHH: Webpack’s support is awkward in my opinion and does not offer any benefits over Sprockets. Unlike in the realm of JavaScript compilation." loading="lazy" /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;@dwightwatson&lt;/strong&gt; Out of curiousity, what is the argument to continue using Sprockets for CSS/static assets when Webpacker supports them by default out of the box?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;@dhh&lt;/strong&gt; Webpack’s support is awkward in my opinion and does not offer any benefits over Sprockets. Unlike in the realm of JavaScript compilation.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;There&amp;#39;s a lot to unpack there.&lt;/p&gt;

&lt;p&gt;When it comes to asset bundling, the &amp;quot;Rails way&amp;quot; is webpack for JavaScript and Sprockets for everything else. The default setup in a fresh Rail 6 install, similar to what Basecamp uses, still compiles CSS, images, and fonts with Sprockets.&lt;/p&gt;

&lt;p&gt;This means, if you&amp;#39;re a member of the Basecamp camp, all your webpack JavaScript source files would live in &lt;code&gt;app/javascript&lt;/code&gt; and all your Sprockets CSS and images would remain in &lt;code&gt;app/assets&lt;/code&gt;. Running &lt;code&gt;rails assets:precompile&lt;/code&gt; will first build all the Sprockets assets into the &lt;code&gt;public/assets&lt;/code&gt; directory, then will build all the webpack assets into the &lt;code&gt;public/packs&lt;/code&gt; directory.&lt;/p&gt;

&lt;p&gt;To be very clear, this does not mean you need to run both Sprockets and Webpacker to serve assets for the browser. The two processes for bundling assets are completely separate and they do not share dependencies. Different helpers, different implementations, different directories, different, different, different. They are built in such a way that they can cohabitate a Rails application.&lt;/p&gt;

&lt;p&gt;On the other hand, you could use &lt;em&gt;only&lt;/em&gt; Sprockets or &lt;em&gt;only&lt;/em&gt; Webpacker to bundle all your assets.&lt;/p&gt;

      &lt;h3 id="feeling-awkward-" class="title title-h3"&gt;
        &lt;a name="feeling-awkward-" class="anchor" href="#feeling-awkward-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Feeling, awkward?
      &lt;/h3&gt;
    
&lt;p&gt;DHH calls webpack&amp;#39;s approach to handling non-JavaScript assets &lt;em&gt;awkward&lt;/em&gt;. Now, I happen to like webpack a lot. But he&amp;#39;s not wrong.&lt;/p&gt;

&lt;p&gt;He says this because, to bundle CSS and images in webpack, you need to &lt;em&gt;import CSS and images from your JavaScript files&lt;/em&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;import &amp;#39;../application.css&amp;#39;

import myImageUrl from &amp;#39;../images/my-image.jpg&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The reason for this is that webpack wants to treat &lt;strong&gt;everything&lt;/strong&gt; as a JavaScript module. I mean &lt;em&gt;everything&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;All JavaScript imports are treated as JavaScript modules. To use CSS with webpack, you import it as you would a JavaScript module. To use an image with webpack, you import it as you would a JavaScript module. Depending on your perspective, this may be unusual—perhaps especially for Rails developers coming from Sprockets.&lt;/p&gt;

&lt;p&gt;This isn&amp;#39;t just a &amp;quot;Rails opinion&amp;quot;. Consider this recent tweet from a prominent voice in the React community, &lt;a href="https://twitter.com/ryanflorence" target="_blank" rel="noopener noreferrer"&gt;Ryan Florence&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;import url from &amp;quot;./whatever.jpg&amp;quot;&lt;br&gt;import html from &amp;quot;./some.md&amp;quot;&lt;br&gt;import str from &amp;quot;raw!./some.js&amp;quot;&lt;br&gt;&lt;br&gt;So ... I gotta admit I love this stuff, but did we jump the shark here with JavaScript build tools? Should this stuff happen outside the JavaScript module bundler?&lt;/p&gt;&amp;mdash; Ryan Florence (@ryanflorence) &lt;a href="https://twitter.com/ryanflorence/status/1258966331572928514?ref_src=twsrc%5Etfw"&gt;May 9, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;Sounds a lot like discovering Sprockets in reverse? (I&amp;#39;m not surprised at that 50/50 split either).&lt;/p&gt;

&lt;p&gt;While awkward to some, webpack&amp;#39;s &amp;quot;Everything is a Module&amp;quot; mindset is also extremely powerful. There are some interesting possibilities when a tool goes &lt;strong&gt;all in&lt;/strong&gt; with such a mental model. Think of what &amp;quot;Everything is an Object&amp;quot; has done for Ruby.&lt;/p&gt;

      &lt;h3 id="choosing-webpacker-or-sprockets-or-both-" class="title title-h3"&gt;
        &lt;a name="choosing-webpacker-or-sprockets-or-both-" class="anchor" href="#choosing-webpacker-or-sprockets-or-both-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Choosing Webpacker or Sprockets (or both)
      &lt;/h3&gt;
    
&lt;p&gt;The good news is there&amp;#39;s no need to stress about it. Rails defaults mirror the preferred approach of the Basecamp team, but that doesn&amp;#39;t mean you have to agree or that it&amp;#39;s the right way to do things for your application. You can use both, as Basecamp does, or choose one over the other.&lt;/p&gt;

&lt;p&gt;To help you decide, I adapted &lt;a href="https://github.com/reactjs/react-rails/wiki/Choosing-Sprockets-or-Webpacker" target="_blank" rel="noopener noreferrer"&gt;this excellent guide from the react-rails project&lt;/a&gt;:&lt;/p&gt;

      &lt;h4 id="why-sprockets-" class="title title-h4"&gt;
        &lt;a name="why-sprockets-" class="anchor" href="#why-sprockets-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Why Sprockets?
      &lt;/h4&gt;
    
&lt;ul&gt;
&lt;li&gt;My Rails app does not need much JavaScript&lt;/li&gt;
&lt;li&gt;I prefer global scripts and jQuery plugin enhancement, i.e. I don&amp;#39;t need a proper JavaScript module system&lt;/li&gt;
&lt;li&gt;Upgrading my legacy Rails app to Webpacker would be too costly&lt;/li&gt;
&lt;li&gt;I don&amp;#39;t need advanced tooling for local development&lt;/li&gt;
&lt;li&gt;It just works and I don&amp;#39;t have time to ramp up on alternatives&lt;/li&gt;
&lt;li&gt;My Rails app relies on specific asset gems and I don&amp;#39;t have NPM alternatives&lt;/li&gt;
&lt;/ul&gt;

      &lt;h4 id="why-not-sprockets-" class="title title-h4"&gt;
        &lt;a name="why-not-sprockets-" class="anchor" href="#why-not-sprockets-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Why not Sprockets?
      &lt;/h4&gt;
    
&lt;ul&gt;
&lt;li&gt;Sprockets is slowing down my local development experience&lt;/li&gt;
&lt;li&gt;I need more control over aspects of our asset compilation&lt;/li&gt;
&lt;li&gt;My app has a lot of JavaScript and needs code-splitting features to avoid massive payloads&lt;/li&gt;
&lt;li&gt;I&amp;#39;m concerned about long-term support&lt;/li&gt;
&lt;/ul&gt;

      &lt;h4 id="why-webpacker-" class="title title-h4"&gt;
        &lt;a name="why-webpacker-" class="anchor" href="#why-webpacker-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Why Webpacker?
      &lt;/h4&gt;
    
&lt;ul&gt;
&lt;li&gt;I want to use a proper JavaScript module system to manage dependencies, i.e., limit global scope pollution and have an explicit dependency graph with import/export and require&lt;/li&gt;
&lt;li&gt;I want to take advantage of the cutting edge features from ES6+, Babel, PostCSS&lt;/li&gt;
&lt;li&gt;I want intelligent code-splitting features such as dynamic imports and webpack&amp;#39;s splitChunks optimization&lt;/li&gt;
&lt;li&gt;I want more flexibility with how my build system generates source maps&lt;/li&gt;
&lt;li&gt;I want advanced tooling for local development including hot module replacement&lt;/li&gt;
&lt;li&gt;I want to build Single Page Apps*&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;*You don&amp;#39;t need to have a Single Page App to use webpack; it works quite well for &amp;quot;Multi Page Apps&amp;quot;.&lt;/p&gt;

      &lt;h4 id="why-not-webpacker-" class="title title-h4"&gt;
        &lt;a name="why-not-webpacker-" class="anchor" href="#why-not-webpacker-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Why not Webpacker?
      &lt;/h4&gt;
    
&lt;ul&gt;
&lt;li&gt;My Rails app does not need much JavaScript&lt;/li&gt;
&lt;li&gt;I am a backend developer with limited knowledge of JavaScript ecosystem&lt;/li&gt;
&lt;li&gt;I am not ready to invest time to understand webpack and Webpacker&lt;/li&gt;
&lt;li&gt;It seems too complicated&lt;/li&gt;
&lt;/ul&gt;

      &lt;h4 id="why-use-both-" class="title title-h4"&gt;
        &lt;a name="why-use-both-" class="anchor" href="#why-use-both-"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Why use both?
      &lt;/h4&gt;
    
&lt;ul&gt;
&lt;li&gt;I prefer the &amp;quot;Rails way&amp;quot;: Webpacker to compile JavaScript, Sprockets for CSS, images, and fonts&lt;/li&gt;
&lt;li&gt;I&amp;#39;m upgrading from Sprockets to Webpacker incrementally&lt;/li&gt;
&lt;/ul&gt;

      &lt;h3 id="on-a-personal-note" class="title title-h3"&gt;
        &lt;a name="on-a-personal-note" class="anchor" href="#on-a-personal-note"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        On a personal note
      &lt;/h3&gt;
    
&lt;p&gt;I want to leave Sprockets behind. Sprockets was a huge leap forward for asset management when it was first introduced but it hasn&amp;#39;t taken advantage of newer possibilities. It languishes while webpack&amp;#39;s key features, such as performance optimizations through code-splitting, are first class.&lt;/p&gt;

&lt;p&gt;Webpack is more complex and does require some investment. For me, it&amp;#39;s been worth it.&lt;/p&gt;

&lt;p&gt;&lt;a href="https://rossta.net/blog/reasons-to-switch-to-webpacker.html" target="_blank" rel="noopener noreferrer"&gt;I think webpack is a great choice for any application with a significant amount of JavaScript.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Which is right for you?&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>How to debug webpack on Rails</title>
    <link rel="alternate" href="/archive/how-to-debug-webpack-on-rails.html"/>
    <id>/archive/how-to-debug-webpack-on-rails.html</id>
    <published>2020-05-04T00:00:00+00:00</published>
    <updated>2020-05-04T00:00:00+00:00</updated>
    <author>
      <name>Ross Kaffenberger</name>
    </author>
    <summary type="html">&lt;p&gt;It's nice that the Rails Webpacker gem and NPM package abstracts your webpack config... that is until you need to make changes.&lt;/p&gt;

&lt;p&gt;In &lt;a href="/blog/how-to-customize-webpack-for-rails-apps.html"&gt;my previous post&lt;/a&gt;, I talked about how to customize the webpack config... but how can you be sure you're making the right...&lt;/p&gt;</summary>
    <content type="html">&lt;p&gt;It&amp;#39;s nice that the Rails Webpacker gem and NPM package abstracts your webpack config... that is until you need to make changes.&lt;/p&gt;

&lt;p&gt;In &lt;a href="/blog/how-to-customize-webpack-for-rails-apps.html"&gt;my previous post&lt;/a&gt;, I talked about how to customize the webpack config... but how can you be sure you&amp;#39;re making the right change? The webpack config is JavaScript, so you can&amp;#39;t simply jump into the Rails console to poke around. But you do have some other tools at your disposal though.&lt;/p&gt;

&lt;p&gt;In this post, I&amp;#39;ll share some tips for debugging the webpack config in your Rails app.&lt;/p&gt;

      &lt;h3 id="the-one-liner" class="title title-h3"&gt;
        &lt;a name="the-one-liner" class="anchor" href="#the-one-liner"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        The one-liner
      &lt;/h3&gt;
    
&lt;blockquote&gt;
&lt;p&gt;For the following examples, I&amp;#39;m using Node v12.13.1.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here&amp;#39;s a quick one-liner for printing the entire Rails webpack config in development:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ RAILS_ENV=development node -e &amp;#39;console.dir(require(&amp;quot;./config/webpack/development&amp;quot;), { depth: null })&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I like &lt;a href="https://nodejs.org/api/console.html#console_console_dir_obj_options" target="_blank" rel="noopener noreferrer"&gt;&lt;code&gt;console.dir&lt;/code&gt;&lt;/a&gt; as a nice alternative to &lt;code&gt;console.log&lt;/code&gt; for inspecting JavaScript objects.&lt;/p&gt;

&lt;p&gt;For inspecting the test or production configs, just update the RAILS_ENV and the target file:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ RAILS_ENV=development node -e &amp;#39;console.dir(require(&amp;quot;./config/webpack/development&amp;quot;), { depth: null })&amp;#39;
# OR
$ RAILS_ENV=test node -e &amp;#39;console.dir(require(&amp;quot;./config/webpack/test&amp;quot;), { depth: null })&amp;#39;
# OR
$ RAILS_ENV=production node -e &amp;#39;console.dir(require(&amp;quot;./config/webpack/production&amp;quot;), { depth: null })&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We ensure the RAILS_ENV is set so Webpacker&amp;#39;s NPM package will load the correct settings from your &lt;code&gt;config/webpacker.yml&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;To make it even easier, I&amp;#39;ll put this into a script file in &lt;code&gt;bin/inspect_webpack&lt;/code&gt; with my Rails projects.&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;#!/usr/bin/env sh

env=${RAILS_ENV:-development}
RAILS_ENV=${env} node -e &amp;quot;console.dir(require(\&amp;quot;./config/webpack/${env}\&amp;quot;), { depth: null })&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then to run:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ chmod a+x ./bin/inspect_webpack
$ ./bin/inspect_webpack
# OR
$ RAILS_ENV=test ./bin/inspect_webpack
# OR
$ RAILS_ENV=production ./bin/inspect_webpack
&lt;/code&gt;&lt;/pre&gt;

      &lt;h3 id="on-the-console" class="title title-h3"&gt;
        &lt;a name="on-the-console" class="anchor" href="#on-the-console"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        On the console
      &lt;/h3&gt;
    
&lt;p&gt;For an interactive experience, you can run &lt;code&gt;node&lt;/code&gt; to pull up the Node.js REPL. This is especially helpful for isolating pieces of the webpack config &amp;quot;tree&amp;quot;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;$ RAILS_ENV=development node
&amp;gt; const config = require(&amp;#39;./config/webpack/development&amp;#39;)
undefined
&amp;gt; console.dir(config, { depth: null })
{
  mode: &amp;#39;development&amp;#39;,
  output: {
// displays the entire webpack config
// ...
&amp;gt; console.dir(config.plugins, { depth: null })
// displays the plugins ...
// ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As with the script I showed earlier, change the RAILS_ENV to inspect the configs for the other environments.&lt;/p&gt;

&lt;p&gt;From the node console, you can also access and play around with the Webpack &lt;code&gt;environment&lt;/code&gt; object directly:&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;&amp;gt; const { environment } = require(&amp;#39;@rails/webpacker&amp;#39;)
undefined
&amp;gt; environment.plugins.get(&amp;#39;Manifest&amp;#39;)
// displays configured WebpackAssetsManifest plugin
&lt;/code&gt;&lt;/pre&gt;

      &lt;h3 id="debugging-with-devtools" class="title title-h3"&gt;
        &lt;a name="debugging-with-devtools" class="anchor" href="#debugging-with-devtools"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Debugging with DevTools
      &lt;/h3&gt;
    
&lt;p&gt;While the above examples help inspect the webpack config in a REPL, it may help to debug the config within the build process itself. It&amp;#39;s possible to &lt;a href="https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27" target="_blank" rel="noopener noreferrer"&gt;use the &lt;code&gt;debugger&lt;/code&gt; provided by Chrome DevTools on a Node.js process&lt;/a&gt; (as opposed to a browser&amp;#39;s JavaScript process).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For the following examples, I&amp;#39;m using Chrome Version 80.0.3987.163&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We could, for example, drop a &lt;code&gt;debugger;&lt;/code&gt; statement into our Webpacker webpack config:&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;const { environment } = require(&amp;#39;@rails/webpacker&amp;#39;)

debugger

// changes I want to debug ...

module.exports = environment
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can then run the webpack build with the &lt;code&gt;--debug&lt;/code&gt; flag:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ ./bin/webpack --debug
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;which is in the local development environment is equivalent to:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ RAILS_ENV=development node --inspect-brk yarn webpack --config ./config/webpack/development.js
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Running the webpack process in debug mode will open up a websocket to communicate with Chrome DevTools:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ ./bin/webpack --debug
Debugger listening on ws://127.0.0.1:9229/861b81ed-6f2f....
For help, see: https://nodejs.org/en/docs/inspector
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Visit &lt;code&gt;chrome://inspect&lt;/code&gt; in your Chrome browser and we can find a link for our running Node process in the menu:
&lt;img src="/assets/images/blog/webpack/chrome-inspect-main.png" alt="Screenshot of the chrome://inspect page" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;This will start a instance of the DevTools for your Node process where we can click &amp;quot;Play&amp;quot; to resume execution:
&lt;img src="/assets/images/blog/webpack/chrome-inspect-webpack-debug-1.png" alt="Screenshot of Chrome DevTools debugger start" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;The process halts when it hits our &lt;code&gt;debugger&lt;/code&gt; statement and we can modify values on the console:
&lt;img src="/assets/images/blog/webpack/chrome-inspect-webpack-debug-2.png" alt="Screenshot of Chrome DevTools console" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;For larger (or misconfigured) projects, you may experience memory usage issues with the webpack build. The DevTools debugger also provides a Memory tab for taking heap snapshots and tracking down the memory hogs in your build process.&lt;/p&gt;

&lt;p&gt;&lt;img src="/assets/images/blog/webpack/chrome-inpsect-memory-tab.png" alt="Screenshot of DevTools Memory tab" loading="lazy" /&gt;
&lt;img src="/assets/images/blog/webpack/chrome-inspect-heap-snapshot.png" alt="Screenshot of DevTools heap snapshot" loading="lazy" /&gt;&lt;/p&gt;

&lt;p&gt;There&amp;#39;s more on &lt;a href="https://medium.com/webpack/webpack-bits-learn-and-debug-webpack-with-chrome-dev-tools-da1c5b19554" target="_blank" rel="noopener noreferrer"&gt;using DevTools with webpack on the webpack blog&lt;/a&gt;.&lt;/p&gt;

      &lt;h3 id="speed-measure-plugin" class="title title-h3"&gt;
        &lt;a name="speed-measure-plugin" class="anchor" href="#speed-measure-plugin"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Speed measure plugin
      &lt;/h3&gt;
    
&lt;p&gt;To help isolate slow parts of your build, I highly recommend the &lt;a href="https://github.com/stephencookdev/speed-measure-webpack-plugin#readme" target="_blank" rel="noopener noreferrer"&gt;Speed Measure Plugin&lt;/a&gt; for webpack. This is a plugin you would install and configure in your project temporarily to get feedback about individual parts of the build process.&lt;/p&gt;

&lt;p&gt;First, install the plugin:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;yarn add speed-measure-webpack-plugin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then temporarily configure your production build (you could also do something similar for development or test):&lt;/p&gt;

&lt;pre&gt;&lt;code class="javascript"&gt;process.env.NODE_ENV = process.env.NODE_ENV || &amp;#39;production&amp;#39;

const environment = require(&amp;#39;./environment&amp;#39;)

const SpeedMeasurePlugin = require(&amp;#39;speed-measure-webpack-plugin&amp;#39;)
const smp = new SpeedMeasurePlugin()

module.exports = smp.wrap(environment.toWebpackConfig())
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And then run the production build:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ RAILS_ENV=production NODE_ENV=production ./bin/webpack
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The Speed Measure plugin will print information to $stdout which may help identify the slow parts:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt; SMP  ⏱
General output time took 3.094 secs

 SMP  ⏱  Plugins
CaseSensitivePathsPlugin took 0.391 secs
TerserPlugin took 0.306 secs
WebpackAssetsManifest took 0.066 secs
CompressionPlugin took 0.019 secs
MiniCssExtractPlugin took 0.001 secs
OptimizeCssAssetsWebpackPlugin took 0.001 secs
EnvironmentPlugin took 0 secs

 SMP  ⏱  Loaders
modules with no loaders took 1.27 secs
  module count = 365
babel-loader took 0.824 secs
  module count = 4
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;See &lt;a href="https://dev.to/slashgear_/how-to-boost-the-speed-of-your-webpack-build-16h0" target="_blank" rel="noopener noreferrer"&gt;How to boost the speed of your webpack build&lt;/a&gt; and the &lt;a href="https://webpack.js.org/guides/build-performance/" target="_blank" rel="noopener noreferrer"&gt;official webpack build performance docs&lt;/a&gt; for a number of useful tips for improving build/compilation performance.&lt;/p&gt;

      &lt;h3 id="wrapping-up" class="title title-h3"&gt;
        &lt;a name="wrapping-up" class="anchor" href="#wrapping-up"&gt;       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
&lt;/a&gt;
        Wrapping up
      &lt;/h3&gt;
    
&lt;p&gt;Even though Webpacker hides away much of the complexity of webpack configuration, sometimes it&amp;#39;s necessary to peel back the abstraction layer. Like anything else that&amp;#39;s new, wrapping your head around webpack build can be intimidating, especially if you don&amp;#39;t know where to start. If things go wrong, all is not lost. Hopefully this post helped illustrate some ways you can get insight into what&amp;#39;s happening in your Rails webpack config.&lt;/p&gt;
</content>
  </entry>
</feed>
